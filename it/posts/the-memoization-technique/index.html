<!doctype html><html lang=it dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="it"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>Memoizzazione in Go: Caching di Computazioni Costose nel Modo Corretto &#183; Git Push and Run</title><meta name=title content="Memoizzazione in Go: Caching di Computazioni Costose nel Modo Corretto &#183; Git Push and Run"><meta name=description content="Ingegnere Software e Cloud Architect. Scrivo di Go, Python, AWS e sistemi AI."><meta name=keywords content="golang,"><link rel=canonical href=https://manuelfedele.github.io/it/posts/the-memoization-technique/><meta name=author content="Manuel Fedele"><link href=https://github.com/manuelfedele rel=me><link href=https://linkedin.com/in/manuel-fedele rel=me><meta property="og:url" content="https://manuelfedele.github.io/it/posts/the-memoization-technique/"><meta property="og:site_name" content="Git Push and Run"><meta property="og:title" content="Memoizzazione in Go: Caching di Computazioni Costose nel Modo Corretto"><meta property="og:description" content="La memoizzazione e la tecnica di ottimizzazione che consiste nel fare il caching del valore restituito da una funzione pura, in modo che le chiamate ripetute con gli stessi input saltino completamente la computazione. Si applica ogni volta che una funzione e costosa, deterministica e chiamata piu volte con gli stessi argomenti. Fatta correttamente in Go richiede un mutex, e nel codice moderno un wrapper generico la rende riutilizzabile su piu tipi. La memoizzazione viene spesso introdotta con Fibonacci perche l’esplosione ricorsiva e facile da visualizzare. Ma le applicazioni reali in produzione sono altrove: controlli dei permessi che accedono a un database, lookup di configurazione su rete, o costose computazioni crittografiche. Questo post copre il quadro completo: dall’implementazione di base alla prevenzione delle data race, ai wrapper generici e all’invalidazione con time-to-live (TTL)."><meta property="og:locale" content="it"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-16T21:07:26+01:00"><meta property="article:modified_time" content="2023-01-16T21:07:26+01:00"><meta property="article:tag" content="Golang"><meta name=twitter:card content="summary"><meta name=twitter:title content="Memoizzazione in Go: Caching di Computazioni Costose nel Modo Corretto"><meta name=twitter:description content="La memoizzazione e la tecnica di ottimizzazione che consiste nel fare il caching del valore restituito da una funzione pura, in modo che le chiamate ripetute con gli stessi input saltino completamente la computazione. Si applica ogni volta che una funzione e costosa, deterministica e chiamata piu volte con gli stessi argomenti. Fatta correttamente in Go richiede un mutex, e nel codice moderno un wrapper generico la rende riutilizzabile su piu tipi. La memoizzazione viene spesso introdotta con Fibonacci perche l’esplosione ricorsiva e facile da visualizzare. Ma le applicazioni reali in produzione sono altrove: controlli dei permessi che accedono a un database, lookup di configurazione su rete, o costose computazioni crittografiche. Questo post copre il quadro completo: dall’implementazione di base alla prevenzione delle data race, ai wrapper generici e all’invalidazione con time-to-live (TTL)."><link type=text/css rel=stylesheet href=/css/main.bundle.min.726dfbf42bcd66e35e2d7258d72fe8fe77509ff76d153e2b46cdbae9c3af9620653459f0119a72d2af4a9b4bc446652d244ad58743d0290e5d8e09e3983b98e5.css integrity="sha512-cm379CvNZuNeLXJY1y/o/ndQn/dtFT4rRs266cOvliBlNFnwEZpy0q9Km0vERmUtJErVh0PQKQ5djgnjmDuY5Q=="><script type=text/javascript src=/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.88278edec77139635e1ad294df5b32b7be9338191c5252d3f6f451ace5852d5f82390cccacedab9c64739d8e068b7e8502895cf8f951060c0368f9a73709fcb7.js integrity="sha512-iCeO3sdxOWNeGtKU31syt76TOBkcUlLT9vRRrOWFLV+COQzMrO2rnGRznY4Gi36FAolc+PlRBgwDaPmnNwn8tw==" data-copy=Copia data-copied=Copiato></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Memoizzazione in Go: Caching di Computazioni Costose nel Modo Corretto","headline":"Memoizzazione in Go: Caching di Computazioni Costose nel Modo Corretto","inLanguage":"it","url":"https://manuelfedele.github.io/it/posts/the-memoization-technique/","author":{"@type":"Person","name":"Manuel Fedele"},"copyrightYear":"2023","dateCreated":"2023-01-16T21:07:26\u002b01:00","datePublished":"2023-01-16T21:07:26\u002b01:00","dateModified":"2023-01-16T21:07:26\u002b01:00","keywords":["golang"],"mainEntityOfPage":"true","wordCount":"1381"}]</script></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral bf-scrollbar"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
Salta al contenuto principale</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 z-100"><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl bg-neutral/25 dark:bg-neutral-800/25"></div><div class="relative m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32"><div class="main-menu flex items-center w-full gap-2 p-1 pl-0"><a href=/it/ class="text-base font-medium truncate min-w-0 shrink">Git Push and Run</a><div class="flex items-center ms-auto"><div class="hidden md:flex"><nav class="flex items-center gap-x-5 h-12"><a href=/it/posts/ class="flex items-center bf-icon-color-hover" aria-label=Blog title=Posts><span class="text-base font-medium break-normal">Blog
</span></a><a href=/it/about/ class="flex items-center bf-icon-color-hover" aria-label="Chi sono" title="Chi sono"><span class="text-base font-medium break-normal">Chi sono
</span></a><a href=/it/coaching/ class="flex items-center bf-icon-color-hover" aria-label=Coaching title=Coaching><span class="text-base font-medium break-normal">Coaching
</span></a><a href=https://github.com/manuelfedele target=_blank class="flex items-center bf-icon-color-hover" aria-label=github title><span><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a><div class="translation nested-menu"><button class="cursor-pointer flex items-center">
<span class=me-1><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span>
</span><span class="text-sm font-medium bf-icon-color-hover" title="Memoizzazione in Go: Caching di Computazioni Costose nel Modo Corretto">IT</span></button><ul class=menuhide><li class="rounded-xl backdrop-blur shadow-2xl p-2 flex flex-col gap-1"><a href=/posts/the-memoization-technique/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Memoization in Go: Caching Expensive Computations Correctly">EN
</span></a><a href=/it/posts/the-memoization-technique/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Memoizzazione in Go: Caching di Computazioni Costose nel Modo Corretto">IT</span></a></li></ul></div><button id=search-button aria-label=Search class="text-base bf-icon-color-hover" title="Cerca (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></nav></div><div class="flex md:hidden"><div class="flex items-center h-14 gap-4"><button id=search-button-mobile aria-label=Search class="flex items-center justify-center bf-icon-color-hover" title="Cerca (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<input type=checkbox id=mobile-menu-toggle autocomplete=off class="hidden peer">
<label for=mobile-menu-toggle class="flex items-center justify-center cursor-pointer bf-icon-color-hover"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></label><div role=dialog aria-modal=true style=scrollbar-gutter:stable class="fixed inset-0 z-50 invisible overflow-y-auto px-6 py-20 opacity-0 transition-[opacity,visibility] duration-300 peer-checked:visible peer-checked:opacity-100 bg-neutral-50/97 dark:bg-neutral-900/99
bf-scrollbar"><label for=mobile-menu-toggle class="fixed end-8 top-5 flex items-center justify-center z-50 h-12 w-12 cursor-pointer select-none rounded-full bf-icon-color-hover border bf-border-color bf-border-color-hover bg-neutral-50 dark:bg-neutral-900"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></label><nav class="mx-auto max-w-md space-y-6"><div class=px-2><a href=/it/posts/ aria-label=Blog class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Posts class="text-2xl font-bold tracking-tight">Blog</span></a></div><div class=px-2><a href=/it/about/ aria-label="Chi sono" class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title="Chi sono" class="text-2xl font-bold tracking-tight">Chi sono</span></a></div><div class=px-2><a href=/it/coaching/ aria-label=Coaching class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Coaching class="text-2xl font-bold tracking-tight">Coaching</span></a></div><div class=px-2><a href=https://github.com/manuelfedele aria-label=github target=_blank class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span class="flex items-center justify-center h-8 w-8 text-2xl"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span><span title class="text-2xl font-bold tracking-tight"></span></a></div><div class="flex flex-wrap items-center [&_span]:text-2xl [&_.translation_button_.icon]:text-4xl! [&_.translation_button_span]:text-base! [&_.translation_.menuhide_span]:text-sm! gap-x-6 ps-2 mt-8 pt-8 border-t bf-border-color"><div class="translation nested-menu"><button class="cursor-pointer flex items-center">
<span class=me-1><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span>
</span><span class="text-sm font-medium bf-icon-color-hover" title="Memoizzazione in Go: Caching di Computazioni Costose nel Modo Corretto">IT</span></button><ul class=menuhide><li class="rounded-xl backdrop-blur shadow-2xl p-2 flex flex-col gap-1"><a href=/posts/the-memoization-technique/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Memoization in Go: Caching Expensive Computations Correctly">EN
</span></a><a href=/it/posts/the-memoization-technique/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Memoizzazione in Go: Caching di Computazioni Costose nel Modo Corretto">IT</span></a></li></ul></div></div></nav></div></div></div></div></div><script>(function(){var t,n,e=document.querySelector(".main-menu");if(!e)return;t=window.location.pathname,n=e.querySelectorAll('a[href="'+t+'"]'),n.forEach(function(e){var t=e.querySelectorAll("span");t.forEach(function(e){e.classList.add("active")})})})()</script></div></div><script type=text/javascript src=/js/background-blur.min.00a57c73ea12f2cab2980c3c3d649e89f6d82f190f74bbe2b67f2f5e39ab7d032ece47086400ca05396758aace13299da49aca43ea643d2625e62c506267a169.js integrity="sha512-AKV8c+oS8sqymAw8PWSeifbYLxkPdLvitn8vXjmrfQMuzkcIZADKBTlnWKrOEymdpJrKQ+pkPSYl5ixQYmehaQ==" data-blur-id=menu-blur></script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"><img id=background-image src="https://images.unsplash.com/photo-1579548122080-c35fd6820ecb?w=1200&amp;q=85" role=presentation loading=eager decoding=async fetchpriority=high class="absolute inset-0 w-full h-full object-cover"><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-xl bg-neutral-100/75 dark:bg-neutral-800/60"></div><script type=text/javascript src=/js/background-blur.min.00a57c73ea12f2cab2980c3c3d649e89f6d82f190f74bbe2b67f2f5e39ab7d032ece47086400ca05396758aace13299da49aca43ea643d2625e62c506267a169.js integrity="sha512-AKV8c+oS8sqymAw8PWSeifbYLxkPdLvitn8vXjmrfQMuzkcIZADKBTlnWKrOEymdpJrKQ+pkPSYl5ixQYmehaQ==" data-blur-id=background-blur data-image-id=background-image data-image-url="https://images.unsplash.com/photo-1579548122080-c35fd6820ecb?w=1200&amp;q=85"></script><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Memoizzazione in Go: Caching di Computazioni Costose nel Modo Corretto</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2023-01-16T21:07:26+01:00>16 gennaio 2023</time><span class="px-2 text-primary-500">&#183;</span><span title="Tempo di lettura">7 minuti</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/it/tags/golang/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Golang</span></span></a></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ms-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs"><div class="toc ps-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain bf-scrollbar rounded-lg -ms-5 ps-5 pe-2 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Indice dei contenuti</summary><div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#la-baseline-con-fibonacci>La baseline con Fibonacci</a></li><li><a href=#il-problema-della-data-race>Il problema della data race</a></li><li><a href=#memoizzazione-generica-go-118>Memoizzazione generica (Go 1.18+)</a></li><li><a href=#caso-duso-reale-chiamata-api-con-ttl>Caso d&rsquo;uso reale: chiamata API con TTL</a></li><li><a href=#quando-non-memoizzare>Quando NON memoizzare</a></li><li><a href=#benchmark>Benchmark</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Indice dei contenuti</summary><div class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#la-baseline-con-fibonacci>La baseline con Fibonacci</a></li><li><a href=#il-problema-della-data-race>Il problema della data race</a></li><li><a href=#memoizzazione-generica-go-118>Memoizzazione generica (Go 1.18+)</a></li><li><a href=#caso-duso-reale-chiamata-api-con-ttl>Caso d&rsquo;uso reale: chiamata API con TTL</a></li><li><a href=#quando-non-memoizzare>Quando NON memoizzare</a></li><li><a href=#benchmark>Benchmark</a></li></ul></nav></div></details><script>(function(){"use strict";const s=.33,o="#TableOfContents",i=".anchor",a='a[href^="#"]',r="li ul",c="active";let t=!1;function l(e,n){const o=window.scrollY+window.innerHeight*n,i=[...document.querySelectorAll('#TableOfContents a[href^="#"]')],s=new Set(i.map(e=>e.getAttribute("href").substring(1)));if(t)for(let t=0;t<e.length;t++){const n=e[t];if(!s.has(n.id))continue;const o=n.getBoundingClientRect().top+window.scrollY;if(Math.abs(window.scrollY-o)<100)return n.id}for(let t=e.length-1;t>=0;t--){const n=e[t].getBoundingClientRect().top+window.scrollY;if(n<=o&&s.has(e[t].id))return e[t].id}return e.find(e=>s.has(e.id))?.id||""}function e({toc:e,anchors:t,links:n,scrollOffset:s,collapseInactive:o}){const i=l(t,s);if(!i)return;if(n.forEach(e=>{const t=e.getAttribute("href")===`#${i}`;if(e.classList.toggle(c,t),o){const n=e.closest("li")?.querySelector("ul");n&&(n.style.display=t?"":"none")}}),o){const n=e.querySelector(`a[href="#${CSS.escape(i)}"]`);let t=n;for(;t&&t!==e;)t.tagName==="UL"&&(t.style.display=""),t.tagName==="LI"&&t.querySelector("ul")?.style.setProperty("display",""),t=t.parentElement}}function n(){const n=document.querySelector(o);if(!n)return;const l=!0,u=[...document.querySelectorAll(i)],d=[...n.querySelectorAll(a)];l&&n.querySelectorAll(r).forEach(e=>e.style.display="none"),d.forEach(e=>{e.addEventListener("click",()=>{t=!0})});const c={toc:n,anchors:u,links:d,scrollOffset:s,collapseInactive:l};window.addEventListener("scroll",()=>e(c),{passive:!0}),window.addEventListener("hashchange",()=>e(c),{passive:!0}),e(c)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n()})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><div class="lead text-neutral-500 dark:text-neutral-400 !mb-9 text-xl">La memoizzazione e la tecnica di ottimizzazione che consiste nel fare il caching del valore restituito da una funzione pura, in modo che le chiamate ripetute con gli stessi input saltino completamente la computazione. Si applica ogni volta che una funzione e costosa, deterministica e chiamata piu volte con gli stessi argomenti. Fatta correttamente in Go richiede un mutex, e nel codice moderno un wrapper generico la rende riutilizzabile su piu tipi.</div><p>La memoizzazione viene spesso introdotta con Fibonacci perche l&rsquo;esplosione ricorsiva e facile da visualizzare. Ma le applicazioni reali in produzione sono altrove: controlli dei permessi che accedono a un database, lookup di configurazione su rete, o costose computazioni crittografiche. Questo post copre il quadro completo: dall&rsquo;implementazione di base alla prevenzione delle data race, ai wrapper generici e all&rsquo;invalidazione con time-to-live (TTL).</p><h2 class="relative group">La baseline con Fibonacci<div id=la-baseline-con-fibonacci class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#la-baseline-con-fibonacci aria-label=Ancora>#</a></span></h2><p>Il classico Fibonacci ricorsivo ha complessita temporale esponenziale. Ricalcola <code>fib(n-2)</code> da zero ogni volta, anche se ha gia calcolato quel valore poco prima.</p><div class=highlight-wrapper><div class=codeblock-title>fib_naive.go</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#616e87;font-style:italic>// fib ha complessita O(2^n). Chiamare fib(40) esegue ~2 miliardi di chiamate.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#88c0d0>fib</span><span style=color:#eceff4>(</span>n <span style=color:#81a1c1>int</span><span style=color:#eceff4>)</span> <span style=color:#81a1c1>int</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>if</span> n <span style=color:#81a1c1>&lt;=</span> <span style=color:#b48ead>1</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>return</span> n
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#88c0d0>fib</span><span style=color:#eceff4>(</span>n<span style=color:#81a1c1>-</span><span style=color:#b48ead>1</span><span style=color:#eceff4>)</span> <span style=color:#81a1c1>+</span> <span style=color:#88c0d0>fib</span><span style=color:#eceff4>(</span>n<span style=color:#81a1c1>-</span><span style=color:#b48ead>2</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span></span></span></code></pre></div></div><p>Una semplice cache con mappa elimina il lavoro ridondante:</p><div class=highlight-wrapper><div class=codeblock-title>fib_memo.go</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>var</span> fibCache <span style=color:#eceff4>=</span> <span style=color:#81a1c1>make</span><span style=color:#eceff4>(</span><span style=color:#81a1c1;font-weight:700>map</span><span style=color:#eceff4>[</span><span style=color:#81a1c1>int</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>int</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#88c0d0>fib</span><span style=color:#eceff4>(</span>n <span style=color:#81a1c1>int</span><span style=color:#eceff4>)</span> <span style=color:#81a1c1>int</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>if</span> n <span style=color:#81a1c1>&lt;=</span> <span style=color:#b48ead>1</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>return</span> n
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>if</span> v<span style=color:#eceff4>,</span> ok <span style=color:#81a1c1>:=</span> fibCache<span style=color:#eceff4>[</span>n<span style=color:#eceff4>];</span> ok <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>return</span> v
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    result <span style=color:#81a1c1>:=</span> <span style=color:#88c0d0>fib</span><span style=color:#eceff4>(</span>n<span style=color:#81a1c1>-</span><span style=color:#b48ead>1</span><span style=color:#eceff4>)</span> <span style=color:#81a1c1>+</span> <span style=color:#88c0d0>fib</span><span style=color:#eceff4>(</span>n<span style=color:#81a1c1>-</span><span style=color:#b48ead>2</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    fibCache<span style=color:#eceff4>[</span>n<span style=color:#eceff4>]</span> <span style=color:#eceff4>=</span> result
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> result
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span></span></span></code></pre></div></div><p>La complessita temporale scende a O(n). Il problema e che questo codice ha una data race.</p><h2 class="relative group">Il problema della data race<div id=il-problema-della-data-race class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#il-problema-della-data-race aria-label=Ancora>#</a></span></h2><p>La mappa globale <code>fibCache</code> viene letta e scritta da ogni chiamata a <code>fib</code>. In un programma sequenziale questo funziona. In qualsiasi programma in cui <code>fib</code> viene chiamata da piu goroutine in modo concorrente, e un comportamento indefinito. La mappa di Go non e sicura per l&rsquo;accesso concorrente.</p><p>Esegui il race detector e la vedrai immediatamente:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go <span style=color:#81a1c1>test</span> -race ./...</span></span></code></pre></div></div><p>La soluzione e un <code>sync.RWMutex</code>. Le letture acquisiscono il read lock (piu lettori simultanei consentiti). Le scritture acquisiscono il write lock esclusivo.</p><div class=highlight-wrapper><div class=codeblock-title>fib_safe.go</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>package</span> fib
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#a3be8c>&#34;sync&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>type</span> memoFib <span style=color:#81a1c1;font-weight:700>struct</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    mu    sync<span style=color:#eceff4>.</span>RWMutex
</span></span><span style=display:flex><span>    cache <span style=color:#81a1c1;font-weight:700>map</span><span style=color:#eceff4>[</span><span style=color:#81a1c1>int</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>int</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#88c0d0>newMemoFib</span><span style=color:#eceff4>()</span> <span style=color:#81a1c1>*</span>memoFib <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1>&amp;</span>memoFib<span style=color:#eceff4>{</span>cache<span style=color:#eceff4>:</span> <span style=color:#81a1c1>make</span><span style=color:#eceff4>(</span><span style=color:#81a1c1;font-weight:700>map</span><span style=color:#eceff4>[</span><span style=color:#81a1c1>int</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>int</span><span style=color:#eceff4>)}</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#eceff4>(</span>m <span style=color:#81a1c1>*</span>memoFib<span style=color:#eceff4>)</span> <span style=color:#88c0d0>compute</span><span style=color:#eceff4>(</span>n <span style=color:#81a1c1>int</span><span style=color:#eceff4>)</span> <span style=color:#81a1c1>int</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>if</span> n <span style=color:#81a1c1>&lt;=</span> <span style=color:#b48ead>1</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>return</span> n
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    m<span style=color:#eceff4>.</span>mu<span style=color:#eceff4>.</span><span style=color:#88c0d0>RLock</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>if</span> v<span style=color:#eceff4>,</span> ok <span style=color:#81a1c1>:=</span> m<span style=color:#eceff4>.</span>cache<span style=color:#eceff4>[</span>n<span style=color:#eceff4>];</span> ok <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        m<span style=color:#eceff4>.</span>mu<span style=color:#eceff4>.</span><span style=color:#88c0d0>RUnlock</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>return</span> v
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    m<span style=color:#eceff4>.</span>mu<span style=color:#eceff4>.</span><span style=color:#88c0d0>RUnlock</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#616e87;font-style:italic>// Calcola senza il lock (questo e sicuro perche fib e pura).</span>
</span></span><span style=display:flex><span>    result <span style=color:#81a1c1>:=</span> m<span style=color:#eceff4>.</span><span style=color:#88c0d0>compute</span><span style=color:#eceff4>(</span>n<span style=color:#81a1c1>-</span><span style=color:#b48ead>1</span><span style=color:#eceff4>)</span> <span style=color:#81a1c1>+</span> m<span style=color:#eceff4>.</span><span style=color:#88c0d0>compute</span><span style=color:#eceff4>(</span>n<span style=color:#81a1c1>-</span><span style=color:#b48ead>2</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    m<span style=color:#eceff4>.</span>mu<span style=color:#eceff4>.</span><span style=color:#88c0d0>Lock</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>    m<span style=color:#eceff4>.</span>cache<span style=color:#eceff4>[</span>n<span style=color:#eceff4>]</span> <span style=color:#eceff4>=</span> result
</span></span><span style=display:flex><span>    m<span style=color:#eceff4>.</span>mu<span style=color:#eceff4>.</span><span style=color:#88c0d0>Unlock</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> result
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span></span></span></code></pre></div></div><div class="admonition relative overflow-hidden rounded-lg border-l-4 my-3 px-4 py-3 shadow-sm" data-type=warning><div class="flex items-center gap-2 font-semibold text-inherit"><div class="flex shrink-0 h-5 w-5 items-center justify-center text-lg"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M506.3 417 293 53c-16.33-28-57.54-28-73.98.0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6c32.76.0 53.26-35 36.96-63zM232 168c0-13.25 10.75-24 24-24s24 10.8 24 24v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zm24 248c-17.36.0-31.44-14.08-31.44-31.44s14.07-31.44 31.44-31.44 31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg></span></div><div class=grow>Avviso</div></div><div class="admonition-content mt-3 text-base leading-relaxed text-inherit"><p>Non tenere mai un mutex durante una computazione costosa. Nell&rsquo;esempio sopra, il lock viene rilasciato prima delle chiamate ricorsive e riacquisito solo per la scrittura. Tenere il write lock durante la ricorsione causerebbe un deadlock perche le chiamate annidate cercherebbero di acquisire lo stesso lock.</p></div></div><p>Un&rsquo;alternativa per il caso a singolo risultato e <code>sync.Map</code>, ottimizzata per workload read-heavy ma con un&rsquo;API meno ergonomica e prestazioni peggiori quando le scritture sono frequenti.</p><h2 class="relative group">Memoizzazione generica (Go 1.18+)<div id=memoizzazione-generica-go-118 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#memoizzazione-generica-go-118 aria-label=Ancora>#</a></span></h2><p>Scrivere una nuova struct memoizzata per ogni tipo di funzione e ripetitivo. Con i generics di Go puoi scrivere un unico wrapper riutilizzabile:</p><div class=highlight-wrapper><div class=codeblock-title>memo/memo.go</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>package</span> memo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#a3be8c>&#34;sync&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// Cache is a thread-safe memoization cache for a function of type func(K) (V, error).</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>type</span> Cache<span style=color:#eceff4>[</span>K comparable<span style=color:#eceff4>,</span> V <span style=color:#81a1c1>any</span><span style=color:#eceff4>]</span> <span style=color:#81a1c1;font-weight:700>struct</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    mu    sync<span style=color:#eceff4>.</span>Mutex
</span></span><span style=display:flex><span>    cache <span style=color:#81a1c1;font-weight:700>map</span><span style=color:#eceff4>[</span>K<span style=color:#eceff4>]</span>result<span style=color:#eceff4>[</span>V<span style=color:#eceff4>]</span>
</span></span><span style=display:flex><span>    fn    <span style=color:#81a1c1;font-weight:700>func</span><span style=color:#eceff4>(</span>K<span style=color:#eceff4>)</span> <span style=color:#eceff4>(</span>V<span style=color:#eceff4>,</span> <span style=color:#81a1c1>error</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>type</span> result<span style=color:#eceff4>[</span>V <span style=color:#81a1c1>any</span><span style=color:#eceff4>]</span> <span style=color:#81a1c1;font-weight:700>struct</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    value V
</span></span><span style=display:flex><span>    err   <span style=color:#81a1c1>error</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// New creates a Cache wrapping fn. Calls to Get will invoke fn at most once per key.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> New<span style=color:#eceff4>[</span>K comparable<span style=color:#eceff4>,</span> V <span style=color:#81a1c1>any</span><span style=color:#eceff4>](</span>fn <span style=color:#81a1c1;font-weight:700>func</span><span style=color:#eceff4>(</span>K<span style=color:#eceff4>)</span> <span style=color:#eceff4>(</span>V<span style=color:#eceff4>,</span> <span style=color:#81a1c1>error</span><span style=color:#eceff4>))</span> <span style=color:#81a1c1>*</span>Cache<span style=color:#eceff4>[</span>K<span style=color:#eceff4>,</span> V<span style=color:#eceff4>]</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1>&amp;</span>Cache<span style=color:#eceff4>[</span>K<span style=color:#eceff4>,</span> V<span style=color:#eceff4>]{</span>
</span></span><span style=display:flex><span>        cache<span style=color:#eceff4>:</span> <span style=color:#81a1c1>make</span><span style=color:#eceff4>(</span><span style=color:#81a1c1;font-weight:700>map</span><span style=color:#eceff4>[</span>K<span style=color:#eceff4>]</span>result<span style=color:#eceff4>[</span>V<span style=color:#eceff4>]),</span>
</span></span><span style=display:flex><span>        fn<span style=color:#eceff4>:</span>    fn<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// Get returns the memoized result for key, calling fn(key) if needed.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#eceff4>(</span>c <span style=color:#81a1c1>*</span>Cache<span style=color:#eceff4>[</span>K<span style=color:#eceff4>,</span> V<span style=color:#eceff4>])</span> <span style=color:#88c0d0>Get</span><span style=color:#eceff4>(</span>key K<span style=color:#eceff4>)</span> <span style=color:#eceff4>(</span>V<span style=color:#eceff4>,</span> <span style=color:#81a1c1>error</span><span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    c<span style=color:#eceff4>.</span>mu<span style=color:#eceff4>.</span><span style=color:#88c0d0>Lock</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>defer</span> c<span style=color:#eceff4>.</span>mu<span style=color:#eceff4>.</span><span style=color:#88c0d0>Unlock</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>if</span> r<span style=color:#eceff4>,</span> ok <span style=color:#81a1c1>:=</span> c<span style=color:#eceff4>.</span>cache<span style=color:#eceff4>[</span>key<span style=color:#eceff4>];</span> ok <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>return</span> r<span style=color:#eceff4>.</span>value<span style=color:#eceff4>,</span> r<span style=color:#eceff4>.</span>err
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#616e87;font-style:italic>// Rilascia il lock durante la chiamata costosa.</span>
</span></span><span style=display:flex><span>    <span style=color:#616e87;font-style:italic>// Usa singleflight in produzione per la deduplication sotto carico concorrente.</span>
</span></span><span style=display:flex><span>    c<span style=color:#eceff4>.</span>mu<span style=color:#eceff4>.</span><span style=color:#88c0d0>Unlock</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>    v<span style=color:#eceff4>,</span> err <span style=color:#81a1c1>:=</span> c<span style=color:#eceff4>.</span><span style=color:#88c0d0>fn</span><span style=color:#eceff4>(</span>key<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    c<span style=color:#eceff4>.</span>mu<span style=color:#eceff4>.</span><span style=color:#88c0d0>Lock</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    c<span style=color:#eceff4>.</span>cache<span style=color:#eceff4>[</span>key<span style=color:#eceff4>]</span> <span style=color:#eceff4>=</span> result<span style=color:#eceff4>[</span>V<span style=color:#eceff4>]{</span>value<span style=color:#eceff4>:</span> v<span style=color:#eceff4>,</span> err<span style=color:#eceff4>:</span> err<span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> v<span style=color:#eceff4>,</span> err
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span></span></span></code></pre></div></div><p>L&rsquo;utilizzo e pulito e type-safe:</p><div class=highlight-wrapper><div class=codeblock-title>usage example</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>fetchPrice <span style=color:#81a1c1>:=</span> memo<span style=color:#eceff4>.</span><span style=color:#88c0d0>New</span><span style=color:#eceff4>(</span><span style=color:#81a1c1;font-weight:700>func</span><span style=color:#eceff4>(</span>ticker <span style=color:#81a1c1>string</span><span style=color:#eceff4>)</span> <span style=color:#eceff4>(</span><span style=color:#81a1c1>float64</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1>error</span><span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> marketAPI<span style=color:#eceff4>.</span><span style=color:#88c0d0>GetPrice</span><span style=color:#eceff4>(</span>ticker<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>})</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>price<span style=color:#eceff4>,</span> err <span style=color:#81a1c1>:=</span> fetchPrice<span style=color:#eceff4>.</span><span style=color:#88c0d0>Get</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;AAPL&#34;</span><span style=color:#eceff4>)</span></span></span></code></pre></div></div><div class="admonition relative overflow-hidden rounded-lg border-l-4 my-3 px-4 py-3 shadow-sm" data-type=note><div class="flex items-center gap-2 font-semibold text-inherit"><div class="flex shrink-0 h-5 w-5 items-center justify-center text-lg"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 0C114.6.0.0 114.6.0 256s114.6 256 256 256 256-114.6 256-256S397.4.0 256 0zm0 128c17.67.0 32 14.33 32 32 0 17.67-14.33 32-32 32s-32-14.3-32-32 14.3-32 32-32zm40 256h-80c-13.2.0-24-10.7-24-24s10.75-24 24-24h16v-64h-8c-13.25.0-24-10.75-24-24s10.8-24 24-24h32c13.25.0 24 10.75 24 24v88h16c13.25.0 24 10.75 24 24s-10.7 24-24 24z"/></svg></span></div><div class=grow>Nota</div></div><div class="admonition-content mt-3 text-base leading-relaxed text-inherit"><p>Il <code>Cache</code> generico sopra usa un singolo mutex e sblocca durante la chiamata alla funzione per evitare di tenere il lock durante I/O. Sotto carico concorrente molto alto per la stessa chiave, due goroutine potrebbero entrambe chiamare <code>fn(key)</code> prima che una delle due memorizzi il risultato. Per vera deduplication usa <code>golang.org/x/sync/singleflight</code>.</p></div></div><h2 class="relative group">Caso d&rsquo;uso reale: chiamata API con TTL<div id=caso-duso-reale-chiamata-api-con-ttl class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#caso-duso-reale-chiamata-api-con-ttl aria-label=Ancora>#</a></span></h2><p>Memoizzare una chiamata API per sempre e raramente sicuro. Configurazione, permessi e feature flag cambiano. Hai bisogno di invalidazione basata sul tempo.</p><div class=highlight-wrapper><div class=codeblock-title>memo/ttl_cache.go</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>package</span> memo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#eceff4>(</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>&#34;sync&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>&#34;time&#34;</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>type</span> entry<span style=color:#eceff4>[</span>V <span style=color:#81a1c1>any</span><span style=color:#eceff4>]</span> <span style=color:#81a1c1;font-weight:700>struct</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    value     V
</span></span><span style=display:flex><span>    err       <span style=color:#81a1c1>error</span>
</span></span><span style=display:flex><span>    expiresAt time<span style=color:#eceff4>.</span>Time
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// TTLCache memoizes function results for a fixed duration.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>type</span> TTLCache<span style=color:#eceff4>[</span>K comparable<span style=color:#eceff4>,</span> V <span style=color:#81a1c1>any</span><span style=color:#eceff4>]</span> <span style=color:#81a1c1;font-weight:700>struct</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    mu    sync<span style=color:#eceff4>.</span>Mutex
</span></span><span style=display:flex><span>    cache <span style=color:#81a1c1;font-weight:700>map</span><span style=color:#eceff4>[</span>K<span style=color:#eceff4>]</span>entry<span style=color:#eceff4>[</span>V<span style=color:#eceff4>]</span>
</span></span><span style=display:flex><span>    fn    <span style=color:#81a1c1;font-weight:700>func</span><span style=color:#eceff4>(</span>K<span style=color:#eceff4>)</span> <span style=color:#eceff4>(</span>V<span style=color:#eceff4>,</span> <span style=color:#81a1c1>error</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    ttl   time<span style=color:#eceff4>.</span>Duration
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> NewTTL<span style=color:#eceff4>[</span>K comparable<span style=color:#eceff4>,</span> V <span style=color:#81a1c1>any</span><span style=color:#eceff4>](</span>fn <span style=color:#81a1c1;font-weight:700>func</span><span style=color:#eceff4>(</span>K<span style=color:#eceff4>)</span> <span style=color:#eceff4>(</span>V<span style=color:#eceff4>,</span> <span style=color:#81a1c1>error</span><span style=color:#eceff4>),</span> ttl time<span style=color:#eceff4>.</span>Duration<span style=color:#eceff4>)</span> <span style=color:#81a1c1>*</span>TTLCache<span style=color:#eceff4>[</span>K<span style=color:#eceff4>,</span> V<span style=color:#eceff4>]</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1>&amp;</span>TTLCache<span style=color:#eceff4>[</span>K<span style=color:#eceff4>,</span> V<span style=color:#eceff4>]{</span>
</span></span><span style=display:flex><span>        cache<span style=color:#eceff4>:</span> <span style=color:#81a1c1>make</span><span style=color:#eceff4>(</span><span style=color:#81a1c1;font-weight:700>map</span><span style=color:#eceff4>[</span>K<span style=color:#eceff4>]</span>entry<span style=color:#eceff4>[</span>V<span style=color:#eceff4>]),</span>
</span></span><span style=display:flex><span>        fn<span style=color:#eceff4>:</span>    fn<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>        ttl<span style=color:#eceff4>:</span>   ttl<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#eceff4>(</span>c <span style=color:#81a1c1>*</span>TTLCache<span style=color:#eceff4>[</span>K<span style=color:#eceff4>,</span> V<span style=color:#eceff4>])</span> <span style=color:#88c0d0>Get</span><span style=color:#eceff4>(</span>key K<span style=color:#eceff4>)</span> <span style=color:#eceff4>(</span>V<span style=color:#eceff4>,</span> <span style=color:#81a1c1>error</span><span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    c<span style=color:#eceff4>.</span>mu<span style=color:#eceff4>.</span><span style=color:#88c0d0>Lock</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>if</span> e<span style=color:#eceff4>,</span> ok <span style=color:#81a1c1>:=</span> c<span style=color:#eceff4>.</span>cache<span style=color:#eceff4>[</span>key<span style=color:#eceff4>];</span> ok <span style=color:#81a1c1>&amp;&amp;</span> time<span style=color:#eceff4>.</span><span style=color:#88c0d0>Now</span><span style=color:#eceff4>().</span><span style=color:#88c0d0>Before</span><span style=color:#eceff4>(</span>e<span style=color:#eceff4>.</span>expiresAt<span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        c<span style=color:#eceff4>.</span>mu<span style=color:#eceff4>.</span><span style=color:#88c0d0>Unlock</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>return</span> e<span style=color:#eceff4>.</span>value<span style=color:#eceff4>,</span> e<span style=color:#eceff4>.</span>err
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    c<span style=color:#eceff4>.</span>mu<span style=color:#eceff4>.</span><span style=color:#88c0d0>Unlock</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    v<span style=color:#eceff4>,</span> err <span style=color:#81a1c1>:=</span> c<span style=color:#eceff4>.</span><span style=color:#88c0d0>fn</span><span style=color:#eceff4>(</span>key<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    c<span style=color:#eceff4>.</span>mu<span style=color:#eceff4>.</span><span style=color:#88c0d0>Lock</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>    c<span style=color:#eceff4>.</span>cache<span style=color:#eceff4>[</span>key<span style=color:#eceff4>]</span> <span style=color:#eceff4>=</span> entry<span style=color:#eceff4>[</span>V<span style=color:#eceff4>]{</span>
</span></span><span style=display:flex><span>        value<span style=color:#eceff4>:</span>     v<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>        err<span style=color:#eceff4>:</span>       err<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>        expiresAt<span style=color:#eceff4>:</span> time<span style=color:#eceff4>.</span><span style=color:#88c0d0>Now</span><span style=color:#eceff4>().</span><span style=color:#88c0d0>Add</span><span style=color:#eceff4>(</span>c<span style=color:#eceff4>.</span>ttl<span style=color:#eceff4>),</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    c<span style=color:#eceff4>.</span>mu<span style=color:#eceff4>.</span><span style=color:#88c0d0>Unlock</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> v<span style=color:#eceff4>,</span> err
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span></span></span></code></pre></div></div><p>Un controllo dei permessi che altrimenti colpirebbe il database ad ogni richiesta ora lo colpisce al massimo una volta al minuto:</p><div class=highlight-wrapper><div class=codeblock-title>permission service</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>var</span> permCache <span style=color:#eceff4>=</span> memo<span style=color:#eceff4>.</span><span style=color:#88c0d0>NewTTL</span><span style=color:#eceff4>(</span><span style=color:#81a1c1;font-weight:700>func</span><span style=color:#eceff4>(</span>userID <span style=color:#81a1c1>string</span><span style=color:#eceff4>)</span> <span style=color:#eceff4>([]</span><span style=color:#81a1c1>string</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1>error</span><span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> db<span style=color:#eceff4>.</span><span style=color:#88c0d0>GetUserPermissions</span><span style=color:#eceff4>(</span>context<span style=color:#eceff4>.</span><span style=color:#88c0d0>Background</span><span style=color:#eceff4>(),</span> userID<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>},</span> time<span style=color:#eceff4>.</span>Minute<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#88c0d0>hasPermission</span><span style=color:#eceff4>(</span>userID<span style=color:#eceff4>,</span> action <span style=color:#81a1c1>string</span><span style=color:#eceff4>)</span> <span style=color:#eceff4>(</span><span style=color:#81a1c1>bool</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1>error</span><span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    perms<span style=color:#eceff4>,</span> err <span style=color:#81a1c1>:=</span> permCache<span style=color:#eceff4>.</span><span style=color:#88c0d0>Get</span><span style=color:#eceff4>(</span>userID<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>if</span> err <span style=color:#81a1c1>!=</span> <span style=color:#81a1c1;font-weight:700>nil</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1;font-weight:700>false</span><span style=color:#eceff4>,</span> err
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> slices<span style=color:#eceff4>.</span><span style=color:#88c0d0>Contains</span><span style=color:#eceff4>(</span>perms<span style=color:#eceff4>,</span> action<span style=color:#eceff4>),</span> <span style=color:#81a1c1;font-weight:700>nil</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span></span></span></code></pre></div></div><h2 class="relative group">Quando NON memoizzare<div id=quando-non-memoizzare class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#quando-non-memoizzare aria-label=Ancora>#</a></span></h2><div id=accordion-70b365a23061746e65efaf03e9362f04 class="border border-neutral-200 dark:border-neutral-700 rounded-lg overflow-hidden" data-accordion=collapse data-accordion-separated=false><details class=border-none data-accordion-item><summary class="flex w-full cursor-pointer items-center justify-between gap-4 px-4 py-3 text-left text-lg font-semibold text-neutral-900 dark:text-neutral-100"><span class="flex items-center gap-2"><span>Funzioni con effetti collaterali</span>
</span><span><span class="relative block icon"><svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></summary><div class="px-4 pb-4 text-neutral-700 dark:text-neutral-300">La memoizzazione salta il corpo della funzione su cache hit. Se la funzione invia un&rsquo;email, scrive su un database o incrementa un contatore, quegli effetti collaterali non avverranno nelle chiamate ripetute. Memoizza solo funzioni pure o funzioni il cui unico effetto osservabile e il loro valore di ritorno.</div></details><details class=border-none data-accordion-item><summary class="flex w-full cursor-pointer items-center justify-between gap-4 px-4 py-3 text-left text-lg font-semibold text-neutral-900 dark:text-neutral-100"><span class="flex items-center gap-2"><span>Funzioni con input grandi o illimitati</span>
</span><span><span class="relative block icon"><svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></summary><div class="px-4 pb-4 text-neutral-700 dark:text-neutral-300">Fare il caching di ogni set di input unico per una funzione che accetta input stringa arbitrario fara crescere la cache senza limiti. O limita la dimensione della cache con una politica di eviction LRU o aggiungi l&rsquo;invalidazione TTL. La libreria standard non ha un LRU built-in; usa <code>golang.org/x/exp/cache</code> o un&rsquo;implementazione di terze parti ben mantenuta.</div></details><details class=border-none data-accordion-item><summary class="flex w-full cursor-pointer items-center justify-between gap-4 px-4 py-3 text-left text-lg font-semibold text-neutral-900 dark:text-neutral-100"><span class="flex items-center gap-2"><span>Funzioni gia veloci di per se</span>
</span><span><span class="relative block icon"><svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></summary><div class="px-4 pb-4 text-neutral-700 dark:text-neutral-300">La memoizzazione introduce un&rsquo;acquisizione del mutex e un lookup nella mappa ad ogni chiamata. Per una funzione che gia si completa in nanosecondi, questo overhead puo superare i risparmi. Esegui un benchmark prima e dopo.</div></details><details class=border-none data-accordion-item><summary class="flex w-full cursor-pointer items-center justify-between gap-4 px-4 py-3 text-left text-lg font-semibold text-neutral-900 dark:text-neutral-100"><span class="flex items-center gap-2"><span>Mutazione concorrente del valore cached</span>
</span><span><span class="relative block icon"><svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></summary><div class="px-4 pb-4 text-neutral-700 dark:text-neutral-300">Se il valore cached e un puntatore a una struct che i chiamanti modificano dopo averla ricevuta, due chiamanti che condividono lo stesso puntatore cached vedranno le mutazioni dell&rsquo;altro. Fai il cache di valori immutabili (stringhe, interi, copie di struct) o restituisci una deep copy.</div></details></div><style>#accordion-70b365a23061746e65efaf03e9362f04>details+details{border-top:1px solid rgb(var(--color-neutral-200))}.dark #accordion-70b365a23061746e65efaf03e9362f04>details+details{border-top-color:rgb(var(--color-neutral-700))}</style><script>(()=>{const e=document.getElementById("accordion-70b365a23061746e65efaf03e9362f04");if(!e)return;const t=e.querySelectorAll("details[data-accordion-item]");t.forEach(e=>{e.addEventListener("toggle",()=>{if(!e.open)return;t.forEach(t=>{t!==e&&t.removeAttribute("open")})})})})()</script><h2 class="relative group">Benchmark<div id=benchmark class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#benchmark aria-label=Ancora>#</a></span></h2><p>Ecco un benchmark che quantifica il miglioramento delle prestazioni dalla memoizzazione su Fibonacci:</p><div class=highlight-wrapper><div class=codeblock-title>fib_bench_test.go</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>package</span> fib_test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#eceff4>(</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>&#34;testing&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>&#34;github.com/yourorg/fib&#34;</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#88c0d0>BenchmarkFibNaive</span><span style=color:#eceff4>(</span>b <span style=color:#81a1c1>*</span>testing<span style=color:#eceff4>.</span>B<span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>for</span> i <span style=color:#81a1c1>:=</span> <span style=color:#b48ead>0</span><span style=color:#eceff4>;</span> i <span style=color:#eceff4>&lt;</span> b<span style=color:#eceff4>.</span>N<span style=color:#eceff4>;</span> i<span style=color:#81a1c1>++</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        fib<span style=color:#eceff4>.</span><span style=color:#88c0d0>Naive</span><span style=color:#eceff4>(</span><span style=color:#b48ead>30</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#88c0d0>BenchmarkFibMemo</span><span style=color:#eceff4>(</span>b <span style=color:#81a1c1>*</span>testing<span style=color:#eceff4>.</span>B<span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    m <span style=color:#81a1c1>:=</span> fib<span style=color:#eceff4>.</span><span style=color:#88c0d0>NewMemo</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>    <span style=color:#616e87;font-style:italic>// Riscalda la cache prima di misurare.</span>
</span></span><span style=display:flex><span>    m<span style=color:#eceff4>.</span><span style=color:#88c0d0>Compute</span><span style=color:#eceff4>(</span><span style=color:#b48ead>30</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    b<span style=color:#eceff4>.</span><span style=color:#88c0d0>ResetTimer</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>for</span> i <span style=color:#81a1c1>:=</span> <span style=color:#b48ead>0</span><span style=color:#eceff4>;</span> i <span style=color:#eceff4>&lt;</span> b<span style=color:#eceff4>.</span>N<span style=color:#eceff4>;</span> i<span style=color:#81a1c1>++</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        m<span style=color:#eceff4>.</span><span style=color:#88c0d0>Compute</span><span style=color:#eceff4>(</span><span style=color:#b48ead>30</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span></span></span></code></pre></div></div><p>Output di esempio:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>BenchmarkFibNaive-10    1000    1,832,455 ns/op    0 B/op    0 allocs/op
</span></span><span style=display:flex><span>BenchmarkFibMemo-10     1000000000    0.87 ns/op   0 B/op    0 allocs/op</span></span></code></pre></div></div><p>La versione memoizzata e circa due milioni di volte piu veloce per <code>fib(30)</code>. La differenza cresce esponenzialmente con n.</p><div class="admonition relative overflow-hidden rounded-lg border-l-4 my-3 px-4 py-3 shadow-sm" data-type=note><div class="flex items-center gap-2 font-semibold text-inherit"><div class="flex shrink-0 h-5 w-5 items-center justify-center text-lg"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 0C114.6.0.0 114.6.0 256s114.6 256 256 256 256-114.6 256-256S397.4.0 256 0zm0 128c17.67.0 32 14.33 32 32 0 17.67-14.33 32-32 32s-32-14.3-32-32 14.3-32 32-32zm40 256h-80c-13.2.0-24-10.7-24-24s10.75-24 24-24h16v-64h-8c-13.25.0-24-10.75-24-24s10.8-24 24-24h32c13.25.0 24 10.75 24 24v88h16c13.25.0 24 10.75 24 24s-10.7 24-24 24z"/></svg></span></div><div class=grow>Nota</div></div><div class="admonition-content mt-3 text-base leading-relaxed text-inherit"><p><strong>Memoizzazione vs caching</strong>: questi termini vengono spesso usati in modo intercambiabile ma hanno una distinzione precisa. La memoizzazione e un&rsquo;ottimizzazione specifica per le funzioni pure: dati gli stessi input, produce sempre lo stesso output, quindi fai il cache. Il caching e il concetto piu ampio di memorizzare dati calcolati o recuperati per evitare di ripetere lavoro costoso. Il caching include politiche di eviction (LRU, LFU), TTL, segnali di invalidazione e layer distribuiti. Tutta la memoizzazione e caching, ma la maggior parte delle cache di produzione non e memoizzazione.</p></div></div><hr><p>Se vuoi approfondire questi argomenti, offro sessioni di coaching 1:1 per ingegneri che lavorano su integrazione AI, architetture cloud e platform engineering. <a href=https://calendly.com/manuelfedele/60min target=_blank rel=noreferrer>Prenota una sessione</a> (50 EUR / 60 min) o scrivimi a <a href=mailto:manuel.fedele+website@gmail.com>manuel.fedele+website@gmail.com</a>.</p></div><h2 class="mt-8 text-2xl font-extrabold mb-10">Articoli correlati</h2><section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3"><article class="article-link--related relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600"><div class="flex-none relative overflow-hidden thumbnail_card_related"><img src="https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?w=1200&amp;q=85" role=presentation loading=lazy decoding=async fetchpriority=low class="not-prose absolute inset-0 w-full h-full object-cover"></div><div class=p-4><header><a href=/it/posts/trading-with-alpaca-and-golang/ class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2"><h2>Trading algoritmico con Alpaca e Go: paper trading e dati in tempo reale</h2></a></header><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime=2023-01-15T19:24:09+01:00>15 gennaio 2023</time><span class="px-2 text-primary-500">&#183;</span><span title="Tempo di lettura">7 minuti</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/it/tags/alpaca/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Alpaca
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/it/tags/trading/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Trading
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/it/tags/golang/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Golang
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/it/tags/finance/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Finance</span></span></a></div></div></div><div class="px-6 pt-4 pb-2"></div></article><article class="article-link--related relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600"><div class="flex-none relative overflow-hidden thumbnail_card_related"><img src="https://images.unsplash.com/photo-1534972195531-d756b9bfa9f2?w=1200&amp;q=85" role=presentation loading=lazy decoding=async fetchpriority=low class="not-prose absolute inset-0 w-full h-full object-cover"></div><div class=p-4><header><a href=/it/posts/unit-testing-in-golang/ class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2"><h2>Testing in Go: Dai Unit Test ai Mock e ai Benchmark</h2></a></header><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime=2023-01-09T20:49:03+01:00>9 gennaio 2023</time><span class="px-2 text-primary-500">&#183;</span><span title="Tempo di lettura">9 minuti</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/it/tags/testing/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Testing
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/it/tags/golang/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Golang</span></span></a></div></div></div><div class="px-6 pt-4 pb-2"></div></article><article class="article-link--related relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600"><div class="flex-none relative overflow-hidden thumbnail_card_related"><img src="https://images.unsplash.com/photo-1542751371-adc38448a05e?w=1200&amp;q=85" role=presentation loading=lazy decoding=async fetchpriority=low class="not-prose absolute inset-0 w-full h-full object-cover"></div><div class=p-4><header><a href=/it/posts/streaming-video-with-golang/ class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2"><h2>Video Streaming in Go: Range Request HTTP, Segmenti HLS e FFmpeg</h2></a></header><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime=2023-01-04T21:23:20+01:00>4 gennaio 2023</time><span class="px-2 text-primary-500">&#183;</span><span title="Tempo di lettura">9 minuti</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/it/tags/golang/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Golang
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/it/tags/video-streaming/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Video Streaming
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/it/tags/hls/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Hls
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/it/tags/ffmpeg/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Ffmpeg</span></span></a></div></div></div><div class="px-6 pt-4 pb-2"></div></article><article class="article-link--related relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600"><div class="flex-none relative overflow-hidden thumbnail_card_related"><img src="https://images.unsplash.com/photo-1515879218367-8466d910aaa4?w=1200&amp;q=85" role=presentation loading=lazy decoding=async fetchpriority=low class="not-prose absolute inset-0 w-full h-full object-cover"></div><div class=p-4><header><a href=/it/posts/the-context-package/ class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2"><h2>Il package context di Go: Cancellazione, Timeout e Propagazione in Produzione</h2></a></header><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime=2023-01-03T20:36:29+01:00>3 gennaio 2023</time><span class="px-2 text-primary-500">&#183;</span><span title="Tempo di lettura">8 minuti</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/it/tags/golang/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Golang
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/it/tags/context/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Context</span></span></a></div></div></div><div class="px-6 pt-4 pb-2"></div></article></section></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span class="flex flex-col"><a class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/it/posts/trading-with-alpaca-and-golang/><span class=leading-6><span class="inline-block rtl:rotate-180">&larr;</span>&ensp;Trading algoritmico con Alpaca e Go: paper trading e dati in tempo reale
</span></a><span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2023-01-15T19:24:09+01:00>15 gennaio 2023</time>
</span></span><span class="flex flex-col items-end"><a class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/it/posts/evaluate-chess-position-with-golang/><span class=leading-6>Comunicare con Stockfish da Go: il protocollo UCI&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
</span></a><span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2023-01-19T21:33:41+01:00>19 gennaio 2023</time></span></span></div></div></footer></article><div id=scroll-to-top class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Torna in cima" title="Torna in cima">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2026
Manuel Fedele</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://manuelfedele.github.io/it/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Cerca tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Chiudi (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>