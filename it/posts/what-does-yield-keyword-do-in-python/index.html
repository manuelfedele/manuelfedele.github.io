<!doctype html><html lang=it dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="it"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>Generator e yield in Python: pipeline efficienti in memoria &#183; Git Push and Run</title><meta name=title content="Generator e yield in Python: pipeline efficienti in memoria &#183; Git Push and Run"><meta name=description content="Ingegnere Software e Cloud Architect. Scrivo di Go, Python, AWS e sistemi AI."><meta name=keywords content="python,performance,backend,"><link rel=canonical href=https://manuelfedele.github.io/it/posts/what-does-yield-keyword-do-in-python/><meta name=author content="Manuel Fedele"><link href=https://github.com/manuelfedele rel=me><link href=https://linkedin.com/in/manuel-fedele rel=me><meta property="og:url" content="https://manuelfedele.github.io/it/posts/what-does-yield-keyword-do-in-python/"><meta property="og:site_name" content="Git Push and Run"><meta property="og:title" content="Generator e yield in Python: pipeline efficienti in memoria"><meta property="og:description" content="Un generator è una sequenza lazy. Produce valori uno alla volta su richiesta invece di materializzare tutto in memoria. Per dataset di grandi dimensioni, API di streaming e pipeline di elaborazione dati, i generator sono il default corretto, non un’ottimizzazione da applicare dopo. I generator Python sono una delle funzionalita più praticamente utili del linguaggio e una delle più sottoutilizzate dagli ingegneri che hanno imparato Python dai tutorial web. Questo articolo va oltre il “usa yield invece di return” e copre il quadro completo: il protocollo iteratore, le caratteristiche di memoria, yield from, le pipeline di generator e casi d’uso reali di streaming."><meta property="og:locale" content="it"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-29T10:19:25+01:00"><meta property="article:modified_time" content="2022-12-29T10:19:25+01:00"><meta property="article:tag" content="Python"><meta property="article:tag" content="Performance"><meta property="article:tag" content="Backend"><meta name=twitter:card content="summary"><meta name=twitter:title content="Generator e yield in Python: pipeline efficienti in memoria"><meta name=twitter:description content="Un generator è una sequenza lazy. Produce valori uno alla volta su richiesta invece di materializzare tutto in memoria. Per dataset di grandi dimensioni, API di streaming e pipeline di elaborazione dati, i generator sono il default corretto, non un’ottimizzazione da applicare dopo. I generator Python sono una delle funzionalita più praticamente utili del linguaggio e una delle più sottoutilizzate dagli ingegneri che hanno imparato Python dai tutorial web. Questo articolo va oltre il “usa yield invece di return” e copre il quadro completo: il protocollo iteratore, le caratteristiche di memoria, yield from, le pipeline di generator e casi d’uso reali di streaming."><link type=text/css rel=stylesheet href=/css/main.bundle.min.726dfbf42bcd66e35e2d7258d72fe8fe77509ff76d153e2b46cdbae9c3af9620653459f0119a72d2af4a9b4bc446652d244ad58743d0290e5d8e09e3983b98e5.css integrity="sha512-cm379CvNZuNeLXJY1y/o/ndQn/dtFT4rRs266cOvliBlNFnwEZpy0q9Km0vERmUtJErVh0PQKQ5djgnjmDuY5Q=="><script type=text/javascript src=/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.88278edec77139635e1ad294df5b32b7be9338191c5252d3f6f451ace5852d5f82390cccacedab9c64739d8e068b7e8502895cf8f951060c0368f9a73709fcb7.js integrity="sha512-iCeO3sdxOWNeGtKU31syt76TOBkcUlLT9vRRrOWFLV+COQzMrO2rnGRznY4Gi36FAolc+PlRBgwDaPmnNwn8tw==" data-copy=Copia data-copied=Copiato></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Generator e yield in Python: pipeline efficienti in memoria","headline":"Generator e yield in Python: pipeline efficienti in memoria","inLanguage":"it","url":"https://manuelfedele.github.io/it/posts/what-does-yield-keyword-do-in-python/","author":{"@type":"Person","name":"Manuel Fedele"},"copyrightYear":"2022","dateCreated":"2022-12-29T10:19:25\u002b01:00","datePublished":"2022-12-29T10:19:25\u002b01:00","dateModified":"2022-12-29T10:19:25\u002b01:00","keywords":["python","performance","backend"],"mainEntityOfPage":"true","wordCount":"1685"}]</script></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral bf-scrollbar"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
Salta al contenuto principale</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 z-100"><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl bg-neutral/25 dark:bg-neutral-800/25"></div><div class="relative m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32"><div class="main-menu flex items-center w-full gap-2 p-1 pl-0"><a href=/it/ class="text-base font-medium truncate min-w-0 shrink">Git Push and Run</a><div class="flex items-center ms-auto"><div class="hidden md:flex"><nav class="flex items-center gap-x-5 h-12"><a href=/it/posts/ class="flex items-center bf-icon-color-hover" aria-label=Blog title=Posts><span class="text-base font-medium break-normal">Blog
</span></a><a href=/it/about/ class="flex items-center bf-icon-color-hover" aria-label="Chi sono" title="Chi sono"><span class="text-base font-medium break-normal">Chi sono
</span></a><a href=/it/coaching/ class="flex items-center bf-icon-color-hover" aria-label=Coaching title=Coaching><span class="text-base font-medium break-normal">Coaching
</span></a><a href=https://github.com/manuelfedele target=_blank class="flex items-center bf-icon-color-hover" aria-label=github title><span><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a><div class="translation nested-menu"><button class="cursor-pointer flex items-center">
<span class=me-1><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span>
</span><span class="text-sm font-medium bf-icon-color-hover" title="Generator e yield in Python: pipeline efficienti in memoria">IT</span></button><ul class=menuhide><li class="rounded-xl backdrop-blur shadow-2xl p-2 flex flex-col gap-1"><a href=/posts/what-does-yield-keyword-do-in-python/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Python Generators and yield: Building Memory-Efficient Pipelines">EN
</span></a><a href=/it/posts/what-does-yield-keyword-do-in-python/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Generator e yield in Python: pipeline efficienti in memoria">IT</span></a></li></ul></div><button id=search-button aria-label=Search class="text-base bf-icon-color-hover" title="Cerca (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></nav></div><div class="flex md:hidden"><div class="flex items-center h-14 gap-4"><button id=search-button-mobile aria-label=Search class="flex items-center justify-center bf-icon-color-hover" title="Cerca (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<input type=checkbox id=mobile-menu-toggle autocomplete=off class="hidden peer">
<label for=mobile-menu-toggle class="flex items-center justify-center cursor-pointer bf-icon-color-hover"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></label><div role=dialog aria-modal=true style=scrollbar-gutter:stable class="fixed inset-0 z-50 invisible overflow-y-auto px-6 py-20 opacity-0 transition-[opacity,visibility] duration-300 peer-checked:visible peer-checked:opacity-100 bg-neutral-50/97 dark:bg-neutral-900/99
bf-scrollbar"><label for=mobile-menu-toggle class="fixed end-8 top-5 flex items-center justify-center z-50 h-12 w-12 cursor-pointer select-none rounded-full bf-icon-color-hover border bf-border-color bf-border-color-hover bg-neutral-50 dark:bg-neutral-900"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></label><nav class="mx-auto max-w-md space-y-6"><div class=px-2><a href=/it/posts/ aria-label=Blog class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Posts class="text-2xl font-bold tracking-tight">Blog</span></a></div><div class=px-2><a href=/it/about/ aria-label="Chi sono" class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title="Chi sono" class="text-2xl font-bold tracking-tight">Chi sono</span></a></div><div class=px-2><a href=/it/coaching/ aria-label=Coaching class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Coaching class="text-2xl font-bold tracking-tight">Coaching</span></a></div><div class=px-2><a href=https://github.com/manuelfedele aria-label=github target=_blank class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span class="flex items-center justify-center h-8 w-8 text-2xl"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span><span title class="text-2xl font-bold tracking-tight"></span></a></div><div class="flex flex-wrap items-center [&_span]:text-2xl [&_.translation_button_.icon]:text-4xl! [&_.translation_button_span]:text-base! [&_.translation_.menuhide_span]:text-sm! gap-x-6 ps-2 mt-8 pt-8 border-t bf-border-color"><div class="translation nested-menu"><button class="cursor-pointer flex items-center">
<span class=me-1><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span>
</span><span class="text-sm font-medium bf-icon-color-hover" title="Generator e yield in Python: pipeline efficienti in memoria">IT</span></button><ul class=menuhide><li class="rounded-xl backdrop-blur shadow-2xl p-2 flex flex-col gap-1"><a href=/posts/what-does-yield-keyword-do-in-python/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Python Generators and yield: Building Memory-Efficient Pipelines">EN
</span></a><a href=/it/posts/what-does-yield-keyword-do-in-python/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Generator e yield in Python: pipeline efficienti in memoria">IT</span></a></li></ul></div></div></nav></div></div></div></div></div><script>(function(){var t,n,e=document.querySelector(".main-menu");if(!e)return;t=window.location.pathname,n=e.querySelectorAll('a[href="'+t+'"]'),n.forEach(function(e){var t=e.querySelectorAll("span");t.forEach(function(e){e.classList.add("active")})})})()</script></div></div><script type=text/javascript src=/js/background-blur.min.00a57c73ea12f2cab2980c3c3d649e89f6d82f190f74bbe2b67f2f5e39ab7d032ece47086400ca05396758aace13299da49aca43ea643d2625e62c506267a169.js integrity="sha512-AKV8c+oS8sqymAw8PWSeifbYLxkPdLvitn8vXjmrfQMuzkcIZADKBTlnWKrOEymdpJrKQ+pkPSYl5ixQYmehaQ==" data-blur-id=menu-blur></script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"><img id=background-image src="https://images.unsplash.com/photo-1574169208507-84376144848b?w=1200&amp;q=85" role=presentation loading=eager decoding=async fetchpriority=high class="absolute inset-0 w-full h-full object-cover"><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-xl bg-neutral-100/75 dark:bg-neutral-800/60"></div><script type=text/javascript src=/js/background-blur.min.00a57c73ea12f2cab2980c3c3d649e89f6d82f190f74bbe2b67f2f5e39ab7d032ece47086400ca05396758aace13299da49aca43ea643d2625e62c506267a169.js integrity="sha512-AKV8c+oS8sqymAw8PWSeifbYLxkPdLvitn8vXjmrfQMuzkcIZADKBTlnWKrOEymdpJrKQ+pkPSYl5ixQYmehaQ==" data-blur-id=background-blur data-image-id=background-image data-image-url="https://images.unsplash.com/photo-1574169208507-84376144848b?w=1200&amp;q=85"></script><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Generator e yield in Python: pipeline efficienti in memoria</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2022-12-29T10:19:25+01:00>29 dicembre 2022</time><span class="px-2 text-primary-500">&#183;</span><span title="Tempo di lettura">8 minuti</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/it/tags/python/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Python
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/it/tags/performance/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Performance
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/it/tags/backend/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Backend</span></span></a></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ms-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs"><div class="toc ps-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain bf-scrollbar rounded-lg -ms-5 ps-5 pe-2 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Indice dei contenuti</summary><div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#yield-di-base-generator-vs-funzioni-normali><code>yield</code> di base: Generator vs funzioni normali</a></li><li><a href=#il-protocollo-__next__-e-stopiteration>Il protocollo <code>__next__</code> e <code>StopIteration</code></a></li><li><a href=#confronto-di-memoria-file-con-readlines-vs-generator>Confronto di memoria: file con <code>readlines()</code> vs generator</a></li><li><a href=#espressioni-generator-vs-list-comprehension>Espressioni generator vs list comprehension</a></li><li><a href=#yield-from-per-la-delega-di-generator><code>yield from</code> per la delega di generator</a></li><li><a href=#pipeline-di-generator-comporre-stadi-di-elaborazione>Pipeline di generator: comporre stadi di elaborazione</a></li><li><a href=#il-metodo-send-generator-come-coroutine>Il metodo <code>send()</code>: generator come coroutine</a></li><li><a href=#sequenze-infinite>Sequenze infinite</a></li><li><a href=#caso-duso-reale-export-streaming-di-grandi-api>Caso d&rsquo;uso reale: export streaming di grandi API</a></li><li><a href=#errori-comuni>Errori comuni</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Indice dei contenuti</summary><div class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#yield-di-base-generator-vs-funzioni-normali><code>yield</code> di base: Generator vs funzioni normali</a></li><li><a href=#il-protocollo-__next__-e-stopiteration>Il protocollo <code>__next__</code> e <code>StopIteration</code></a></li><li><a href=#confronto-di-memoria-file-con-readlines-vs-generator>Confronto di memoria: file con <code>readlines()</code> vs generator</a></li><li><a href=#espressioni-generator-vs-list-comprehension>Espressioni generator vs list comprehension</a></li><li><a href=#yield-from-per-la-delega-di-generator><code>yield from</code> per la delega di generator</a></li><li><a href=#pipeline-di-generator-comporre-stadi-di-elaborazione>Pipeline di generator: comporre stadi di elaborazione</a></li><li><a href=#il-metodo-send-generator-come-coroutine>Il metodo <code>send()</code>: generator come coroutine</a></li><li><a href=#sequenze-infinite>Sequenze infinite</a></li><li><a href=#caso-duso-reale-export-streaming-di-grandi-api>Caso d&rsquo;uso reale: export streaming di grandi API</a></li><li><a href=#errori-comuni>Errori comuni</a></li></ul></nav></div></details><script>(function(){"use strict";const s=.33,o="#TableOfContents",i=".anchor",a='a[href^="#"]',r="li ul",c="active";let t=!1;function l(e,n){const o=window.scrollY+window.innerHeight*n,i=[...document.querySelectorAll('#TableOfContents a[href^="#"]')],s=new Set(i.map(e=>e.getAttribute("href").substring(1)));if(t)for(let t=0;t<e.length;t++){const n=e[t];if(!s.has(n.id))continue;const o=n.getBoundingClientRect().top+window.scrollY;if(Math.abs(window.scrollY-o)<100)return n.id}for(let t=e.length-1;t>=0;t--){const n=e[t].getBoundingClientRect().top+window.scrollY;if(n<=o&&s.has(e[t].id))return e[t].id}return e.find(e=>s.has(e.id))?.id||""}function e({toc:e,anchors:t,links:n,scrollOffset:s,collapseInactive:o}){const i=l(t,s);if(!i)return;if(n.forEach(e=>{const t=e.getAttribute("href")===`#${i}`;if(e.classList.toggle(c,t),o){const n=e.closest("li")?.querySelector("ul");n&&(n.style.display=t?"":"none")}}),o){const n=e.querySelector(`a[href="#${CSS.escape(i)}"]`);let t=n;for(;t&&t!==e;)t.tagName==="UL"&&(t.style.display=""),t.tagName==="LI"&&t.querySelector("ul")?.style.setProperty("display",""),t=t.parentElement}}function n(){const n=document.querySelector(o);if(!n)return;const l=!0,u=[...document.querySelectorAll(i)],d=[...n.querySelectorAll(a)];l&&n.querySelectorAll(r).forEach(e=>e.style.display="none"),d.forEach(e=>{e.addEventListener("click",()=>{t=!0})});const c={toc:n,anchors:u,links:d,scrollOffset:s,collapseInactive:l};window.addEventListener("scroll",()=>e(c),{passive:!0}),window.addEventListener("hashchange",()=>e(c),{passive:!0}),e(c)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n()})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><div class="lead text-neutral-500 dark:text-neutral-400 !mb-9 text-xl">Un generator è una sequenza lazy. Produce valori uno alla volta su richiesta invece di materializzare tutto in memoria. Per dataset di grandi dimensioni, API di streaming e pipeline di elaborazione dati, i generator sono il default corretto, non un&rsquo;ottimizzazione da applicare dopo.</div><p>I generator Python sono una delle funzionalita più praticamente utili del linguaggio e una delle più sottoutilizzate dagli ingegneri che hanno imparato Python dai tutorial web. Questo articolo va oltre il &ldquo;usa yield invece di return&rdquo; e copre il quadro completo: il protocollo iteratore, le caratteristiche di memoria, <code>yield from</code>, le pipeline di generator e casi d&rsquo;uso reali di streaming.</p><h2 class="relative group"><code>yield</code> di base: Generator vs funzioni normali<div id=yield-di-base-generator-vs-funzioni-normali class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#yield-di-base-generator-vs-funzioni-normali aria-label=Ancora>#</a></span></h2><p>Quando una funzione contiene un&rsquo;istruzione <code>yield</code>, chiamarla non esegue il corpo della funzione. Restituisce invece un oggetto generator. Il corpo si esegue in modo lazy, mettendosi in pausa a ogni <code>yield</code> e riprendendo alla chiamata successiva di <code>__next__</code>.</p><div class=highlight-wrapper><div class=codeblock-title>basic_generator.py</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>def</span> <span style=color:#88c0d0>count_up_to</span><span style=color:#eceff4>(</span>maximum<span style=color:#eceff4>:</span> <span style=color:#81a1c1>int</span><span style=color:#eceff4>):</span>
</span></span><span style=display:flex><span>    n <span style=color:#81a1c1>=</span> <span style=color:#b48ead>1</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>while</span> n <span style=color:#81a1c1>&lt;=</span> maximum<span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>yield</span> n
</span></span><span style=display:flex><span>        n <span style=color:#81a1c1>+=</span> <span style=color:#b48ead>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># Chiamare count_up_to() restituisce un oggetto generator. Niente viene eseguito ancora.</span>
</span></span><span style=display:flex><span>gen <span style=color:#81a1c1>=</span> count_up_to<span style=color:#eceff4>(</span><span style=color:#b48ead>3</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>type</span><span style=color:#eceff4>(</span>gen<span style=color:#eceff4>))</span>   <span style=color:#616e87;font-style:italic># &lt;class &#39;generator&#39;&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># Ogni chiamata a next() riprende l&#39;esecuzione fino al prossimo yield.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>next</span><span style=color:#eceff4>(</span>gen<span style=color:#eceff4>))</span>   <span style=color:#616e87;font-style:italic># 1</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>next</span><span style=color:#eceff4>(</span>gen<span style=color:#eceff4>))</span>   <span style=color:#616e87;font-style:italic># 2</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>next</span><span style=color:#eceff4>(</span>gen<span style=color:#eceff4>))</span>   <span style=color:#616e87;font-style:italic># 3</span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># next(gen) solleva StopIteration qui</span></span></span></code></pre></div></div><p>Confronta con una funzione normale che costruisce una lista:</p><div class=highlight-wrapper><div class=codeblock-title>list_vs_generator.py</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>def</span> <span style=color:#88c0d0>count_up_to_list</span><span style=color:#eceff4>(</span>maximum<span style=color:#eceff4>:</span> <span style=color:#81a1c1>int</span><span style=color:#eceff4>)</span> <span style=color:#81a1c1>-&gt;</span> <span style=color:#81a1c1>list</span><span style=color:#eceff4>[</span><span style=color:#81a1c1>int</span><span style=color:#eceff4>]:</span>
</span></span><span style=display:flex><span>    result <span style=color:#81a1c1>=</span> <span style=color:#eceff4>[]</span>
</span></span><span style=display:flex><span>    n <span style=color:#81a1c1>=</span> <span style=color:#b48ead>1</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>while</span> n <span style=color:#81a1c1>&lt;=</span> maximum<span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>        result<span style=color:#81a1c1>.</span>append<span style=color:#eceff4>(</span>n<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>        n <span style=color:#81a1c1>+=</span> <span style=color:#b48ead>1</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> result
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># Questo alloca memoria per tutti i 10_000_000 interi in una volta.</span>
</span></span><span style=display:flex><span>numbers <span style=color:#81a1c1>=</span> count_up_to_list<span style=color:#eceff4>(</span><span style=color:#b48ead>10_000_000</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># Questo alloca memoria per un intero alla volta.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>for</span> n <span style=color:#81a1c1;font-weight:700>in</span> count_up_to<span style=color:#eceff4>(</span><span style=color:#b48ead>10_000_000</span><span style=color:#eceff4>):</span>
</span></span><span style=display:flex><span>    process<span style=color:#eceff4>(</span>n<span style=color:#eceff4>)</span></span></span></code></pre></div></div><h2 class="relative group">Il protocollo <code>__next__</code> e <code>StopIteration</code><div id=il-protocollo-__next__-e-stopiteration class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#il-protocollo-__next__-e-stopiteration aria-label=Ancora>#</a></span></h2><p>Qualsiasi oggetto con i metodi <code>__iter__</code> e <code>__next__</code> è un iteratore. I generator implementano automaticamente questo protocollo. Capirlo è importante quando si scrivono oggetti iterabili personalizzati o si integra con framework che consumano iteratori.</p><div class=highlight-wrapper><div class=codeblock-title>iterator_protocol.py</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>class</span> <span style=color:#8fbcbb>CountUpTo</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>&#34;&#34;&#34;Un iteratore personalizzato che fa cio che count_up_to() fa, senza yield.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>def</span> <span style=color:#88c0d0>__init__</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self</span><span style=color:#eceff4>,</span> maximum<span style=color:#eceff4>:</span> <span style=color:#81a1c1>int</span><span style=color:#eceff4>)</span> <span style=color:#81a1c1>-&gt;</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1>self</span><span style=color:#81a1c1>.</span>maximum <span style=color:#81a1c1>=</span> maximum
</span></span><span style=display:flex><span>        <span style=color:#81a1c1>self</span><span style=color:#81a1c1>.</span>current <span style=color:#81a1c1>=</span> <span style=color:#b48ead>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>def</span> <span style=color:#88c0d0>__iter__</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self</span><span style=color:#eceff4>):</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1>self</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>def</span> <span style=color:#88c0d0>__next__</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>self</span><span style=color:#eceff4>)</span> <span style=color:#81a1c1>-&gt;</span> <span style=color:#81a1c1>int</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>if</span> <span style=color:#81a1c1>self</span><span style=color:#81a1c1>.</span>current <span style=color:#81a1c1>&gt;</span> <span style=color:#81a1c1>self</span><span style=color:#81a1c1>.</span>maximum<span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>            <span style=color:#81a1c1;font-weight:700>raise</span> <span style=color:#bf616a>StopIteration</span>
</span></span><span style=display:flex><span>        value <span style=color:#81a1c1>=</span> <span style=color:#81a1c1>self</span><span style=color:#81a1c1>.</span>current
</span></span><span style=display:flex><span>        <span style=color:#81a1c1>self</span><span style=color:#81a1c1>.</span>current <span style=color:#81a1c1>+=</span> <span style=color:#b48ead>1</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>return</span> value
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># Un ciclo for è zucchero sintattico sul protocollo iteratore:</span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># chiama __iter__ una volta, poi chiama __next__ fino a StopIteration.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>for</span> n <span style=color:#81a1c1;font-weight:700>in</span> CountUpTo<span style=color:#eceff4>(</span><span style=color:#b48ead>3</span><span style=color:#eceff4>):</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span>n<span style=color:#eceff4>)</span>  <span style=color:#616e87;font-style:italic># 1, 2, 3</span></span></span></code></pre></div></div><p>I generator producono lo stesso comportamento con molto meno codice. <code>StopIteration</code> viene sollevato automaticamente quando la funzione ritorna.</p><h2 class="relative group">Confronto di memoria: file con <code>readlines()</code> vs generator<div id=confronto-di-memoria-file-con-readlines-vs-generator class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#confronto-di-memoria-file-con-readlines-vs-generator aria-label=Ancora>#</a></span></h2><p>La differenza di memoria tra approcci basati su liste e su generator diventa critica quando si elaborano file di grandi dimensioni.</p><div class=highlight-wrapper><div class=codeblock-title>memory_comparison.py</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>tracemalloc</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>def</span> <span style=color:#88c0d0>read_file_list</span><span style=color:#eceff4>(</span>path<span style=color:#eceff4>:</span> <span style=color:#81a1c1>str</span><span style=color:#eceff4>)</span> <span style=color:#81a1c1>-&gt;</span> <span style=color:#81a1c1>list</span><span style=color:#eceff4>[</span><span style=color:#81a1c1>str</span><span style=color:#eceff4>]:</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>with</span> <span style=color:#81a1c1>open</span><span style=color:#eceff4>(</span>path<span style=color:#eceff4>)</span> <span style=color:#81a1c1;font-weight:700>as</span> f<span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>return</span> f<span style=color:#81a1c1>.</span>readlines<span style=color:#eceff4>()</span>  <span style=color:#616e87;font-style:italic># Carica tutte le righe in memoria in una volta</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>def</span> <span style=color:#88c0d0>read_file_generator</span><span style=color:#eceff4>(</span>path<span style=color:#eceff4>:</span> <span style=color:#81a1c1>str</span><span style=color:#eceff4>):</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>with</span> <span style=color:#81a1c1>open</span><span style=color:#eceff4>(</span>path<span style=color:#eceff4>)</span> <span style=color:#81a1c1;font-weight:700>as</span> f<span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>yield from</span> f  <span style=color:#616e87;font-style:italic># Produce una riga alla volta</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># Benchmark su un file con 1M di righe</span>
</span></span><span style=display:flex><span>tracemalloc<span style=color:#81a1c1>.</span>start<span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>lines <span style=color:#81a1c1>=</span> read_file_list<span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;big_file.txt&#34;</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>current<span style=color:#eceff4>,</span> peak <span style=color:#81a1c1>=</span> tracemalloc<span style=color:#81a1c1>.</span>get_traced_memory<span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>tracemalloc<span style=color:#81a1c1>.</span>stop<span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>f</span><span style=color:#a3be8c>&#34;readlines: peak=</span><span style=color:#a3be8c>{</span>peak <span style=color:#81a1c1>/</span> <span style=color:#b48ead>1_048_576</span><span style=color:#a3be8c>:</span><span style=color:#a3be8c>.1f</span><span style=color:#a3be8c>}</span><span style=color:#a3be8c> MB&#34;</span><span style=color:#eceff4>)</span>  <span style=color:#616e87;font-style:italic># ~500 MB per un file da 500 MB</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tracemalloc<span style=color:#81a1c1>.</span>start<span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>for</span> line <span style=color:#81a1c1;font-weight:700>in</span> read_file_generator<span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;big_file.txt&#34;</span><span style=color:#eceff4>):</span>
</span></span><span style=display:flex><span>    _ <span style=color:#81a1c1>=</span> line<span style=color:#81a1c1>.</span>strip<span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>current<span style=color:#eceff4>,</span> peak <span style=color:#81a1c1>=</span> tracemalloc<span style=color:#81a1c1>.</span>get_traced_memory<span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>tracemalloc<span style=color:#81a1c1>.</span>stop<span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>f</span><span style=color:#a3be8c>&#34;generator: peak=</span><span style=color:#a3be8c>{</span>peak <span style=color:#81a1c1>/</span> <span style=color:#b48ead>1_048_576</span><span style=color:#a3be8c>:</span><span style=color:#a3be8c>.1f</span><span style=color:#a3be8c>}</span><span style=color:#a3be8c> MB&#34;</span><span style=color:#eceff4>)</span>  <span style=color:#616e87;font-style:italic># ~0.1 MB indipendentemente dalla dimensione del file</span></span></span></code></pre></div></div><p>La versione con generator ha un utilizzo costante della memoria perché solo una riga è in memoria alla volta.</p><h2 class="relative group">Espressioni generator vs list comprehension<div id=espressioni-generator-vs-list-comprehension class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#espressioni-generator-vs-list-comprehension aria-label=Ancora>#</a></span></h2><p>Le espressioni generator usano le parentesi tonde e sono lazy. Le list comprehension usano le parentesi quadre e sono eager.</p><div class=highlight-wrapper><div class=codeblock-title>comprehension_vs_expression.py</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>sys</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># List comprehension: alloca 8 MB per 1M di interi</span>
</span></span><span style=display:flex><span>squares_list <span style=color:#81a1c1>=</span> <span style=color:#eceff4>[</span>x <span style=color:#81a1c1>*</span> <span style=color:#b48ead>2</span> <span style=color:#81a1c1;font-weight:700>for</span> x <span style=color:#81a1c1;font-weight:700>in</span> <span style=color:#81a1c1>range</span><span style=color:#eceff4>(</span><span style=color:#b48ead>1_000_000</span><span style=color:#eceff4>)]</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span>sys<span style=color:#81a1c1>.</span>getsizeof<span style=color:#eceff4>(</span>squares_list<span style=color:#eceff4>))</span>  <span style=color:#616e87;font-style:italic># ~8_697_464 byte (~8.3 MB)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># Espressione generator: alloca ~200 byte indipendentemente dalla dimensione del range</span>
</span></span><span style=display:flex><span>squares_gen <span style=color:#81a1c1>=</span> <span style=color:#eceff4>(</span>x <span style=color:#81a1c1>*</span> <span style=color:#b48ead>2</span> <span style=color:#81a1c1;font-weight:700>for</span> x <span style=color:#81a1c1;font-weight:700>in</span> <span style=color:#81a1c1>range</span><span style=color:#eceff4>(</span><span style=color:#b48ead>1_000_000</span><span style=color:#eceff4>))</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span>sys<span style=color:#81a1c1>.</span>getsizeof<span style=color:#eceff4>(</span>squares_gen<span style=color:#eceff4>))</span>   <span style=color:#616e87;font-style:italic># ~200 byte</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># Usa un&#39;espressione generator quando il risultato viene consumato una volta sola.</span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># Usa una lista quando hai bisogno di accesso casuale, len(), o iterazioni multiple.</span>
</span></span><span style=display:flex><span>total <span style=color:#81a1c1>=</span> <span style=color:#81a1c1>sum</span><span style=color:#eceff4>(</span>x <span style=color:#81a1c1>*</span> <span style=color:#b48ead>2</span> <span style=color:#81a1c1;font-weight:700>for</span> x <span style=color:#81a1c1;font-weight:700>in</span> <span style=color:#81a1c1>range</span><span style=color:#eceff4>(</span><span style=color:#b48ead>1_000_000</span><span style=color:#eceff4>))</span>  <span style=color:#616e87;font-style:italic># sum() accetta qualsiasi iterabile</span></span></span></code></pre></div></div><div class="admonition relative overflow-hidden rounded-lg border-l-4 my-3 px-4 py-3 shadow-sm" data-type=tip><div class="flex items-center gap-2 font-semibold text-inherit"><div class="flex shrink-0 h-5 w-5 items-center justify-center text-lg"><span class="relative block icon"><svg viewBox="0 0 384 512"><path fill="currentColor" d="M112.1 454.3c0 6.297 1.816 12.44 5.284 17.69l17.14 25.69c5.25 7.875 17.17 14.28 26.64 14.28h61.67c9.438.0 21.36-6.401 26.61-14.28l17.08-25.68c2.938-4.438 5.348-12.37 5.348-17.7L272 415.1H112L112.1 454.3zM191.4.0132C89.44.3257 16 82.97 16 175.1c0 44.38 16.44 84.84 43.56 115.8 16.53 18.84 42.34 58.23 52.22 91.45.0313.25.0938.5166.125.7823h160.2c.0313-.2656.0938-.5166.125-.7823 9.875-33.22 35.69-72.61 52.22-91.45C351.6 260.8 368 220.4 368 175.1 368 78.61 288.9-.2837 191.4.0132zM192 96.01c-44.13.0-80 35.89-80 79.1.0 9.69-7.2 16.89-16 16.89S80 184.8 80 176c0-61.76 50.25-111.1 112-111.1 8.844.0 16 7.159 16 16S200.8 96.01 192 96.01z"/></svg></span></div><div class=grow>Suggerimento</div></div><div class="admonition-content mt-3 text-base leading-relaxed text-inherit"><p>Quando si passa un&rsquo;espressione generator come unico argomento a una funzione come <code>sum()</code>, <code>any()</code>, <code>all()</code> o <code>max()</code>, si possono omettere le parentesi interne: <code>sum(x*2 for x in range(n))</code> è Python idiomatico.</p></div></div><h2 class="relative group"><code>yield from</code> per la delega di generator<div id=yield-from-per-la-delega-di-generator class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#yield-from-per-la-delega-di-generator aria-label=Ancora>#</a></span></h2><p><code>yield from</code> delega a un sub-generator (o qualsiasi iterabile), inoltrandone valori, eccezioni e il valore di ritorno in modo trasparente. È il modo corretto per comporre i generator.</p><div class=highlight-wrapper><div class=codeblock-title>yield_from.py</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>os</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>from</span> <span style=color:#8fbcbb>collections.abc</span> <span style=color:#81a1c1;font-weight:700>import</span> Generator
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>def</span> <span style=color:#88c0d0>walk_files</span><span style=color:#eceff4>(</span>root<span style=color:#eceff4>:</span> <span style=color:#81a1c1>str</span><span style=color:#eceff4>)</span> <span style=color:#81a1c1>-&gt;</span> Generator<span style=color:#eceff4>[</span><span style=color:#81a1c1>str</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>]:</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>&#34;&#34;&#34;Produce ricorsivamente tutti i path dei file sotto root.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>for</span> entry <span style=color:#81a1c1;font-weight:700>in</span> os<span style=color:#81a1c1>.</span>scandir<span style=color:#eceff4>(</span>root<span style=color:#eceff4>):</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>if</span> entry<span style=color:#81a1c1>.</span>is_dir<span style=color:#eceff4>(</span>follow_symlinks<span style=color:#81a1c1>=</span><span style=color:#81a1c1;font-weight:700>False</span><span style=color:#eceff4>):</span>
</span></span><span style=display:flex><span>            <span style=color:#81a1c1;font-weight:700>yield from</span> walk_files<span style=color:#eceff4>(</span>entry<span style=color:#81a1c1>.</span>path<span style=color:#eceff4>)</span>  <span style=color:#616e87;font-style:italic># Delega alla chiamata ricorsiva</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>else</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>            <span style=color:#81a1c1;font-weight:700>yield</span> entry<span style=color:#81a1c1>.</span>path
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># Senza yield from, servirebbe:</span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># for path in walk_files(entry.path):</span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>#     yield path</span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># yield from non è solo zucchero sintattico -- propaga correttamente anche .send() e .throw()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>for</span> path <span style=color:#81a1c1;font-weight:700>in</span> walk_files<span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;/var/log&#34;</span><span style=color:#eceff4>):</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span>path<span style=color:#eceff4>)</span></span></span></code></pre></div></div><h2 class="relative group">Pipeline di generator: comporre stadi di elaborazione<div id=pipeline-di-generator-comporre-stadi-di-elaborazione class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#pipeline-di-generator-comporre-stadi-di-elaborazione aria-label=Ancora>#</a></span></h2><p>I generator si compongono naturalmente in pipeline. Ogni stadio riceve un iterabile, lo elabora in modo lazy e produce i risultati. L&rsquo;intera pipeline consuma O(1) memoria indipendentemente dalla dimensione dei dati.</p><div class=highlight-wrapper><div class=codeblock-title>pipeline.py</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>from</span> <span style=color:#8fbcbb>collections.abc</span> <span style=color:#81a1c1;font-weight:700>import</span> Generator<span style=color:#eceff4>,</span> Iterable
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>csv</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>def</span> <span style=color:#88c0d0>read_lines</span><span style=color:#eceff4>(</span>path<span style=color:#eceff4>:</span> <span style=color:#81a1c1>str</span><span style=color:#eceff4>)</span> <span style=color:#81a1c1>-&gt;</span> Generator<span style=color:#eceff4>[</span><span style=color:#81a1c1>str</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>]:</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>with</span> <span style=color:#81a1c1>open</span><span style=color:#eceff4>(</span>path<span style=color:#eceff4>)</span> <span style=color:#81a1c1;font-weight:700>as</span> f<span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>yield from</span> f
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>def</span> <span style=color:#88c0d0>parse_csv</span><span style=color:#eceff4>(</span>lines<span style=color:#eceff4>:</span> Iterable<span style=color:#eceff4>[</span><span style=color:#81a1c1>str</span><span style=color:#eceff4>])</span> <span style=color:#81a1c1>-&gt;</span> Generator<span style=color:#eceff4>[</span><span style=color:#81a1c1>dict</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>]:</span>
</span></span><span style=display:flex><span>    reader <span style=color:#81a1c1>=</span> csv<span style=color:#81a1c1>.</span>DictReader<span style=color:#eceff4>(</span>lines<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>yield from</span> reader
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>def</span> <span style=color:#88c0d0>filter_active</span><span style=color:#eceff4>(</span>rows<span style=color:#eceff4>:</span> Iterable<span style=color:#eceff4>[</span><span style=color:#81a1c1>dict</span><span style=color:#eceff4>])</span> <span style=color:#81a1c1>-&gt;</span> Generator<span style=color:#eceff4>[</span><span style=color:#81a1c1>dict</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>]:</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>for</span> row <span style=color:#81a1c1;font-weight:700>in</span> rows<span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>if</span> row<span style=color:#81a1c1>.</span>get<span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;status&#34;</span><span style=color:#eceff4>)</span> <span style=color:#81a1c1>==</span> <span style=color:#a3be8c>&#34;active&#34;</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>            <span style=color:#81a1c1;font-weight:700>yield</span> row
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>def</span> <span style=color:#88c0d0>normalize</span><span style=color:#eceff4>(</span>rows<span style=color:#eceff4>:</span> Iterable<span style=color:#eceff4>[</span><span style=color:#81a1c1>dict</span><span style=color:#eceff4>])</span> <span style=color:#81a1c1>-&gt;</span> Generator<span style=color:#eceff4>[</span><span style=color:#81a1c1>dict</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>]:</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>for</span> row <span style=color:#81a1c1;font-weight:700>in</span> rows<span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>yield</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>            <span style=color:#a3be8c>&#34;id&#34;</span><span style=color:#eceff4>:</span>    <span style=color:#81a1c1>int</span><span style=color:#eceff4>(</span>row<span style=color:#eceff4>[</span><span style=color:#a3be8c>&#34;id&#34;</span><span style=color:#eceff4>]),</span>
</span></span><span style=display:flex><span>            <span style=color:#a3be8c>&#34;email&#34;</span><span style=color:#eceff4>:</span> row<span style=color:#eceff4>[</span><span style=color:#a3be8c>&#34;email&#34;</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>.</span>lower<span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span>strip<span style=color:#eceff4>(),</span>
</span></span><span style=display:flex><span>            <span style=color:#a3be8c>&#34;name&#34;</span><span style=color:#eceff4>:</span>  row<span style=color:#eceff4>[</span><span style=color:#a3be8c>&#34;name&#34;</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>.</span>strip<span style=color:#eceff4>(),</span>
</span></span><span style=display:flex><span>        <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>def</span> <span style=color:#88c0d0>process_file</span><span style=color:#eceff4>(</span>path<span style=color:#eceff4>:</span> <span style=color:#81a1c1>str</span><span style=color:#eceff4>)</span> <span style=color:#81a1c1>-&gt;</span> Generator<span style=color:#eceff4>[</span><span style=color:#81a1c1>dict</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>]:</span>
</span></span><span style=display:flex><span>    lines   <span style=color:#81a1c1>=</span> read_lines<span style=color:#eceff4>(</span>path<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    parsed  <span style=color:#81a1c1>=</span> parse_csv<span style=color:#eceff4>(</span>lines<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    active  <span style=color:#81a1c1>=</span> filter_active<span style=color:#eceff4>(</span>parsed<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>yield from</span> normalize<span style=color:#eceff4>(</span>active<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># L&#39;intera pipeline è lazy. Nessun dato viene letto finché non si itera.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>for</span> record <span style=color:#81a1c1;font-weight:700>in</span> process_file<span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;users.csv&#34;</span><span style=color:#eceff4>):</span>
</span></span><span style=display:flex><span>    save_to_database<span style=color:#eceff4>(</span>record<span style=color:#eceff4>)</span></span></span></code></pre></div></div><div class="admonition relative overflow-hidden rounded-lg border-l-4 my-3 px-4 py-3 shadow-sm" data-type=note><div class="flex items-center gap-2 font-semibold text-inherit"><div class="flex shrink-0 h-5 w-5 items-center justify-center text-lg"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 0C114.6.0.0 114.6.0 256s114.6 256 256 256 256-114.6 256-256S397.4.0 256 0zm0 128c17.67.0 32 14.33 32 32 0 17.67-14.33 32-32 32s-32-14.3-32-32 14.3-32 32-32zm40 256h-80c-13.2.0-24-10.7-24-24s10.75-24 24-24h16v-64h-8c-13.25.0-24-10.75-24-24s10.8-24 24-24h32c13.25.0 24 10.75 24 24v88h16c13.25.0 24 10.75 24 24s-10.7 24-24 24z"/></svg></span></div><div class=grow>Nota</div></div><div class="admonition-content mt-3 text-base leading-relaxed text-inherit"><p>Ogni generator nella pipeline mantiene un elemento in memoria alla volta. Un file CSV da 10 GB passa attraverso questa pipeline con approssimativamente lo stesso footprint di memoria di un file da 10 KB.</p></div></div><h2 class="relative group">Il metodo <code>send()</code>: generator come coroutine<div id=il-metodo-send-generator-come-coroutine class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#il-metodo-send-generator-come-coroutine aria-label=Ancora>#</a></span></h2><p>I generator supportano la comunicazione bidirezionale tramite <code>.send(value)</code>. Prima che <code>async/await</code> fosse introdotto in Python 3.5, questo era il meccanismo principale per le coroutine.</p><div class=highlight-wrapper><div class=codeblock-title>send_method.py</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>from</span> <span style=color:#8fbcbb>collections.abc</span> <span style=color:#81a1c1;font-weight:700>import</span> Generator
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>def</span> <span style=color:#88c0d0>accumulator</span><span style=color:#eceff4>()</span> <span style=color:#81a1c1>-&gt;</span> Generator<span style=color:#eceff4>[</span><span style=color:#81a1c1>float</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1>float</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1>str</span><span style=color:#eceff4>]:</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>&#34;&#34;&#34;Riceve valori via send(), produce la media progressiva.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    total <span style=color:#81a1c1>=</span> <span style=color:#b48ead>0.0</span>
</span></span><span style=display:flex><span>    count <span style=color:#81a1c1>=</span> <span style=color:#b48ead>0</span>
</span></span><span style=display:flex><span>    value <span style=color:#81a1c1>=</span> <span style=color:#81a1c1;font-weight:700>yield</span> <span style=color:#b48ead>0.0</span>  <span style=color:#616e87;font-style:italic># Yield iniziale per inizializzare il generator</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>while</span> value <span style=color:#81a1c1;font-weight:700>is</span> <span style=color:#81a1c1;font-weight:700>not</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>        total <span style=color:#81a1c1>+=</span> value
</span></span><span style=display:flex><span>        count <span style=color:#81a1c1>+=</span> <span style=color:#b48ead>1</span>
</span></span><span style=display:flex><span>        value <span style=color:#81a1c1>=</span> <span style=color:#81a1c1;font-weight:700>yield</span> total <span style=color:#81a1c1>/</span> count
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#a3be8c>f</span><span style=color:#a3be8c>&#34;Media finale su </span><span style=color:#a3be8c>{</span>count<span style=color:#a3be8c>}</span><span style=color:#a3be8c> elementi&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gen <span style=color:#81a1c1>=</span> accumulator<span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1>next</span><span style=color:#eceff4>(</span>gen<span style=color:#eceff4>)</span>            <span style=color:#616e87;font-style:italic># Inizializza il generator (avanza fino al primo yield)</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span>gen<span style=color:#81a1c1>.</span>send<span style=color:#eceff4>(</span><span style=color:#b48ead>10</span><span style=color:#eceff4>))</span>  <span style=color:#616e87;font-style:italic># 10.0</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span>gen<span style=color:#81a1c1>.</span>send<span style=color:#eceff4>(</span><span style=color:#b48ead>20</span><span style=color:#eceff4>))</span>  <span style=color:#616e87;font-style:italic># 15.0</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span>gen<span style=color:#81a1c1>.</span>send<span style=color:#eceff4>(</span><span style=color:#b48ead>30</span><span style=color:#eceff4>))</span>  <span style=color:#616e87;font-style:italic># 20.0</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>try</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>    gen<span style=color:#81a1c1>.</span>send<span style=color:#eceff4>(</span><span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>)</span>   <span style=color:#616e87;font-style:italic># Segnala la fine dell&#39;input</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>except</span> <span style=color:#bf616a>StopIteration</span> <span style=color:#81a1c1;font-weight:700>as</span> e<span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span>e<span style=color:#81a1c1>.</span>value<span style=color:#eceff4>)</span>   <span style=color:#616e87;font-style:italic># &#34;Media finale su 3 elementi&#34;</span></span></span></code></pre></div></div><div class="admonition relative overflow-hidden rounded-lg border-l-4 my-3 px-4 py-3 shadow-sm" data-type=note><div class="flex items-center gap-2 font-semibold text-inherit"><div class="flex shrink-0 h-5 w-5 items-center justify-center text-lg"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 0C114.6.0.0 114.6.0 256s114.6 256 256 256 256-114.6 256-256S397.4.0 256 0zm0 128c17.67.0 32 14.33 32 32 0 17.67-14.33 32-32 32s-32-14.3-32-32 14.3-32 32-32zm40 256h-80c-13.2.0-24-10.7-24-24s10.75-24 24-24h16v-64h-8c-13.25.0-24-10.75-24-24s10.8-24 24-24h32c13.25.0 24 10.75 24 24v88h16c13.25.0 24 10.75 24 24s-10.7 24-24 24z"/></svg></span></div><div class=grow>Nota</div></div><div class="admonition-content mt-3 text-base leading-relaxed text-inherit"><p>In Python moderno (3.5+), <code>async def</code> e <code>await</code> hanno sostituito le coroutine basate su generator per la concorrenza. Usa <code>send()</code> solo quando hai specificamente bisogno di una coroutine di elaborazione dati stateful che produce risultati intermedi, non per la concorrenza I/O.</p></div></div><h2 class="relative group">Sequenze infinite<div id=sequenze-infinite class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#sequenze-infinite aria-label=Ancora>#</a></span></h2><p>I generator possono produrre sequenze infinite perché non materializzano mai più di un valore alla volta.</p><div class=highlight-wrapper><div class=codeblock-title>infinite_sequences.py</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>itertools</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>from</span> <span style=color:#8fbcbb>collections.abc</span> <span style=color:#81a1c1;font-weight:700>import</span> Generator
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># itertools.count: sequenza aritmetica infinita</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>for</span> n <span style=color:#81a1c1;font-weight:700>in</span> itertools<span style=color:#81a1c1>.</span>islice<span style=color:#eceff4>(</span>itertools<span style=color:#81a1c1>.</span>count<span style=color:#eceff4>(</span>start<span style=color:#81a1c1>=</span><span style=color:#b48ead>0</span><span style=color:#eceff4>,</span> step<span style=color:#81a1c1>=</span><span style=color:#b48ead>2</span><span style=color:#eceff4>),</span> <span style=color:#b48ead>5</span><span style=color:#eceff4>):</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span>n<span style=color:#eceff4>)</span>  <span style=color:#616e87;font-style:italic># 0, 2, 4, 6, 8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># itertools.cycle: ripete una sequenza finita all&#39;infinito</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>for</span> color <span style=color:#81a1c1;font-weight:700>in</span> itertools<span style=color:#81a1c1>.</span>islice<span style=color:#eceff4>(</span>itertools<span style=color:#81a1c1>.</span>cycle<span style=color:#eceff4>([</span><span style=color:#a3be8c>&#34;red&#34;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#34;green&#34;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#34;blue&#34;</span><span style=color:#eceff4>]),</span> <span style=color:#b48ead>7</span><span style=color:#eceff4>):</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span>color<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># Generator di Fibonacci infinito personalizzato</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>def</span> <span style=color:#88c0d0>fibonacci</span><span style=color:#eceff4>()</span> <span style=color:#81a1c1>-&gt;</span> Generator<span style=color:#eceff4>[</span><span style=color:#81a1c1>int</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>]:</span>
</span></span><span style=display:flex><span>    a<span style=color:#eceff4>,</span> b <span style=color:#81a1c1>=</span> <span style=color:#b48ead>0</span><span style=color:#eceff4>,</span> <span style=color:#b48ead>1</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>while</span> <span style=color:#81a1c1;font-weight:700>True</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>yield</span> a
</span></span><span style=display:flex><span>        a<span style=color:#eceff4>,</span> b <span style=color:#81a1c1>=</span> b<span style=color:#eceff4>,</span> a <span style=color:#81a1c1>+</span> b
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># Prendi i primi 10 numeri di Fibonacci</span>
</span></span><span style=display:flex><span>first_ten <span style=color:#81a1c1>=</span> <span style=color:#81a1c1>list</span><span style=color:#eceff4>(</span>itertools<span style=color:#81a1c1>.</span>islice<span style=color:#eceff4>(</span>fibonacci<span style=color:#eceff4>(),</span> <span style=color:#b48ead>10</span><span style=color:#eceff4>))</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span>first_ten<span style=color:#eceff4>)</span>  <span style=color:#616e87;font-style:italic># [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]</span></span></span></code></pre></div></div><h2 class="relative group">Caso d&rsquo;uso reale: export streaming di grandi API<div id=caso-duso-reale-export-streaming-di-grandi-api class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#caso-duso-reale-export-streaming-di-grandi-api aria-label=Ancora>#</a></span></h2><p>Il caso d&rsquo;uso di produzione canonico: un endpoint API che esporta dati troppo grandi per essere bufferizzati in memoria.</p><div class=highlight-wrapper><div class=codeblock-title>streaming_export.py</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>csv</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>io</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>from</span> <span style=color:#8fbcbb>collections.abc</span> <span style=color:#81a1c1;font-weight:700>import</span> Generator
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>from</span> <span style=color:#8fbcbb>django.http</span> <span style=color:#81a1c1;font-weight:700>import</span> StreamingHttpResponse
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>from</span> <span style=color:#8fbcbb>django.db.models</span> <span style=color:#81a1c1;font-weight:700>import</span> QuerySet
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>def</span> <span style=color:#88c0d0>iter_csv_rows</span><span style=color:#eceff4>(</span>queryset<span style=color:#eceff4>:</span> QuerySet<span style=color:#eceff4>)</span> <span style=color:#81a1c1>-&gt;</span> Generator<span style=color:#eceff4>[</span><span style=color:#81a1c1>bytes</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>]:</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>&#34;&#34;&#34;Produce righe CSV da un queryset Django senza caricare tutto in memoria.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    buffer <span style=color:#81a1c1>=</span> io<span style=color:#81a1c1>.</span>StringIO<span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>    writer <span style=color:#81a1c1>=</span> csv<span style=color:#81a1c1>.</span>writer<span style=color:#eceff4>(</span>buffer<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#616e87;font-style:italic># Riga di intestazione</span>
</span></span><span style=display:flex><span>    writer<span style=color:#81a1c1>.</span>writerow<span style=color:#eceff4>([</span><span style=color:#a3be8c>&#34;id&#34;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#34;email&#34;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#34;created_at&#34;</span><span style=color:#eceff4>])</span>
</span></span><span style=display:flex><span>    buffer<span style=color:#81a1c1>.</span>seek<span style=color:#eceff4>(</span><span style=color:#b48ead>0</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>yield</span> buffer<span style=color:#81a1c1>.</span>read<span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span>encode<span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;utf-8&#34;</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    buffer<span style=color:#81a1c1>.</span>truncate<span style=color:#eceff4>(</span><span style=color:#b48ead>0</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    buffer<span style=color:#81a1c1>.</span>seek<span style=color:#eceff4>(</span><span style=color:#b48ead>0</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#616e87;font-style:italic># Righe dati: QuerySet.iterator() usa un server-side cursor</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>for</span> user <span style=color:#81a1c1;font-weight:700>in</span> queryset<span style=color:#81a1c1>.</span>only<span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;id&#34;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#34;email&#34;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#34;created_at&#34;</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.</span>iterator<span style=color:#eceff4>(</span>chunk_size<span style=color:#81a1c1>=</span><span style=color:#b48ead>2000</span><span style=color:#eceff4>):</span>
</span></span><span style=display:flex><span>        writer<span style=color:#81a1c1>.</span>writerow<span style=color:#eceff4>([</span>user<span style=color:#81a1c1>.</span>id<span style=color:#eceff4>,</span> user<span style=color:#81a1c1>.</span>email<span style=color:#eceff4>,</span> user<span style=color:#81a1c1>.</span>created_at<span style=color:#81a1c1>.</span>isoformat<span style=color:#eceff4>()])</span>
</span></span><span style=display:flex><span>        buffer<span style=color:#81a1c1>.</span>seek<span style=color:#eceff4>(</span><span style=color:#b48ead>0</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>yield</span> buffer<span style=color:#81a1c1>.</span>read<span style=color:#eceff4>()</span><span style=color:#81a1c1>.</span>encode<span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;utf-8&#34;</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>        buffer<span style=color:#81a1c1>.</span>truncate<span style=color:#eceff4>(</span><span style=color:#b48ead>0</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>        buffer<span style=color:#81a1c1>.</span>seek<span style=color:#eceff4>(</span><span style=color:#b48ead>0</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>def</span> <span style=color:#88c0d0>export_users_csv</span><span style=color:#eceff4>(</span>request<span style=color:#eceff4>):</span>
</span></span><span style=display:flex><span>    queryset <span style=color:#81a1c1>=</span> User<span style=color:#81a1c1>.</span>objects<span style=color:#81a1c1>.</span>filter<span style=color:#eceff4>(</span>active<span style=color:#81a1c1>=</span><span style=color:#81a1c1;font-weight:700>True</span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.</span>order_by<span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;id&#34;</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    response <span style=color:#81a1c1>=</span> StreamingHttpResponse<span style=color:#eceff4>(</span>
</span></span><span style=display:flex><span>        iter_csv_rows<span style=color:#eceff4>(</span>queryset<span style=color:#eceff4>),</span>
</span></span><span style=display:flex><span>        content_type<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;text/csv&#34;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    response<span style=color:#eceff4>[</span><span style=color:#a3be8c>&#34;Content-Disposition&#34;</span><span style=color:#eceff4>]</span> <span style=color:#81a1c1>=</span> <span style=color:#a3be8c>&#39;attachment; filename=&#34;users.csv&#34;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> response</span></span></code></pre></div></div><p>La <code>StreamingHttpResponse</code> di Django invia dati al client man mano che vengono prodotti. Un export da 5 milioni di righe si completa senza mai tenere in memoria piu di <code>chunk_size</code> righe.</p><h2 class="relative group">Errori comuni<div id=errori-comuni class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#errori-comuni aria-label=Ancora>#</a></span></h2><div id=accordion-2d79f7661a8190da1257645db0eb54b2 class="border border-neutral-200 dark:border-neutral-700 rounded-lg overflow-hidden" data-accordion=collapse data-accordion-separated=false><details class=border-none data-accordion-item open><summary class="flex w-full cursor-pointer items-center justify-between gap-4 px-4 py-3 text-left text-lg font-semibold text-neutral-900 dark:text-neutral-100"><span class="flex items-center gap-2"><span>Iterare un generator due volte</span>
</span><span><span class="relative block icon"><svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></summary><div class="px-4 pb-4 text-neutral-700 dark:text-neutral-300"><p>Un generator è esaurito dopo un singolo passaggio. Se si itera su di esso una seconda volta, non si ottiene nulla. Se si ha bisogno di iterare più volte, convertirlo prima in una lista: <code>items = list(my_generator())</code>. Essere consapevoli del trade-off di memoria.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>gen <span style=color:#81a1c1>=</span> <span style=color:#eceff4>(</span>x <span style=color:#81a1c1>*</span> <span style=color:#b48ead>2</span> <span style=color:#81a1c1;font-weight:700>for</span> x <span style=color:#81a1c1;font-weight:700>in</span> <span style=color:#81a1c1>range</span><span style=color:#eceff4>(</span><span style=color:#b48ead>5</span><span style=color:#eceff4>))</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>list</span><span style=color:#eceff4>(</span>gen<span style=color:#eceff4>))</span>  <span style=color:#616e87;font-style:italic># [0, 2, 4, 6, 8]</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>list</span><span style=color:#eceff4>(</span>gen<span style=color:#eceff4>))</span>  <span style=color:#616e87;font-style:italic># []  -- gia esaurito</span></span></span></code></pre></div></div></div></details><details class=border-none data-accordion-item><summary class="flex w-full cursor-pointer items-center justify-between gap-4 px-4 py-3 text-left text-lg font-semibold text-neutral-900 dark:text-neutral-100"><span class="flex items-center gap-2"><span>Non gestire StopIteration nei cicli manuali con next()</span>
</span><span><span class="relative block icon"><svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></summary><div class="px-4 pb-4 text-neutral-700 dark:text-neutral-300"><p>Chiamare <code>next()</code> su un generator esaurito solleva <code>StopIteration</code>. Usare la forma a due argomenti <code>next(gen, default)</code> per fornire un valore sentinella, o iterare con un ciclo <code>for</code> che gestisce l&rsquo;eccezione automaticamente.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>gen <span style=color:#81a1c1>=</span> count_up_to<span style=color:#eceff4>(</span><span style=color:#b48ead>2</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>next</span><span style=color:#eceff4>(</span>gen<span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>))</span>  <span style=color:#616e87;font-style:italic># 1</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>next</span><span style=color:#eceff4>(</span>gen<span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>))</span>  <span style=color:#616e87;font-style:italic># 2</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1>print</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>next</span><span style=color:#eceff4>(</span>gen<span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>None</span><span style=color:#eceff4>))</span>  <span style=color:#616e87;font-style:italic># None -- nessuna eccezione</span></span></span></code></pre></div></div></div></details><details class=border-none data-accordion-item><summary class="flex w-full cursor-pointer items-center justify-between gap-4 px-4 py-3 text-left text-lg font-semibold text-neutral-900 dark:text-neutral-100"><span class="flex items-center gap-2"><span>Usare una lista dove un generator è sufficiente</span>
</span><span><span class="relative block icon"><svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></summary><div class="px-4 pb-4 text-neutral-700 dark:text-neutral-300">Costruire una lista solo per iterarci sopra una volta è uno spreco. <code>[process(x) for x in items]</code> quando la lista non viene mai più usata dovrebbe essere <code>(process(x) for x in items)</code> passata alla funzione consumatrice, o un ciclo <code>for</code> con effetti collaterali. L&rsquo;allocazione della lista è overhead puro.</div></details><details class=border-none data-accordion-item><summary class="flex w-full cursor-pointer items-center justify-between gap-4 px-4 py-3 text-left text-lg font-semibold text-neutral-900 dark:text-neutral-100"><span class="flex items-center gap-2"><span>Dimenticare di inizializzare i generator basati su send()</span>
</span><span><span class="relative block icon"><svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></summary><div class="px-4 pb-4 text-neutral-700 dark:text-neutral-300">Prima di chiamare <code>.send(value)</code> su un generator, bisogna avanzarlo fino al primo <code>yield</code> con <code>next(gen)</code> o <code>gen.send(None)</code>. Chiamare <code>.send(valore-non-None)</code> su un generator appena creato solleva <code>TypeError</code>. Un pattern comune è un decoratore <code>@coroutine</code> che inizializza automaticamente il generator.</div></details></div><style>#accordion-2d79f7661a8190da1257645db0eb54b2>details+details{border-top:1px solid rgb(var(--color-neutral-200))}.dark #accordion-2d79f7661a8190da1257645db0eb54b2>details+details{border-top-color:rgb(var(--color-neutral-700))}</style><script>(()=>{const e=document.getElementById("accordion-2d79f7661a8190da1257645db0eb54b2");if(!e)return;const t=e.querySelectorAll("details[data-accordion-item]");t.forEach(e=>{e.addEventListener("toggle",()=>{if(!e.open)return;t.forEach(t=>{t!==e&&t.removeAttribute("open")})})})})()</script><hr><p>Se vuoi approfondire questi argomenti, offro sessioni di coaching 1:1 per ingegneri che lavorano su integrazione AI, architettura cloud e platform engineering. <a href=https://calendly.com/manuelfedele/60min target=_blank rel=noreferrer>Prenota una sessione</a> (50 EUR / 60 min) o scrivimi a <a href=mailto:manuel.fedele+website@gmail.com>manuel.fedele+website@gmail.com</a>.</p></div><h2 class="mt-8 text-2xl font-extrabold mb-10">Articoli correlati</h2><section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3"><article class="article-link--related relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600"><div class="flex-none relative overflow-hidden thumbnail_card_related"><img src="https://images.unsplash.com/photo-1655720828018-edd2daec9349?w=1200&amp;q=85" role=presentation loading=lazy decoding=async fetchpriority=low class="not-prose absolute inset-0 w-full h-full object-cover"></div><div class=p-4><header><a href=/it/posts/work-with-json-postgresql/ class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2"><h2>PostgreSQL JSONB: Schema flessibile, indicizzazione e quando usarlo</h2></a></header><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime=2022-12-19T18:20:30+01:00>19 dicembre 2022</time><span class="px-2 text-primary-500">&#183;</span><span title="Tempo di lettura">9 minuti</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/it/tags/postgresql/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">PostgreSQL
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/it/tags/databases/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Databases
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/it/tags/backend/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Backend</span></span></a></div></div></div><div class="px-6 pt-4 pb-2"></div></article><article class="article-link--related relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600"><div class="flex-none relative overflow-hidden thumbnail_card_related"><img src="https://images.unsplash.com/photo-1523821741446-edb2b68bb7a0?w=1200&amp;q=85" role=presentation loading=lazy decoding=async fetchpriority=low class="not-prose absolute inset-0 w-full h-full object-cover"></div><div class=p-4><header><a href=/it/posts/poetry-no-module-seed-via-app-data/ class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2"><h2>Poetry: No module named seed via app data</h2></a></header><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime=2021-11-01T15:15:47+01:00>1 novembre 2021</time><span class="px-2 text-primary-500">&#183;</span><span title="Tempo di lettura">1 minuto</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/it/tags/poetry/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Poetry
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/it/tags/python/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Python</span></span></a></div></div></div><div class="px-6 pt-4 pb-2"></div></article></section></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span class="flex flex-col"><a class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/it/posts/use-protobuf-with-golang/><span class=leading-6><span class="inline-block rtl:rotate-180">&larr;</span>&ensp;Protocol Buffers in Go: Serializzazione, gRPC e Performance
</span></a><span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2022-12-27T18:48:44+01:00>27 dicembre 2022</time>
</span></span><span class="flex flex-col items-end"><a class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/it/posts/create-webserver-with-fastapi-and-uvicorn/><span class=leading-6>Costruire API di produzione con FastAPI: Pydantic, dependency injection e deployment&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
</span></a><span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2022-12-30T14:08:35+01:00>30 dicembre 2022</time></span></span></div></div></footer></article><div id=scroll-to-top class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Torna in cima" title="Torna in cima">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2026
Manuel Fedele</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://manuelfedele.github.io/it/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Cerca tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Chiudi (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>