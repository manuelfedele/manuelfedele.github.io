<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>Design Patterns in Go: Idiomatic Implementations &#183; Git Push and Run</title><meta name=title content="Design Patterns in Go: Idiomatic Implementations &#183; Git Push and Run"><meta name=description content="Software Engineer and Cloud Architect writing about Go, Python, AWS, and AI automation."><meta name=keywords content="design patterns,golang,"><link rel=canonical href=https://manuelfedele.github.io/posts/implement-desing-patterns-with-golang/><meta name=author content="Manuel Fedele"><link href=https://github.com/manuelfedele rel=me><link href=https://linkedin.com/in/manuel-fedele rel=me><meta property="og:url" content="https://manuelfedele.github.io/posts/implement-desing-patterns-with-golang/"><meta property="og:site_name" content="Git Push and Run"><meta property="og:title" content="Design Patterns in Go: Idiomatic Implementations"><meta property="og:description" content="Go approaches design patterns differently from Java or C++. Because Go uses composition instead of inheritance, and because functions are first-class values, many patterns that require elaborate class hierarchies in OOP languages collapse into a few idiomatic Go constructs. This post shows the correct, production-ready implementations and, just as importantly, tells you when not to reach for a pattern at all. Design patterns are not a checklist. In Go, applying Java-style patterns wholesale is the fastest path to code that looks foreign to every Go developer who reads it. The patterns below are presented in their idiomatic Go form, which is often significantly simpler than the textbook version."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-21T13:16:06+01:00"><meta property="article:modified_time" content="2023-02-21T13:16:06+01:00"><meta property="article:tag" content="Design Patterns"><meta property="article:tag" content="Golang"><meta name=twitter:card content="summary"><meta name=twitter:title content="Design Patterns in Go: Idiomatic Implementations"><meta name=twitter:description content="Go approaches design patterns differently from Java or C++. Because Go uses composition instead of inheritance, and because functions are first-class values, many patterns that require elaborate class hierarchies in OOP languages collapse into a few idiomatic Go constructs. This post shows the correct, production-ready implementations and, just as importantly, tells you when not to reach for a pattern at all. Design patterns are not a checklist. In Go, applying Java-style patterns wholesale is the fastest path to code that looks foreign to every Go developer who reads it. The patterns below are presented in their idiomatic Go form, which is often significantly simpler than the textbook version."><link type=text/css rel=stylesheet href=/css/main.bundle.min.726dfbf42bcd66e35e2d7258d72fe8fe77509ff76d153e2b46cdbae9c3af9620653459f0119a72d2af4a9b4bc446652d244ad58743d0290e5d8e09e3983b98e5.css integrity="sha512-cm379CvNZuNeLXJY1y/o/ndQn/dtFT4rRs266cOvliBlNFnwEZpy0q9Km0vERmUtJErVh0PQKQ5djgnjmDuY5Q=="><script type=text/javascript src=/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.88278edec77139635e1ad294df5b32b7be9338191c5252d3f6f451ace5852d5f82390cccacedab9c64739d8e068b7e8502895cf8f951060c0368f9a73709fcb7.js integrity="sha512-iCeO3sdxOWNeGtKU31syt76TOBkcUlLT9vRRrOWFLV+COQzMrO2rnGRznY4Gi36FAolc+PlRBgwDaPmnNwn8tw==" data-copy=Copy data-copied=Copied></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Design Patterns in Go: Idiomatic Implementations","headline":"Design Patterns in Go: Idiomatic Implementations","inLanguage":"en","url":"https://manuelfedele.github.io/posts/implement-desing-patterns-with-golang/","author":{"@type":"Person","name":"Manuel Fedele"},"copyrightYear":"2023","dateCreated":"2023-02-21T13:16:06\u002b01:00","datePublished":"2023-02-21T13:16:06\u002b01:00","dateModified":"2023-02-21T13:16:06\u002b01:00","keywords":["design patterns","golang"],"mainEntityOfPage":"true","wordCount":"1812"}]</script></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral bf-scrollbar"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 z-100"><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl bg-neutral/25 dark:bg-neutral-800/25"></div><div class="relative m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32"><div class="main-menu flex items-center w-full gap-2 p-1 pl-0"><a href=/ class="text-base font-medium truncate min-w-0 shrink">Git Push and Run</a><div class="flex items-center ms-auto"><div class="hidden md:flex"><nav class="flex items-center gap-x-5 h-12"><a href=/posts/ class="flex items-center bf-icon-color-hover" aria-label=Blog title=Posts><span class="text-base font-medium break-normal">Blog
</span></a><a href=/about/ class="flex items-center bf-icon-color-hover" aria-label=About title=About><span class="text-base font-medium break-normal">About
</span></a><a href=/coaching/ class="flex items-center bf-icon-color-hover" aria-label=Coaching title=Coaching><span class="text-base font-medium break-normal">Coaching
</span></a><a href=https://github.com/manuelfedele target=_blank class="flex items-center bf-icon-color-hover" aria-label=github title><span><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a><div class="translation nested-menu"><button class="cursor-pointer flex items-center">
<span class=me-1><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span>
</span><span class="text-sm font-medium bf-icon-color-hover" title="Design Patterns in Go: Idiomatic Implementations">EN</span></button><ul class=menuhide><li class="rounded-xl backdrop-blur shadow-2xl p-2 flex flex-col gap-1"><a href=/posts/implement-desing-patterns-with-golang/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Design Patterns in Go: Idiomatic Implementations">EN
</span></a><a href=/it/posts/implement-desing-patterns-with-golang/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Design Pattern in Go: Implementazioni Idiomatiche">IT</span></a></li></ul></div><button id=search-button aria-label=Search class="text-base bf-icon-color-hover" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></nav></div><div class="flex md:hidden"><div class="flex items-center h-14 gap-4"><button id=search-button-mobile aria-label=Search class="flex items-center justify-center bf-icon-color-hover" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<input type=checkbox id=mobile-menu-toggle autocomplete=off class="hidden peer">
<label for=mobile-menu-toggle class="flex items-center justify-center cursor-pointer bf-icon-color-hover"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></label><div role=dialog aria-modal=true style=scrollbar-gutter:stable class="fixed inset-0 z-50 invisible overflow-y-auto px-6 py-20 opacity-0 transition-[opacity,visibility] duration-300 peer-checked:visible peer-checked:opacity-100 bg-neutral-50/97 dark:bg-neutral-900/99
bf-scrollbar"><label for=mobile-menu-toggle class="fixed end-8 top-5 flex items-center justify-center z-50 h-12 w-12 cursor-pointer select-none rounded-full bf-icon-color-hover border bf-border-color bf-border-color-hover bg-neutral-50 dark:bg-neutral-900"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></label><nav class="mx-auto max-w-md space-y-6"><div class=px-2><a href=/posts/ aria-label=Blog class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Posts class="text-2xl font-bold tracking-tight">Blog</span></a></div><div class=px-2><a href=/about/ aria-label=About class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=About class="text-2xl font-bold tracking-tight">About</span></a></div><div class=px-2><a href=/coaching/ aria-label=Coaching class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Coaching class="text-2xl font-bold tracking-tight">Coaching</span></a></div><div class=px-2><a href=https://github.com/manuelfedele aria-label=github target=_blank class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span class="flex items-center justify-center h-8 w-8 text-2xl"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span><span title class="text-2xl font-bold tracking-tight"></span></a></div><div class="flex flex-wrap items-center [&_span]:text-2xl [&_.translation_button_.icon]:text-4xl! [&_.translation_button_span]:text-base! [&_.translation_.menuhide_span]:text-sm! gap-x-6 ps-2 mt-8 pt-8 border-t bf-border-color"><div class="translation nested-menu"><button class="cursor-pointer flex items-center">
<span class=me-1><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span>
</span><span class="text-sm font-medium bf-icon-color-hover" title="Design Patterns in Go: Idiomatic Implementations">EN</span></button><ul class=menuhide><li class="rounded-xl backdrop-blur shadow-2xl p-2 flex flex-col gap-1"><a href=/posts/implement-desing-patterns-with-golang/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Design Patterns in Go: Idiomatic Implementations">EN
</span></a><a href=/it/posts/implement-desing-patterns-with-golang/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="Design Pattern in Go: Implementazioni Idiomatiche">IT</span></a></li></ul></div></div></nav></div></div></div></div></div><script>(function(){var t,n,e=document.querySelector(".main-menu");if(!e)return;t=window.location.pathname,n=e.querySelectorAll('a[href="'+t+'"]'),n.forEach(function(e){var t=e.querySelectorAll("span");t.forEach(function(e){e.classList.add("active")})})})()</script></div></div><script type=text/javascript src=/js/background-blur.min.00a57c73ea12f2cab2980c3c3d649e89f6d82f190f74bbe2b67f2f5e39ab7d032ece47086400ca05396758aace13299da49aca43ea643d2625e62c506267a169.js integrity="sha512-AKV8c+oS8sqymAw8PWSeifbYLxkPdLvitn8vXjmrfQMuzkcIZADKBTlnWKrOEymdpJrKQ+pkPSYl5ixQYmehaQ==" data-blur-id=menu-blur></script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"><img id=background-image src="https://images.unsplash.com/photo-1518770660439-4636190af475?w=1200&amp;q=85" role=presentation loading=eager decoding=async fetchpriority=high class="absolute inset-0 w-full h-full object-cover"><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-xl bg-neutral-100/75 dark:bg-neutral-800/60"></div><script type=text/javascript src=/js/background-blur.min.00a57c73ea12f2cab2980c3c3d649e89f6d82f190f74bbe2b67f2f5e39ab7d032ece47086400ca05396758aace13299da49aca43ea643d2625e62c506267a169.js integrity="sha512-AKV8c+oS8sqymAw8PWSeifbYLxkPdLvitn8vXjmrfQMuzkcIZADKBTlnWKrOEymdpJrKQ+pkPSYl5ixQYmehaQ==" data-blur-id=background-blur data-image-id=background-image data-image-url="https://images.unsplash.com/photo-1518770660439-4636190af475?w=1200&amp;q=85"></script><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Design Patterns in Go: Idiomatic Implementations</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2023-02-21T13:16:06+01:00>21 February 2023</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">9 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/tags/design-patterns/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Design Patterns
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/golang/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Golang</span></span></a></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ms-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs"><div class="toc ps-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain bf-scrollbar rounded-lg -ms-5 ps-5 pe-2 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#singleton-with-synconce>Singleton with sync.Once</a></li><li><a href=#functional-options-the-go-idiomatic-builder>Functional Options: the Go-Idiomatic Builder</a></li><li><a href=#factory-for-interface-based-construction>Factory for Interface-Based Construction</a></li><li><a href=#observer-with-channels-correct-concurrent-implementation>Observer with Channels: Correct Concurrent Implementation</a></li><li><a href=#strategy-pattern-with-first-class-functions>Strategy Pattern with First-Class Functions</a></li><li><a href=#decorator-pattern-with-http-middleware>Decorator Pattern with HTTP Middleware</a></li><li><a href=#when-not-to-use-these-patterns>When NOT to Use These Patterns</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#singleton-with-synconce>Singleton with sync.Once</a></li><li><a href=#functional-options-the-go-idiomatic-builder>Functional Options: the Go-Idiomatic Builder</a></li><li><a href=#factory-for-interface-based-construction>Factory for Interface-Based Construction</a></li><li><a href=#observer-with-channels-correct-concurrent-implementation>Observer with Channels: Correct Concurrent Implementation</a></li><li><a href=#strategy-pattern-with-first-class-functions>Strategy Pattern with First-Class Functions</a></li><li><a href=#decorator-pattern-with-http-middleware>Decorator Pattern with HTTP Middleware</a></li><li><a href=#when-not-to-use-these-patterns>When NOT to Use These Patterns</a></li></ul></nav></div></details><script>(function(){"use strict";const s=.33,o="#TableOfContents",i=".anchor",a='a[href^="#"]',r="li ul",c="active";let t=!1;function l(e,n){const o=window.scrollY+window.innerHeight*n,i=[...document.querySelectorAll('#TableOfContents a[href^="#"]')],s=new Set(i.map(e=>e.getAttribute("href").substring(1)));if(t)for(let t=0;t<e.length;t++){const n=e[t];if(!s.has(n.id))continue;const o=n.getBoundingClientRect().top+window.scrollY;if(Math.abs(window.scrollY-o)<100)return n.id}for(let t=e.length-1;t>=0;t--){const n=e[t].getBoundingClientRect().top+window.scrollY;if(n<=o&&s.has(e[t].id))return e[t].id}return e.find(e=>s.has(e.id))?.id||""}function e({toc:e,anchors:t,links:n,scrollOffset:s,collapseInactive:o}){const i=l(t,s);if(!i)return;if(n.forEach(e=>{const t=e.getAttribute("href")===`#${i}`;if(e.classList.toggle(c,t),o){const n=e.closest("li")?.querySelector("ul");n&&(n.style.display=t?"":"none")}}),o){const n=e.querySelector(`a[href="#${CSS.escape(i)}"]`);let t=n;for(;t&&t!==e;)t.tagName==="UL"&&(t.style.display=""),t.tagName==="LI"&&t.querySelector("ul")?.style.setProperty("display",""),t=t.parentElement}}function n(){const n=document.querySelector(o);if(!n)return;const l=!0,u=[...document.querySelectorAll(i)],d=[...n.querySelectorAll(a)];l&&n.querySelectorAll(r).forEach(e=>e.style.display="none"),d.forEach(e=>{e.addEventListener("click",()=>{t=!0})});const c={toc:n,anchors:u,links:d,scrollOffset:s,collapseInactive:l};window.addEventListener("scroll",()=>e(c),{passive:!0}),window.addEventListener("hashchange",()=>e(c),{passive:!0}),e(c)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n()})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><div class="lead text-neutral-500 dark:text-neutral-400 !mb-9 text-xl">Go approaches design patterns differently from Java or C++. Because Go uses composition instead of inheritance, and because functions are first-class values, many patterns that require elaborate class hierarchies in OOP languages collapse into a few idiomatic Go constructs. This post shows the correct, production-ready implementations and, just as importantly, tells you when not to reach for a pattern at all.</div><p>Design patterns are not a checklist. In Go, applying Java-style patterns wholesale is the fastest path to code that looks foreign to every Go developer who reads it. The patterns below are presented in their idiomatic Go form, which is often significantly simpler than the textbook version.</p><h2 class="relative group">Singleton with sync.Once<div id=singleton-with-synconce class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#singleton-with-synconce aria-label=Anchor>#</a></span></h2><p>The canonical Go singleton uses <code>sync.Once</code>, which guarantees the initializer runs exactly once regardless of how many goroutines call <code>GetInstance</code> concurrently. There is no lock-check-lock dance, no <code>volatile</code> keyword, no double-checked locking: the runtime handles all of that internally.</p><div class=highlight-wrapper><div class=codeblock-title>singleton.go</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>package</span> config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#a3be8c>&#34;sync&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>type</span> AppConfig <span style=color:#81a1c1;font-weight:700>struct</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    DatabaseURL <span style=color:#81a1c1>string</span>
</span></span><span style=display:flex><span>    Port        <span style=color:#81a1c1>int</span>
</span></span><span style=display:flex><span>    Debug       <span style=color:#81a1c1>bool</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>var</span> <span style=color:#eceff4>(</span>
</span></span><span style=display:flex><span>    instance <span style=color:#81a1c1>*</span>AppConfig
</span></span><span style=display:flex><span>    once     sync<span style=color:#eceff4>.</span>Once
</span></span><span style=display:flex><span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#88c0d0>GetConfig</span><span style=color:#eceff4>()</span> <span style=color:#81a1c1>*</span>AppConfig <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    once<span style=color:#eceff4>.</span><span style=color:#88c0d0>Do</span><span style=color:#eceff4>(</span><span style=color:#81a1c1;font-weight:700>func</span><span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        instance <span style=color:#eceff4>=</span> <span style=color:#81a1c1>&amp;</span>AppConfig<span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>            DatabaseURL<span style=color:#eceff4>:</span> <span style=color:#a3be8c>&#34;postgres://localhost/mydb&#34;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>            Port<span style=color:#eceff4>:</span>        <span style=color:#b48ead>8080</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>            Debug<span style=color:#eceff4>:</span>       <span style=color:#81a1c1;font-weight:700>false</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>        <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>})</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> instance
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span></span></span></code></pre></div></div><div class="admonition relative overflow-hidden rounded-lg border-l-4 my-3 px-4 py-3 shadow-sm" data-type=note><div class="flex items-center gap-2 font-semibold text-inherit"><div class="flex shrink-0 h-5 w-5 items-center justify-center text-lg"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 0C114.6.0.0 114.6.0 256s114.6 256 256 256 256-114.6 256-256S397.4.0 256 0zm0 128c17.67.0 32 14.33 32 32 0 17.67-14.33 32-32 32s-32-14.3-32-32 14.3-32 32-32zm40 256h-80c-13.2.0-24-10.7-24-24s10.75-24 24-24h16v-64h-8c-13.25.0-24-10.75-24-24s10.8-24 24-24h32c13.25.0 24 10.75 24 24v88h16c13.25.0 24 10.75 24 24s-10.7 24-24 24z"/></svg></span></div><div class=grow>Note</div></div><div class="admonition-content mt-3 text-base leading-relaxed text-inherit"><p><code>sync.Once</code> is safe for concurrent use. Once <code>Do</code> has run, subsequent calls return immediately without acquiring any lock. This makes it essentially free on the hot path after initialization.</p></div></div><p>The pattern is appropriate for truly global state: configuration loaded once at startup, a shared database connection pool, or a metrics registry. Avoid it for anything that needs to be reset between tests. A singleton that cannot be replaced makes unit testing painful.</p><h2 class="relative group">Functional Options: the Go-Idiomatic Builder<div id=functional-options-the-go-idiomatic-builder class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#functional-options-the-go-idiomatic-builder aria-label=Anchor>#</a></span></h2><p>The classical Builder pattern (interface with <code>SetX</code> methods returning the builder) exists in Go but the idiomatic approach is the <strong>functional options</strong> pattern, introduced by Rob Pike. Instead of a builder object, you pass variadic option functions that mutate a configuration struct before the real object is constructed.</p><div class=highlight-wrapper><div class=codeblock-title>server.go</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>package</span> server
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#eceff4>(</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>&#34;time&#34;</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>type</span> Server <span style=color:#81a1c1;font-weight:700>struct</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    addr           <span style=color:#81a1c1>string</span>
</span></span><span style=display:flex><span>    readTimeout    time<span style=color:#eceff4>.</span>Duration
</span></span><span style=display:flex><span>    writeTimeout   time<span style=color:#eceff4>.</span>Duration
</span></span><span style=display:flex><span>    maxHeaderBytes <span style=color:#81a1c1>int</span>
</span></span><span style=display:flex><span>    handler        http<span style=color:#eceff4>.</span>Handler
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// ServerOption is a function that configures a Server.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>type</span> ServerOption <span style=color:#81a1c1;font-weight:700>func</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>*</span>Server<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#88c0d0>WithAddr</span><span style=color:#eceff4>(</span>addr <span style=color:#81a1c1>string</span><span style=color:#eceff4>)</span> ServerOption <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1;font-weight:700>func</span><span style=color:#eceff4>(</span>s <span style=color:#81a1c1>*</span>Server<span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        s<span style=color:#eceff4>.</span>addr <span style=color:#eceff4>=</span> addr
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#88c0d0>WithReadTimeout</span><span style=color:#eceff4>(</span>d time<span style=color:#eceff4>.</span>Duration<span style=color:#eceff4>)</span> ServerOption <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1;font-weight:700>func</span><span style=color:#eceff4>(</span>s <span style=color:#81a1c1>*</span>Server<span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        s<span style=color:#eceff4>.</span>readTimeout <span style=color:#eceff4>=</span> d
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#88c0d0>WithWriteTimeout</span><span style=color:#eceff4>(</span>d time<span style=color:#eceff4>.</span>Duration<span style=color:#eceff4>)</span> ServerOption <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1;font-weight:700>func</span><span style=color:#eceff4>(</span>s <span style=color:#81a1c1>*</span>Server<span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        s<span style=color:#eceff4>.</span>writeTimeout <span style=color:#eceff4>=</span> d
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#88c0d0>WithMaxHeaderBytes</span><span style=color:#eceff4>(</span>n <span style=color:#81a1c1>int</span><span style=color:#eceff4>)</span> ServerOption <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1;font-weight:700>func</span><span style=color:#eceff4>(</span>s <span style=color:#81a1c1>*</span>Server<span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        s<span style=color:#eceff4>.</span>maxHeaderBytes <span style=color:#eceff4>=</span> n
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#88c0d0>NewServer</span><span style=color:#eceff4>(</span>handler http<span style=color:#eceff4>.</span>Handler<span style=color:#eceff4>,</span> opts <span style=color:#81a1c1>...</span>ServerOption<span style=color:#eceff4>)</span> <span style=color:#81a1c1>*</span>Server <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    s <span style=color:#81a1c1>:=</span> <span style=color:#81a1c1>&amp;</span>Server<span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        addr<span style=color:#eceff4>:</span>           <span style=color:#a3be8c>&#34;:8080&#34;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>        readTimeout<span style=color:#eceff4>:</span>    <span style=color:#b48ead>5</span> <span style=color:#81a1c1>*</span> time<span style=color:#eceff4>.</span>Second<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>        writeTimeout<span style=color:#eceff4>:</span>   <span style=color:#b48ead>10</span> <span style=color:#81a1c1>*</span> time<span style=color:#eceff4>.</span>Second<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>        maxHeaderBytes<span style=color:#eceff4>:</span> <span style=color:#b48ead>1</span> <span style=color:#81a1c1>&lt;&lt;</span> <span style=color:#b48ead>20</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>        handler<span style=color:#eceff4>:</span>        handler<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>for</span> _<span style=color:#eceff4>,</span> opt <span style=color:#81a1c1>:=</span> <span style=color:#81a1c1;font-weight:700>range</span> opts <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#88c0d0>opt</span><span style=color:#eceff4>(</span>s<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> s
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#eceff4>(</span>s <span style=color:#81a1c1>*</span>Server<span style=color:#eceff4>)</span> <span style=color:#88c0d0>ListenAndServe</span><span style=color:#eceff4>()</span> <span style=color:#81a1c1>error</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    srv <span style=color:#81a1c1>:=</span> <span style=color:#81a1c1>&amp;</span>http<span style=color:#eceff4>.</span>Server<span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        Addr<span style=color:#eceff4>:</span>           s<span style=color:#eceff4>.</span>addr<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>        Handler<span style=color:#eceff4>:</span>        s<span style=color:#eceff4>.</span>handler<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>        ReadTimeout<span style=color:#eceff4>:</span>    s<span style=color:#eceff4>.</span>readTimeout<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>        WriteTimeout<span style=color:#eceff4>:</span>   s<span style=color:#eceff4>.</span>writeTimeout<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>        MaxHeaderBytes<span style=color:#eceff4>:</span> s<span style=color:#eceff4>.</span>maxHeaderBytes<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> srv<span style=color:#eceff4>.</span><span style=color:#88c0d0>ListenAndServe</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span></span></span></code></pre></div></div><p>Call site:</p><div class=highlight-wrapper><div class=codeblock-title>main.go</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>srv <span style=color:#81a1c1>:=</span> server<span style=color:#eceff4>.</span><span style=color:#88c0d0>NewServer</span><span style=color:#eceff4>(</span>
</span></span><span style=display:flex><span>    myHandler<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>    server<span style=color:#eceff4>.</span><span style=color:#88c0d0>WithAddr</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;:9090&#34;</span><span style=color:#eceff4>),</span>
</span></span><span style=display:flex><span>    server<span style=color:#eceff4>.</span><span style=color:#88c0d0>WithReadTimeout</span><span style=color:#eceff4>(</span><span style=color:#b48ead>30</span> <span style=color:#81a1c1>*</span> time<span style=color:#eceff4>.</span>Second<span style=color:#eceff4>),</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>)</span></span></span></code></pre></div></div><p>This is better than a classical Builder for Go because the defaults live in one place (<code>NewServer</code>), option functions are individually testable and composable, and callers only specify what they want to override. The standard library itself uses this pattern extensively (<code>grpc.Dial</code>, <code>sql.Open</code> wrappers, etc.).</p><h2 class="relative group">Factory for Interface-Based Construction<div id=factory-for-interface-based-construction class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#factory-for-interface-based-construction aria-label=Anchor>#</a></span></h2><p>Use a factory when you need to produce different concrete types behind a shared interface and the caller should not need to import the concrete packages. A realistic production example: a notification sender with Email, SMS, and Slack backends.</p><div class=highlight-wrapper><div class=codeblock-title>notify/factory.go</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>package</span> notify
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#a3be8c>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// Sender is the interface every notification backend must implement.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>type</span> Sender <span style=color:#81a1c1;font-weight:700>interface</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#88c0d0>Send</span><span style=color:#eceff4>(</span>to<span style=color:#eceff4>,</span> subject<span style=color:#eceff4>,</span> body <span style=color:#81a1c1>string</span><span style=color:#eceff4>)</span> <span style=color:#81a1c1>error</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// EmailSender sends notifications via SMTP.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>type</span> EmailSender <span style=color:#81a1c1;font-weight:700>struct</span><span style=color:#eceff4>{</span> SMTPHost <span style=color:#81a1c1>string</span> <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#eceff4>(</span>e <span style=color:#81a1c1>*</span>EmailSender<span style=color:#eceff4>)</span> <span style=color:#88c0d0>Send</span><span style=color:#eceff4>(</span>to<span style=color:#eceff4>,</span> subject<span style=color:#eceff4>,</span> body <span style=color:#81a1c1>string</span><span style=color:#eceff4>)</span> <span style=color:#81a1c1>error</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    fmt<span style=color:#eceff4>.</span><span style=color:#88c0d0>Printf</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;[EMAIL] to=%s subject=%s\n&#34;</span><span style=color:#eceff4>,</span> to<span style=color:#eceff4>,</span> subject<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1;font-weight:700>nil</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// SMSSender sends notifications via an SMS gateway.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>type</span> SMSSender <span style=color:#81a1c1;font-weight:700>struct</span><span style=color:#eceff4>{</span> APIKey <span style=color:#81a1c1>string</span> <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#eceff4>(</span>s <span style=color:#81a1c1>*</span>SMSSender<span style=color:#eceff4>)</span> <span style=color:#88c0d0>Send</span><span style=color:#eceff4>(</span>to<span style=color:#eceff4>,</span> subject<span style=color:#eceff4>,</span> body <span style=color:#81a1c1>string</span><span style=color:#eceff4>)</span> <span style=color:#81a1c1>error</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    fmt<span style=color:#eceff4>.</span><span style=color:#88c0d0>Printf</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;[SMS] to=%s body=%s\n&#34;</span><span style=color:#eceff4>,</span> to<span style=color:#eceff4>,</span> body<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1;font-weight:700>nil</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// SlackSender posts to a Slack channel.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>type</span> SlackSender <span style=color:#81a1c1;font-weight:700>struct</span><span style=color:#eceff4>{</span> WebhookURL <span style=color:#81a1c1>string</span> <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#eceff4>(</span>sl <span style=color:#81a1c1>*</span>SlackSender<span style=color:#eceff4>)</span> <span style=color:#88c0d0>Send</span><span style=color:#eceff4>(</span>to<span style=color:#eceff4>,</span> subject<span style=color:#eceff4>,</span> body <span style=color:#81a1c1>string</span><span style=color:#eceff4>)</span> <span style=color:#81a1c1>error</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    fmt<span style=color:#eceff4>.</span><span style=color:#88c0d0>Printf</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;[SLACK] channel=%s body=%s\n&#34;</span><span style=color:#eceff4>,</span> to<span style=color:#eceff4>,</span> body<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1;font-weight:700>nil</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// NewSender is the factory function. config is a map of provider-specific values.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#88c0d0>NewSender</span><span style=color:#eceff4>(</span>provider <span style=color:#81a1c1>string</span><span style=color:#eceff4>,</span> config <span style=color:#81a1c1;font-weight:700>map</span><span style=color:#eceff4>[</span><span style=color:#81a1c1>string</span><span style=color:#eceff4>]</span><span style=color:#81a1c1>string</span><span style=color:#eceff4>)</span> <span style=color:#eceff4>(</span>Sender<span style=color:#eceff4>,</span> <span style=color:#81a1c1>error</span><span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>switch</span> provider <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>case</span> <span style=color:#a3be8c>&#34;email&#34;</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1>&amp;</span>EmailSender<span style=color:#eceff4>{</span>SMTPHost<span style=color:#eceff4>:</span> config<span style=color:#eceff4>[</span><span style=color:#a3be8c>&#34;smtp_host&#34;</span><span style=color:#eceff4>]},</span> <span style=color:#81a1c1;font-weight:700>nil</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>case</span> <span style=color:#a3be8c>&#34;sms&#34;</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1>&amp;</span>SMSSender<span style=color:#eceff4>{</span>APIKey<span style=color:#eceff4>:</span> config<span style=color:#eceff4>[</span><span style=color:#a3be8c>&#34;api_key&#34;</span><span style=color:#eceff4>]},</span> <span style=color:#81a1c1;font-weight:700>nil</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>case</span> <span style=color:#a3be8c>&#34;slack&#34;</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1>&amp;</span>SlackSender<span style=color:#eceff4>{</span>WebhookURL<span style=color:#eceff4>:</span> config<span style=color:#eceff4>[</span><span style=color:#a3be8c>&#34;webhook_url&#34;</span><span style=color:#eceff4>]},</span> <span style=color:#81a1c1;font-weight:700>nil</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>default</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1;font-weight:700>nil</span><span style=color:#eceff4>,</span> fmt<span style=color:#eceff4>.</span><span style=color:#88c0d0>Errorf</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;unknown notification provider: %s&#34;</span><span style=color:#eceff4>,</span> provider<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span></span></span></code></pre></div></div><div class="admonition relative overflow-hidden rounded-lg border-l-4 my-3 px-4 py-3 shadow-sm" data-type=tip><div class="flex items-center gap-2 font-semibold text-inherit"><div class="flex shrink-0 h-5 w-5 items-center justify-center text-lg"><span class="relative block icon"><svg viewBox="0 0 384 512"><path fill="currentColor" d="M112.1 454.3c0 6.297 1.816 12.44 5.284 17.69l17.14 25.69c5.25 7.875 17.17 14.28 26.64 14.28h61.67c9.438.0 21.36-6.401 26.61-14.28l17.08-25.68c2.938-4.438 5.348-12.37 5.348-17.7L272 415.1H112L112.1 454.3zM191.4.0132C89.44.3257 16 82.97 16 175.1c0 44.38 16.44 84.84 43.56 115.8 16.53 18.84 42.34 58.23 52.22 91.45.0313.25.0938.5166.125.7823h160.2c.0313-.2656.0938-.5166.125-.7823 9.875-33.22 35.69-72.61 52.22-91.45C351.6 260.8 368 220.4 368 175.1 368 78.61 288.9-.2837 191.4.0132zM192 96.01c-44.13.0-80 35.89-80 79.1.0 9.69-7.2 16.89-16 16.89S80 184.8 80 176c0-61.76 50.25-111.1 112-111.1 8.844.0 16 7.159 16 16S200.8 96.01 192 96.01z"/></svg></span></div><div class=grow>Tip</div></div><div class="admonition-content mt-3 text-base leading-relaxed text-inherit"><p>Return <code>(Sender, error)</code> from the factory, never just <code>Sender</code>. Configuration problems (missing API keys, invalid addresses) should surface at construction time, not when the first message is sent at 3 AM.</p></div></div><h2 class="relative group">Observer with Channels: Correct Concurrent Implementation<div id=observer-with-channels-correct-concurrent-implementation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#observer-with-channels-correct-concurrent-implementation aria-label=Anchor>#</a></span></h2><p>The naive Observer implementation using unbuffered channels will deadlock or panic. Calling <code>Notify</code> from the same goroutine as the channel receivers blocks forever on an unbuffered channel. Using a <code>WaitGroup</code> and buffered channels solves both problems: the sender never blocks, and cleanup waits for all goroutines to finish processing.</p><div class=highlight-wrapper><div class=codeblock-title>observable.go</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>package</span> events
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#eceff4>(</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>&#34;sync&#34;</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>type</span> Observable <span style=color:#81a1c1;font-weight:700>struct</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    observers <span style=color:#eceff4>[]</span><span style=color:#81a1c1;font-weight:700>chan</span> <span style=color:#81a1c1>int</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#eceff4>(</span>o <span style=color:#81a1c1>*</span>Observable<span style=color:#eceff4>)</span> <span style=color:#88c0d0>AddObserver</span><span style=color:#eceff4>(</span>c <span style=color:#81a1c1;font-weight:700>chan</span> <span style=color:#81a1c1>int</span><span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    o<span style=color:#eceff4>.</span>observers <span style=color:#eceff4>=</span> <span style=color:#81a1c1>append</span><span style=color:#eceff4>(</span>o<span style=color:#eceff4>.</span>observers<span style=color:#eceff4>,</span> c<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// Notify sends n to all observers without blocking.</span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// Each observer channel must be buffered to at least the expected burst size.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#eceff4>(</span>o <span style=color:#81a1c1>*</span>Observable<span style=color:#eceff4>)</span> <span style=color:#88c0d0>Notify</span><span style=color:#eceff4>(</span>n <span style=color:#81a1c1>int</span><span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>for</span> _<span style=color:#eceff4>,</span> c <span style=color:#81a1c1>:=</span> <span style=color:#81a1c1;font-weight:700>range</span> o<span style=color:#eceff4>.</span>observers <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        c <span style=color:#81a1c1>&lt;-</span> n
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// CloseAll signals all observer goroutines to stop by closing their channels.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#eceff4>(</span>o <span style=color:#81a1c1>*</span>Observable<span style=color:#eceff4>)</span> <span style=color:#88c0d0>CloseAll</span><span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>for</span> _<span style=color:#eceff4>,</span> c <span style=color:#81a1c1>:=</span> <span style=color:#81a1c1;font-weight:700>range</span> o<span style=color:#eceff4>.</span>observers <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1>close</span><span style=color:#eceff4>(</span>c<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#88c0d0>Example</span><span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    observable <span style=color:#81a1c1>:=</span> <span style=color:#81a1c1>&amp;</span>Observable<span style=color:#eceff4>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#616e87;font-style:italic>// Buffered channels prevent Notify from blocking.</span>
</span></span><span style=display:flex><span>    observer1 <span style=color:#81a1c1>:=</span> <span style=color:#81a1c1>make</span><span style=color:#eceff4>(</span><span style=color:#81a1c1;font-weight:700>chan</span> <span style=color:#81a1c1>int</span><span style=color:#eceff4>,</span> <span style=color:#b48ead>10</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    observer2 <span style=color:#81a1c1>:=</span> <span style=color:#81a1c1>make</span><span style=color:#eceff4>(</span><span style=color:#81a1c1;font-weight:700>chan</span> <span style=color:#81a1c1>int</span><span style=color:#eceff4>,</span> <span style=color:#b48ead>10</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    observable<span style=color:#eceff4>.</span><span style=color:#88c0d0>AddObserver</span><span style=color:#eceff4>(</span>observer1<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    observable<span style=color:#eceff4>.</span><span style=color:#88c0d0>AddObserver</span><span style=color:#eceff4>(</span>observer2<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>var</span> wg sync<span style=color:#eceff4>.</span>WaitGroup
</span></span><span style=display:flex><span>    wg<span style=color:#eceff4>.</span><span style=color:#88c0d0>Add</span><span style=color:#eceff4>(</span><span style=color:#b48ead>2</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>go</span> <span style=color:#81a1c1;font-weight:700>func</span><span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>defer</span> wg<span style=color:#eceff4>.</span><span style=color:#88c0d0>Done</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>for</span> n <span style=color:#81a1c1>:=</span> <span style=color:#81a1c1;font-weight:700>range</span> observer1 <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>            fmt<span style=color:#eceff4>.</span><span style=color:#88c0d0>Println</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;Observer 1 received:&#34;</span><span style=color:#eceff4>,</span> n<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>        <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>go</span> <span style=color:#81a1c1;font-weight:700>func</span><span style=color:#eceff4>()</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>defer</span> wg<span style=color:#eceff4>.</span><span style=color:#88c0d0>Done</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>for</span> n <span style=color:#81a1c1>:=</span> <span style=color:#81a1c1;font-weight:700>range</span> observer2 <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>            fmt<span style=color:#eceff4>.</span><span style=color:#88c0d0>Println</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;Observer 2 received:&#34;</span><span style=color:#eceff4>,</span> n<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>        <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    observable<span style=color:#eceff4>.</span><span style=color:#88c0d0>Notify</span><span style=color:#eceff4>(</span><span style=color:#b48ead>1</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    observable<span style=color:#eceff4>.</span><span style=color:#88c0d0>Notify</span><span style=color:#eceff4>(</span><span style=color:#b48ead>2</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    observable<span style=color:#eceff4>.</span><span style=color:#88c0d0>Notify</span><span style=color:#eceff4>(</span><span style=color:#b48ead>3</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#616e87;font-style:italic>// Close channels to signal goroutines to exit, then wait for them.</span>
</span></span><span style=display:flex><span>    observable<span style=color:#eceff4>.</span><span style=color:#88c0d0>CloseAll</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>    wg<span style=color:#eceff4>.</span><span style=color:#88c0d0>Wait</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span></span></span></code></pre></div></div><p>The <code>WaitGroup</code> guarantees that all events are processed before the program exits. Without it, goroutines may be killed mid-processing by <code>main</code> returning.</p><h2 class="relative group">Strategy Pattern with First-Class Functions<div id=strategy-pattern-with-first-class-functions class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#strategy-pattern-with-first-class-functions aria-label=Anchor>#</a></span></h2><p>In Java, Strategy requires an interface with a single method plus a family of implementing classes. In Go, a function type is already a strategy. No interface, no struct, no method set.</p><div class=highlight-wrapper><div class=codeblock-title>sorter.go</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>package</span> sorter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// SortStrategy is a function type. Any function with this signature is a strategy.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>type</span> SortStrategy <span style=color:#81a1c1;font-weight:700>func</span><span style=color:#eceff4>(</span>data <span style=color:#eceff4>[]</span><span style=color:#81a1c1>int</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// Sorter delegates sorting to whichever strategy is configured.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>type</span> Sorter <span style=color:#81a1c1;font-weight:700>struct</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    strategy SortStrategy
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#88c0d0>NewSorter</span><span style=color:#eceff4>(</span>s SortStrategy<span style=color:#eceff4>)</span> <span style=color:#81a1c1>*</span>Sorter <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1>&amp;</span>Sorter<span style=color:#eceff4>{</span>strategy<span style=color:#eceff4>:</span> s<span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#eceff4>(</span>s <span style=color:#81a1c1>*</span>Sorter<span style=color:#eceff4>)</span> <span style=color:#88c0d0>Sort</span><span style=color:#eceff4>(</span>data <span style=color:#eceff4>[]</span><span style=color:#81a1c1>int</span><span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    s<span style=color:#eceff4>.</span><span style=color:#88c0d0>strategy</span><span style=color:#eceff4>(</span>data<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// Concrete strategies are plain functions.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#88c0d0>BubbleSort</span><span style=color:#eceff4>(</span>data <span style=color:#eceff4>[]</span><span style=color:#81a1c1>int</span><span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    n <span style=color:#81a1c1>:=</span> <span style=color:#81a1c1>len</span><span style=color:#eceff4>(</span>data<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>for</span> i <span style=color:#81a1c1>:=</span> <span style=color:#b48ead>0</span><span style=color:#eceff4>;</span> i <span style=color:#eceff4>&lt;</span> n<span style=color:#81a1c1>-</span><span style=color:#b48ead>1</span><span style=color:#eceff4>;</span> i<span style=color:#81a1c1>++</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>for</span> j <span style=color:#81a1c1>:=</span> <span style=color:#b48ead>0</span><span style=color:#eceff4>;</span> j <span style=color:#eceff4>&lt;</span> n<span style=color:#81a1c1>-</span><span style=color:#b48ead>1</span><span style=color:#81a1c1>-</span>i<span style=color:#eceff4>;</span> j<span style=color:#81a1c1>++</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>            <span style=color:#81a1c1;font-weight:700>if</span> data<span style=color:#eceff4>[</span>j<span style=color:#eceff4>]</span> <span style=color:#eceff4>&gt;</span> data<span style=color:#eceff4>[</span>j<span style=color:#81a1c1>+</span><span style=color:#b48ead>1</span><span style=color:#eceff4>]</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>                data<span style=color:#eceff4>[</span>j<span style=color:#eceff4>],</span> data<span style=color:#eceff4>[</span>j<span style=color:#81a1c1>+</span><span style=color:#b48ead>1</span><span style=color:#eceff4>]</span> <span style=color:#eceff4>=</span> data<span style=color:#eceff4>[</span>j<span style=color:#81a1c1>+</span><span style=color:#b48ead>1</span><span style=color:#eceff4>],</span> data<span style=color:#eceff4>[</span>j<span style=color:#eceff4>]</span>
</span></span><span style=display:flex><span>            <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>        <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#88c0d0>QuickSort</span><span style=color:#eceff4>(</span>data <span style=color:#eceff4>[]</span><span style=color:#81a1c1>int</span><span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>if</span> <span style=color:#81a1c1>len</span><span style=color:#eceff4>(</span>data<span style=color:#eceff4>)</span> <span style=color:#81a1c1>&lt;=</span> <span style=color:#b48ead>1</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>return</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    pivot <span style=color:#81a1c1>:=</span> data<span style=color:#eceff4>[</span><span style=color:#81a1c1>len</span><span style=color:#eceff4>(</span>data<span style=color:#eceff4>)</span><span style=color:#81a1c1>/</span><span style=color:#b48ead>2</span><span style=color:#eceff4>]</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>var</span> left<span style=color:#eceff4>,</span> right<span style=color:#eceff4>,</span> equal <span style=color:#eceff4>[]</span><span style=color:#81a1c1>int</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>for</span> _<span style=color:#eceff4>,</span> v <span style=color:#81a1c1>:=</span> <span style=color:#81a1c1;font-weight:700>range</span> data <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>switch</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>case</span> v <span style=color:#eceff4>&lt;</span> pivot<span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>            left <span style=color:#eceff4>=</span> <span style=color:#81a1c1>append</span><span style=color:#eceff4>(</span>left<span style=color:#eceff4>,</span> v<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>case</span> v <span style=color:#eceff4>&gt;</span> pivot<span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>            right <span style=color:#eceff4>=</span> <span style=color:#81a1c1>append</span><span style=color:#eceff4>(</span>right<span style=color:#eceff4>,</span> v<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>default</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>            equal <span style=color:#eceff4>=</span> <span style=color:#81a1c1>append</span><span style=color:#eceff4>(</span>equal<span style=color:#eceff4>,</span> v<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>        <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    <span style=color:#88c0d0>QuickSort</span><span style=color:#eceff4>(</span>left<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#88c0d0>QuickSort</span><span style=color:#eceff4>(</span>right<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1>copy</span><span style=color:#eceff4>(</span>data<span style=color:#eceff4>,</span> <span style=color:#81a1c1>append</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>append</span><span style=color:#eceff4>(</span>left<span style=color:#eceff4>,</span> equal<span style=color:#81a1c1>...</span><span style=color:#eceff4>),</span> right<span style=color:#81a1c1>...</span><span style=color:#eceff4>))</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span></span></span></code></pre></div></div><p>Swapping strategies at runtime:</p><div class=highlight-wrapper><div class=codeblock-title>main.go</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>s <span style=color:#81a1c1>:=</span> sorter<span style=color:#eceff4>.</span><span style=color:#88c0d0>NewSorter</span><span style=color:#eceff4>(</span>sorter<span style=color:#eceff4>.</span>QuickSort<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>s<span style=color:#eceff4>.</span><span style=color:#88c0d0>Sort</span><span style=color:#eceff4>(</span>data<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// Switch strategy based on input size.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>if</span> <span style=color:#81a1c1>len</span><span style=color:#eceff4>(</span>data<span style=color:#eceff4>)</span> <span style=color:#eceff4>&lt;</span> <span style=color:#b48ead>20</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    s <span style=color:#eceff4>=</span> sorter<span style=color:#eceff4>.</span><span style=color:#88c0d0>NewSorter</span><span style=color:#eceff4>(</span>sorter<span style=color:#eceff4>.</span>BubbleSort<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span></span></span></code></pre></div></div><h2 class="relative group">Decorator Pattern with HTTP Middleware<div id=decorator-pattern-with-http-middleware class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#decorator-pattern-with-http-middleware aria-label=Anchor>#</a></span></h2><p>In Go, HTTP middleware is the canonical Decorator implementation. An <code>http.Handler</code> is wrapped by a function that adds cross-cutting concerns (logging, authentication, rate limiting) without modifying the inner handler.</p><div class=highlight-wrapper><div class=codeblock-title>middleware.go</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>package</span> middleware
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#eceff4>(</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>&#34;log&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>&#34;time&#34;</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// Logger wraps an http.Handler to log request duration.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#88c0d0>Logger</span><span style=color:#eceff4>(</span>next http<span style=color:#eceff4>.</span>Handler<span style=color:#eceff4>)</span> http<span style=color:#eceff4>.</span>Handler <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> http<span style=color:#eceff4>.</span><span style=color:#88c0d0>HandlerFunc</span><span style=color:#eceff4>(</span><span style=color:#81a1c1;font-weight:700>func</span><span style=color:#eceff4>(</span>w http<span style=color:#eceff4>.</span>ResponseWriter<span style=color:#eceff4>,</span> r <span style=color:#81a1c1>*</span>http<span style=color:#eceff4>.</span>Request<span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        start <span style=color:#81a1c1>:=</span> time<span style=color:#eceff4>.</span><span style=color:#88c0d0>Now</span><span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>        next<span style=color:#eceff4>.</span><span style=color:#88c0d0>ServeHTTP</span><span style=color:#eceff4>(</span>w<span style=color:#eceff4>,</span> r<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>        log<span style=color:#eceff4>.</span><span style=color:#88c0d0>Printf</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;%s %s %s&#34;</span><span style=color:#eceff4>,</span> r<span style=color:#eceff4>.</span>Method<span style=color:#eceff4>,</span> r<span style=color:#eceff4>.</span>URL<span style=color:#eceff4>.</span>Path<span style=color:#eceff4>,</span> time<span style=color:#eceff4>.</span><span style=color:#88c0d0>Since</span><span style=color:#eceff4>(</span>start<span style=color:#eceff4>))</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>})</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// RequireAuth wraps an http.Handler to enforce bearer token authentication.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#88c0d0>RequireAuth</span><span style=color:#eceff4>(</span>token <span style=color:#81a1c1>string</span><span style=color:#eceff4>,</span> next http<span style=color:#eceff4>.</span>Handler<span style=color:#eceff4>)</span> http<span style=color:#eceff4>.</span>Handler <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> http<span style=color:#eceff4>.</span><span style=color:#88c0d0>HandlerFunc</span><span style=color:#eceff4>(</span><span style=color:#81a1c1;font-weight:700>func</span><span style=color:#eceff4>(</span>w http<span style=color:#eceff4>.</span>ResponseWriter<span style=color:#eceff4>,</span> r <span style=color:#81a1c1>*</span>http<span style=color:#eceff4>.</span>Request<span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>if</span> r<span style=color:#eceff4>.</span>Header<span style=color:#eceff4>.</span><span style=color:#88c0d0>Get</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;Authorization&#34;</span><span style=color:#eceff4>)</span> <span style=color:#81a1c1>!=</span> <span style=color:#a3be8c>&#34;Bearer &#34;</span><span style=color:#81a1c1>+</span>token <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>            http<span style=color:#eceff4>.</span><span style=color:#88c0d0>Error</span><span style=color:#eceff4>(</span>w<span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#34;unauthorized&#34;</span><span style=color:#eceff4>,</span> http<span style=color:#eceff4>.</span>StatusUnauthorized<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>            <span style=color:#81a1c1;font-weight:700>return</span>
</span></span><span style=display:flex><span>        <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>        next<span style=color:#eceff4>.</span><span style=color:#88c0d0>ServeHTTP</span><span style=color:#eceff4>(</span>w<span style=color:#eceff4>,</span> r<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>})</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// RateLimit wraps an http.Handler with a token bucket (simplified example).</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#88c0d0>RateLimit</span><span style=color:#eceff4>(</span>rps <span style=color:#81a1c1>int</span><span style=color:#eceff4>,</span> next http<span style=color:#eceff4>.</span>Handler<span style=color:#eceff4>)</span> http<span style=color:#eceff4>.</span>Handler <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    ticker <span style=color:#81a1c1>:=</span> time<span style=color:#eceff4>.</span><span style=color:#88c0d0>NewTicker</span><span style=color:#eceff4>(</span>time<span style=color:#eceff4>.</span>Second <span style=color:#81a1c1>/</span> time<span style=color:#eceff4>.</span><span style=color:#88c0d0>Duration</span><span style=color:#eceff4>(</span>rps<span style=color:#eceff4>))</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> http<span style=color:#eceff4>.</span><span style=color:#88c0d0>HandlerFunc</span><span style=color:#eceff4>(</span><span style=color:#81a1c1;font-weight:700>func</span><span style=color:#eceff4>(</span>w http<span style=color:#eceff4>.</span>ResponseWriter<span style=color:#eceff4>,</span> r <span style=color:#81a1c1>*</span>http<span style=color:#eceff4>.</span>Request<span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>select</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>case</span> <span style=color:#81a1c1>&lt;-</span>ticker<span style=color:#eceff4>.</span>C<span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>            next<span style=color:#eceff4>.</span><span style=color:#88c0d0>ServeHTTP</span><span style=color:#eceff4>(</span>w<span style=color:#eceff4>,</span> r<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>default</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>            http<span style=color:#eceff4>.</span><span style=color:#88c0d0>Error</span><span style=color:#eceff4>(</span>w<span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#34;rate limit exceeded&#34;</span><span style=color:#eceff4>,</span> http<span style=color:#eceff4>.</span>StatusTooManyRequests<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>        <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>})</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span></span></span></code></pre></div></div><p>Chaining decorators at the call site:</p><div class=highlight-wrapper><div class=codeblock-title>main.go</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>var</span> handler http<span style=color:#eceff4>.</span>Handler <span style=color:#eceff4>=</span> myAPIHandler
</span></span><span style=display:flex><span>handler <span style=color:#eceff4>=</span> middleware<span style=color:#eceff4>.</span><span style=color:#88c0d0>Logger</span><span style=color:#eceff4>(</span>handler<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>handler <span style=color:#eceff4>=</span> middleware<span style=color:#eceff4>.</span><span style=color:#88c0d0>RequireAuth</span><span style=color:#eceff4>(</span>os<span style=color:#eceff4>.</span><span style=color:#88c0d0>Getenv</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;API_TOKEN&#34;</span><span style=color:#eceff4>),</span> handler<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>handler <span style=color:#eceff4>=</span> middleware<span style=color:#eceff4>.</span><span style=color:#88c0d0>RateLimit</span><span style=color:#eceff4>(</span><span style=color:#b48ead>100</span><span style=color:#eceff4>,</span> handler<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>http<span style=color:#eceff4>.</span><span style=color:#88c0d0>ListenAndServe</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;:8080&#34;</span><span style=color:#eceff4>,</span> handler<span style=color:#eceff4>)</span></span></span></code></pre></div></div><p>Each middleware layer is independently testable by passing a simple <code>http.HandlerFunc</code> as <code>next</code>.</p><h2 class="relative group">When NOT to Use These Patterns<div id=when-not-to-use-these-patterns class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#when-not-to-use-these-patterns aria-label=Anchor>#</a></span></h2><p>Go&rsquo;s composition model often makes patterns unnecessary or even counterproductive.</p><table><thead><tr><th>Situation</th><th>Pattern you might reach for</th><th>What to do in Go instead</th></tr></thead><tbody><tr><td>Shared global state</td><td>Singleton</td><td>Pass dependencies as arguments; use <code>sync.Once</code> only when global init is truly required</td></tr><tr><td>Configuring a struct</td><td>Builder</td><td>Functional options or a plain config struct with sensible zero values</td></tr><tr><td>Polymorphic dispatch</td><td>Strategy interface</td><td>Function type or a plain interface with one method</td></tr><tr><td>Adding behavior to a type</td><td>Decorator</td><td>Embed the type in a new struct and add/override methods</td></tr><tr><td>Observing state changes</td><td>Observer with channels</td><td>Use <code>context.Context</code> for cancellation; use <code>sync.Cond</code> for simple synchronization</td></tr></tbody></table><div class="admonition relative overflow-hidden rounded-lg border-l-4 my-3 px-4 py-3 shadow-sm" data-type=warning><div class="flex items-center gap-2 font-semibold text-inherit"><div class="flex shrink-0 h-5 w-5 items-center justify-center text-lg"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M506.3 417 293 53c-16.33-28-57.54-28-73.98.0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6c32.76.0 53.26-35 36.96-63zM232 168c0-13.25 10.75-24 24-24s24 10.8 24 24v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zm24 248c-17.36.0-31.44-14.08-31.44-31.44s14.07-31.44 31.44-31.44 31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg></span></div><div class=grow>Warning</div></div><div class="admonition-content mt-3 text-base leading-relaxed text-inherit"><p>Simulating Java-style inheritance in Go (embedding structs to &ldquo;extend&rdquo; them, then overriding via interface methods) produces code that is difficult to follow and breaks the Go convention that composition is explicit. If you find yourself asking &ldquo;how do I make a struct inherit from another struct,&rdquo; stop and reconsider the data model.</p></div></div><div id=accordion-065b6c082917cf9b6a9cba33a2966676 class="border border-neutral-200 dark:border-neutral-700 rounded-lg overflow-hidden" data-accordion=collapse data-accordion-separated=false>**Over-engineering with the Builder pattern.** A struct with three fields does not need a Builder. Use a struct literal or functional options only when the number of optional parameters is large enough that a long argument list becomes unreadable (roughly five or more optional fields).
**Closing channels before goroutines finish.** The original Observer example in many Go tutorials closes channels synchronously right after `Notify`. If the channel is unbuffered, `Notify` blocks until a receiver reads, so the close happens before the goroutine can loop again. Always use a `WaitGroup` to wait for all receivers to drain.
**Using `interface{}` (or `any`) in return types.** A `Build() interface{}` method forces the caller to type-assert on every call, pushing errors to runtime rather than compile time. Return the concrete type or a specific interface.
**Reproducing the AbstractFactory hierarchy.** A factory function that returns an interface is nearly always sufficient. Multiple factory structs with factory methods is indirection without benefit.
**Singleton for everything injectable.** Singletons make tests order-dependent and hard to parallelize. Prefer dependency injection via function parameters or a lightweight container.</div><style>#accordion-065b6c082917cf9b6a9cba33a2966676>details+details{border-top:1px solid rgb(var(--color-neutral-200))}.dark #accordion-065b6c082917cf9b6a9cba33a2966676>details+details{border-top-color:rgb(var(--color-neutral-700))}</style><script>(()=>{const e=document.getElementById("accordion-065b6c082917cf9b6a9cba33a2966676");if(!e)return;const t=e.querySelectorAll("details[data-accordion-item]");t.forEach(e=>{e.addEventListener("toggle",()=>{if(!e.open)return;t.forEach(t=>{t!==e&&t.removeAttribute("open")})})})})()</script><hr><p>If you want to go deeper on any of this, I offer 1:1 coaching sessions for engineers working on AI integration, cloud architecture, and platform engineering. <a href=https://calendly.com/manuelfedele/60min target=_blank rel=noreferrer>Book a session</a> (50 EUR / 60 min) or reach out at <a href=mailto:manuel.fedele+website@gmail.com>manuel.fedele+website@gmail.com</a>.</p></div><h2 class="mt-8 text-2xl font-extrabold mb-10">Related</h2><section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3"><article class="article-link--related relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600"><div class="flex-none relative overflow-hidden thumbnail_card_related"><img src="https://images.unsplash.com/photo-1620641788421-7a1c342ea42e?w=1200&amp;q=85" role=presentation loading=lazy decoding=async fetchpriority=low class="not-prose absolute inset-0 w-full h-full object-cover"></div><div class=p-4><header><a href=/posts/how-to-use-interfaces-in-golang/ class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2"><h2>Go Interfaces in Practice: Polymorphism, Composition, and Testing</h2></a></header><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime=2022-12-11T19:04:27+01:00>11 December 2022</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">8 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/tags/golang/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Golang
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/design-patterns/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Design Patterns</span></span></a></div></div></div><div class="px-6 pt-4 pb-2"></div></article><article class="article-link--related relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600"><div class="flex-none relative overflow-hidden thumbnail_card_related"><img src="https://images.unsplash.com/photo-1592609931041-40265b692757?w=1200&amp;q=85" role=presentation loading=lazy decoding=async fetchpriority=low class="not-prose absolute inset-0 w-full h-full object-cover"></div><div class=p-4><header><a href=/posts/implement-factory-design-pattern-golang/ class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2"><h2>The Factory Pattern in Go: Dependency Inversion and Testable Services</h2></a></header><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime=2022-12-11T18:57:13+01:00>11 December 2022</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">6 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/tags/golang/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Golang
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/design-patterns/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Design Patterns
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/solid/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Solid
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/testing/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Testing</span></span></a></div></div></div><div class="px-6 pt-4 pb-2"></div></article><article class="article-link--related relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600"><div class="flex-none relative overflow-hidden thumbnail_card_related"><img src="https://images.unsplash.com/photo-1636953056323-9c09fdd74fa6?w=1200&amp;q=85" role=presentation loading=lazy decoding=async fetchpriority=low class="not-prose absolute inset-0 w-full h-full object-cover"></div><div class=p-4><header><a href=/posts/nats-messaging-with-golang/ class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2"><h2>NATS Messaging in Go: Core, JetStream, and Production Patterns</h2></a></header><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime=2023-02-13T18:57:15+01:00>13 February 2023</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">9 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/tags/golang/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Golang
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/nats/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Nats
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/messaging/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Messaging
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/jetstream/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Jetstream</span></span></a></div></div></div><div class="px-6 pt-4 pb-2"></div></article><article class="article-link--related relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600"><div class="flex-none relative overflow-hidden thumbnail_card_related"><img src="https://images.unsplash.com/photo-1487058792275-0ad4aaf24ca7?w=1200&amp;q=85" role=presentation loading=lazy decoding=async fetchpriority=low class="not-prose absolute inset-0 w-full h-full object-cover"></div><div class=p-4><header><a href=/posts/build-a-sudoku-solver-in-golang/ class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2"><h2>Solving Sudoku in Go: Backtracking, Constraint Caching, and Benchmarks</h2></a></header><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime=2023-02-01T21:09:26+01:00>1 February 2023</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">9 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/tags/golang/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Golang
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/algorithms/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Algorithms</span></span></a></div></div></div><div class="px-6 pt-4 pb-2"></div></article></section></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span class="flex flex-col"><a class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/nats-messaging-with-golang/><span class=leading-6><span class="inline-block rtl:rotate-180">&larr;</span>&ensp;NATS Messaging in Go: Core, JetStream, and Production Patterns
</span></a><span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2023-02-13T18:57:15+01:00>13 February 2023</time>
</span></span><span class="flex flex-col items-end"><a class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/how-to-undo-most-recent-local-git-commit/><span class=leading-6>Undoing Changes in Git: reset, revert, restore, and When to Use Each&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
</span></a><span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2023-02-28T17:09:02+01:00>28 February 2023</time></span></span></div></div></footer></article><div id=scroll-to-top class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2026
Manuel Fedele</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://manuelfedele.github.io/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>