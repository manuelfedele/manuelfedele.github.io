<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>PostgreSQL JSONB: Flexible Schema, Indexing, and When to Use It &#183; Git Push and Run</title><meta name=title content="PostgreSQL JSONB: Flexible Schema, Indexing, and When to Use It &#183; Git Push and Run"><meta name=description content="Software Engineer and Cloud Architect writing about Go, Python, AWS, and AI automation."><meta name=keywords content="PostgreSQL,databases,backend,"><link rel=canonical href=https://manuelfedele.github.io/posts/work-with-json-postgresql/><meta name=author content="Manuel Fedele"><link href=https://github.com/manuelfedele rel=me><link href=https://linkedin.com/in/manuel-fedele rel=me><meta property="og:url" content="https://manuelfedele.github.io/posts/work-with-json-postgresql/"><meta property="og:site_name" content="Git Push and Run"><meta property="og:title" content="PostgreSQL JSONB: Flexible Schema, Indexing, and When to Use It"><meta property="og:description" content="JSONB is not a replacement for normalized schemas. It is a tool for genuinely semi-structured data where the shape varies per row and you need to query inside it. Use it precisely, and it saves you from premature schema commits. Use it everywhere, and you have reinvented a document store on top of a relational database. PostgreSQL’s JSONB type is one of the most powerful and most misused features in the database. This post covers the practical details: storage differences, operators, GIN indexes, mutation functions, and the patterns where JSONB earns its place."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-19T18:20:30+01:00"><meta property="article:modified_time" content="2022-12-19T18:20:30+01:00"><meta property="article:tag" content="PostgreSQL"><meta property="article:tag" content="Databases"><meta property="article:tag" content="Backend"><meta name=twitter:card content="summary"><meta name=twitter:title content="PostgreSQL JSONB: Flexible Schema, Indexing, and When to Use It"><meta name=twitter:description content="JSONB is not a replacement for normalized schemas. It is a tool for genuinely semi-structured data where the shape varies per row and you need to query inside it. Use it precisely, and it saves you from premature schema commits. Use it everywhere, and you have reinvented a document store on top of a relational database. PostgreSQL’s JSONB type is one of the most powerful and most misused features in the database. This post covers the practical details: storage differences, operators, GIN indexes, mutation functions, and the patterns where JSONB earns its place."><link type=text/css rel=stylesheet href=/css/main.bundle.min.726dfbf42bcd66e35e2d7258d72fe8fe77509ff76d153e2b46cdbae9c3af9620653459f0119a72d2af4a9b4bc446652d244ad58743d0290e5d8e09e3983b98e5.css integrity="sha512-cm379CvNZuNeLXJY1y/o/ndQn/dtFT4rRs266cOvliBlNFnwEZpy0q9Km0vERmUtJErVh0PQKQ5djgnjmDuY5Q=="><script type=text/javascript src=/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.88278edec77139635e1ad294df5b32b7be9338191c5252d3f6f451ace5852d5f82390cccacedab9c64739d8e068b7e8502895cf8f951060c0368f9a73709fcb7.js integrity="sha512-iCeO3sdxOWNeGtKU31syt76TOBkcUlLT9vRRrOWFLV+COQzMrO2rnGRznY4Gi36FAolc+PlRBgwDaPmnNwn8tw==" data-copy=Copy data-copied=Copied></script><script src=/js/shortcodes/tabs.min.b9b8a6b2cf6c81163025e44a18c0ccce600efe2dfc29d2d11515fe41b8e1e8e00896759b9e55eab7032ab15d1bec124c32e8996685e563de84ad243eb61ec236.js integrity="sha512-ubimss9sgRYwJeRKGMDMzmAO/i38KdLRFRX+Qbjh6OAIlnWbnlXqtwMqsV0b7BJMMuiZZoXlY96ErSQ+th7CNg==" crossorigin=anonymous></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"PostgreSQL JSONB: Flexible Schema, Indexing, and When to Use It","headline":"PostgreSQL JSONB: Flexible Schema, Indexing, and When to Use It","inLanguage":"en","url":"https://manuelfedele.github.io/posts/work-with-json-postgresql/","author":{"@type":"Person","name":"Manuel Fedele"},"copyrightYear":"2022","dateCreated":"2022-12-19T18:20:30\u002b01:00","datePublished":"2022-12-19T18:20:30\u002b01:00","dateModified":"2022-12-19T18:20:30\u002b01:00","keywords":["PostgreSQL","databases","backend"],"mainEntityOfPage":"true","wordCount":"1714"}]</script></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral bf-scrollbar"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 z-100"><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl bg-neutral/25 dark:bg-neutral-800/25"></div><div class="relative m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32"><div class="main-menu flex items-center w-full gap-2 p-1 pl-0"><a href=/ class="text-base font-medium truncate min-w-0 shrink">Git Push and Run</a><div class="flex items-center ms-auto"><div class="hidden md:flex"><nav class="flex items-center gap-x-5 h-12"><a href=/posts/ class="flex items-center bf-icon-color-hover" aria-label=Blog title=Posts><span class="text-base font-medium break-normal">Blog
</span></a><a href=/about/ class="flex items-center bf-icon-color-hover" aria-label=About title=About><span class="text-base font-medium break-normal">About
</span></a><a href=/coaching/ class="flex items-center bf-icon-color-hover" aria-label=Coaching title=Coaching><span class="text-base font-medium break-normal">Coaching
</span></a><a href=https://github.com/manuelfedele target=_blank class="flex items-center bf-icon-color-hover" aria-label=github title><span><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a><div class="translation nested-menu"><button class="cursor-pointer flex items-center">
<span class=me-1><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span>
</span><span class="text-sm font-medium bf-icon-color-hover" title="PostgreSQL JSONB: Flexible Schema, Indexing, and When to Use It">EN</span></button><ul class=menuhide><li class="rounded-xl backdrop-blur shadow-2xl p-2 flex flex-col gap-1"><a href=/posts/work-with-json-postgresql/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="PostgreSQL JSONB: Flexible Schema, Indexing, and When to Use It">EN
</span></a><a href=/it/posts/work-with-json-postgresql/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="PostgreSQL JSONB: Schema flessibile, indicizzazione e quando usarlo">IT</span></a></li></ul></div><button id=search-button aria-label=Search class="text-base bf-icon-color-hover" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></nav></div><div class="flex md:hidden"><div class="flex items-center h-14 gap-4"><button id=search-button-mobile aria-label=Search class="flex items-center justify-center bf-icon-color-hover" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<input type=checkbox id=mobile-menu-toggle autocomplete=off class="hidden peer">
<label for=mobile-menu-toggle class="flex items-center justify-center cursor-pointer bf-icon-color-hover"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></label><div role=dialog aria-modal=true style=scrollbar-gutter:stable class="fixed inset-0 z-50 invisible overflow-y-auto px-6 py-20 opacity-0 transition-[opacity,visibility] duration-300 peer-checked:visible peer-checked:opacity-100 bg-neutral-50/97 dark:bg-neutral-900/99
bf-scrollbar"><label for=mobile-menu-toggle class="fixed end-8 top-5 flex items-center justify-center z-50 h-12 w-12 cursor-pointer select-none rounded-full bf-icon-color-hover border bf-border-color bf-border-color-hover bg-neutral-50 dark:bg-neutral-900"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></label><nav class="mx-auto max-w-md space-y-6"><div class=px-2><a href=/posts/ aria-label=Blog class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Posts class="text-2xl font-bold tracking-tight">Blog</span></a></div><div class=px-2><a href=/about/ aria-label=About class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=About class="text-2xl font-bold tracking-tight">About</span></a></div><div class=px-2><a href=/coaching/ aria-label=Coaching class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Coaching class="text-2xl font-bold tracking-tight">Coaching</span></a></div><div class=px-2><a href=https://github.com/manuelfedele aria-label=github target=_blank class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span class="flex items-center justify-center h-8 w-8 text-2xl"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span><span title class="text-2xl font-bold tracking-tight"></span></a></div><div class="flex flex-wrap items-center [&_span]:text-2xl [&_.translation_button_.icon]:text-4xl! [&_.translation_button_span]:text-base! [&_.translation_.menuhide_span]:text-sm! gap-x-6 ps-2 mt-8 pt-8 border-t bf-border-color"><div class="translation nested-menu"><button class="cursor-pointer flex items-center">
<span class=me-1><span class="relative block icon"><svg viewBox="0 0 640 512"><path fill="currentColor" d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3.0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3.0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2 179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5.0-28.3s20.5-7.8 28.3.0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/></svg></span>
</span><span class="text-sm font-medium bf-icon-color-hover" title="PostgreSQL JSONB: Flexible Schema, Indexing, and When to Use It">EN</span></button><ul class=menuhide><li class="rounded-xl backdrop-blur shadow-2xl p-2 flex flex-col gap-1"><a href=/posts/work-with-json-postgresql/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="PostgreSQL JSONB: Flexible Schema, Indexing, and When to Use It">EN
</span></a><a href=/it/posts/work-with-json-postgresql/ class="flex items-center bf-icon-color-hover px-3 py-1"><span class="text-sm font-sm" title="PostgreSQL JSONB: Schema flessibile, indicizzazione e quando usarlo">IT</span></a></li></ul></div></div></nav></div></div></div></div></div><script>(function(){var t,n,e=document.querySelector(".main-menu");if(!e)return;t=window.location.pathname,n=e.querySelectorAll('a[href="'+t+'"]'),n.forEach(function(e){var t=e.querySelectorAll("span");t.forEach(function(e){e.classList.add("active")})})})()</script></div></div><script type=text/javascript src=/js/background-blur.min.00a57c73ea12f2cab2980c3c3d649e89f6d82f190f74bbe2b67f2f5e39ab7d032ece47086400ca05396758aace13299da49aca43ea643d2625e62c506267a169.js integrity="sha512-AKV8c+oS8sqymAw8PWSeifbYLxkPdLvitn8vXjmrfQMuzkcIZADKBTlnWKrOEymdpJrKQ+pkPSYl5ixQYmehaQ==" data-blur-id=menu-blur></script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"><img id=background-image src="https://images.unsplash.com/photo-1655720828018-edd2daec9349?w=1200&amp;q=85" role=presentation loading=eager decoding=async fetchpriority=high class="absolute inset-0 w-full h-full object-cover"><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-xl bg-neutral-100/75 dark:bg-neutral-800/60"></div><script type=text/javascript src=/js/background-blur.min.00a57c73ea12f2cab2980c3c3d649e89f6d82f190f74bbe2b67f2f5e39ab7d032ece47086400ca05396758aace13299da49aca43ea643d2625e62c506267a169.js integrity="sha512-AKV8c+oS8sqymAw8PWSeifbYLxkPdLvitn8vXjmrfQMuzkcIZADKBTlnWKrOEymdpJrKQ+pkPSYl5ixQYmehaQ==" data-blur-id=background-blur data-image-id=background-image data-image-url="https://images.unsplash.com/photo-1655720828018-edd2daec9349?w=1200&amp;q=85"></script><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">PostgreSQL JSONB: Flexible Schema, Indexing, and When to Use It</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2022-12-19T18:20:30+01:00>19 December 2022</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">9 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/tags/postgresql/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">PostgreSQL
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/databases/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Databases
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/backend/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Backend</span></span></a></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ms-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs"><div class="toc ps-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain bf-scrollbar rounded-lg -ms-5 ps-5 pe-2 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#json-vs-jsonb-always-use-jsonb><code>json</code> vs <code>jsonb</code>: Always Use <code>jsonb</code></a></li><li><a href=#querying------>Querying: <code>-></code>, <code>->></code>, <code>#></code>, <code>#>></code></a></li><li><a href=#containment-operators--and->Containment Operators: <code>@></code> and <code>&lt;@</code></a></li><li><a href=#gin-indexes-what-they-accelerate>GIN Indexes: What They Accelerate</a></li><li><a href=#updating-jsonb-jsonb_set--and-key-removal>Updating JSONB: <code>jsonb_set</code>, <code>||</code>, and Key Removal</a></li><li><a href=#unnesting-jsonb_array_elements-and-jsonb_each>Unnesting: <code>jsonb_array_elements</code> and <code>jsonb_each</code></a></li><li><a href=#real-use-case-event-sourcing-with-jsonb>Real Use Case: Event Sourcing with JSONB</a></li><li><a href=#orm-integration>ORM Integration</a></li><li><a href=#when-not-to-use-jsonb>When NOT to Use JSONB</a></li><li><a href=#common-mistakes>Common Mistakes</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#json-vs-jsonb-always-use-jsonb><code>json</code> vs <code>jsonb</code>: Always Use <code>jsonb</code></a></li><li><a href=#querying------>Querying: <code>-></code>, <code>->></code>, <code>#></code>, <code>#>></code></a></li><li><a href=#containment-operators--and->Containment Operators: <code>@></code> and <code>&lt;@</code></a></li><li><a href=#gin-indexes-what-they-accelerate>GIN Indexes: What They Accelerate</a></li><li><a href=#updating-jsonb-jsonb_set--and-key-removal>Updating JSONB: <code>jsonb_set</code>, <code>||</code>, and Key Removal</a></li><li><a href=#unnesting-jsonb_array_elements-and-jsonb_each>Unnesting: <code>jsonb_array_elements</code> and <code>jsonb_each</code></a></li><li><a href=#real-use-case-event-sourcing-with-jsonb>Real Use Case: Event Sourcing with JSONB</a></li><li><a href=#orm-integration>ORM Integration</a></li><li><a href=#when-not-to-use-jsonb>When NOT to Use JSONB</a></li><li><a href=#common-mistakes>Common Mistakes</a></li></ul></nav></div></details><script>(function(){"use strict";const s=.33,o="#TableOfContents",i=".anchor",a='a[href^="#"]',r="li ul",c="active";let t=!1;function l(e,n){const o=window.scrollY+window.innerHeight*n,i=[...document.querySelectorAll('#TableOfContents a[href^="#"]')],s=new Set(i.map(e=>e.getAttribute("href").substring(1)));if(t)for(let t=0;t<e.length;t++){const n=e[t];if(!s.has(n.id))continue;const o=n.getBoundingClientRect().top+window.scrollY;if(Math.abs(window.scrollY-o)<100)return n.id}for(let t=e.length-1;t>=0;t--){const n=e[t].getBoundingClientRect().top+window.scrollY;if(n<=o&&s.has(e[t].id))return e[t].id}return e.find(e=>s.has(e.id))?.id||""}function e({toc:e,anchors:t,links:n,scrollOffset:s,collapseInactive:o}){const i=l(t,s);if(!i)return;if(n.forEach(e=>{const t=e.getAttribute("href")===`#${i}`;if(e.classList.toggle(c,t),o){const n=e.closest("li")?.querySelector("ul");n&&(n.style.display=t?"":"none")}}),o){const n=e.querySelector(`a[href="#${CSS.escape(i)}"]`);let t=n;for(;t&&t!==e;)t.tagName==="UL"&&(t.style.display=""),t.tagName==="LI"&&t.querySelector("ul")?.style.setProperty("display",""),t=t.parentElement}}function n(){const n=document.querySelector(o);if(!n)return;const l=!0,u=[...document.querySelectorAll(i)],d=[...n.querySelectorAll(a)];l&&n.querySelectorAll(r).forEach(e=>e.style.display="none"),d.forEach(e=>{e.addEventListener("click",()=>{t=!0})});const c={toc:n,anchors:u,links:d,scrollOffset:s,collapseInactive:l};window.addEventListener("scroll",()=>e(c),{passive:!0}),window.addEventListener("hashchange",()=>e(c),{passive:!0}),e(c)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n()})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><div class="lead text-neutral-500 dark:text-neutral-400 !mb-9 text-xl">JSONB is not a replacement for normalized schemas. It is a tool for genuinely semi-structured data where the shape varies per row and you need to query inside it. Use it precisely, and it saves you from premature schema commits. Use it everywhere, and you have reinvented a document store on top of a relational database.</div><p>PostgreSQL&rsquo;s JSONB type is one of the most powerful and most misused features in the database. This post covers the practical details: storage differences, operators, GIN indexes, mutation functions, and the patterns where JSONB earns its place.</p><h2 class="relative group"><code>json</code> vs <code>jsonb</code>: Always Use <code>jsonb</code><div id=json-vs-jsonb-always-use-jsonb class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#json-vs-jsonb-always-use-jsonb aria-label=Anchor>#</a></span></h2><p>PostgreSQL has two JSON types: <code>json</code> and <code>jsonb</code>. The difference matters in production.</p><table><thead><tr><th></th><th><code>json</code></th><th><code>jsonb</code></th></tr></thead><tbody><tr><td>Storage</td><td>Stores the raw text, preserves whitespace and key order</td><td>Stores a decomposed binary representation</td></tr><tr><td>Read performance</td><td>Must re-parse on every read</td><td>Binary format, no re-parse needed</td></tr><tr><td>Write performance</td><td>Slightly faster (no decomposition)</td><td>Slightly slower (decomposes at write time)</td></tr><tr><td>Indexing</td><td>No index support</td><td>GIN and btree indexes supported</td></tr><tr><td>Key deduplication</td><td>Keeps duplicates</td><td>Last-write wins on duplicate keys</td></tr></tbody></table><div class="admonition relative overflow-hidden rounded-lg border-l-4 my-3 px-4 py-3 shadow-sm" data-type=warning><div class="flex items-center gap-2 font-semibold text-inherit"><div class="flex shrink-0 h-5 w-5 items-center justify-center text-lg"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M506.3 417 293 53c-16.33-28-57.54-28-73.98.0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6c32.76.0 53.26-35 36.96-63zM232 168c0-13.25 10.75-24 24-24s24 10.8 24 24v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zm24 248c-17.36.0-31.44-14.08-31.44-31.44s14.07-31.44 31.44-31.44 31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg></span></div><div class=grow>Warning</div></div><div class="admonition-content mt-3 text-base leading-relaxed text-inherit"><p>Never use <code>json</code> in a new schema. The only reason <code>json</code> exists is for cases where you need to preserve exact key order or duplicate keys (rare auditing use cases). For everything else, <code>jsonb</code> is strictly better because it can be indexed and queried efficiently.</p></div></div><h2 class="relative group">Querying: <code>-></code>, <code>->></code>, <code>#></code>, <code>#>></code><div id=querying------ class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#querying------ aria-label=Anchor>#</a></span></h2><p>The four navigation operators:</p><ul><li><code>-></code> returns a JSON sub-object or array element (type: <code>jsonb</code>)</li><li><code>->></code> returns the value as text (type: <code>text</code>)</li><li><code>#></code> navigates a path array, returns <code>jsonb</code></li><li><code>#>></code> navigates a path array, returns <code>text</code></li></ul><div class=highlight-wrapper><div class=codeblock-title>operators.sql</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>CREATE</span> <span style=color:#81a1c1;font-weight:700>TABLE</span> events <span style=color:#eceff4>(</span>
</span></span><span style=display:flex><span>    id      bigserial <span style=color:#81a1c1;font-weight:700>PRIMARY</span> <span style=color:#81a1c1;font-weight:700>KEY</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>    payload jsonb <span style=color:#81a1c1;font-weight:700>NOT</span> <span style=color:#81a1c1;font-weight:700>NULL</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>    created_at timestamptz <span style=color:#81a1c1;font-weight:700>NOT</span> <span style=color:#81a1c1;font-weight:700>NULL</span> <span style=color:#81a1c1;font-weight:700>DEFAULT</span> now<span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>INSERT</span> <span style=color:#81a1c1;font-weight:700>INTO</span> events <span style=color:#eceff4>(</span>payload<span style=color:#eceff4>)</span> <span style=color:#81a1c1;font-weight:700>VALUES</span>
</span></span><span style=display:flex><span>  <span style=color:#eceff4>(</span><span style=color:#a3be8c>&#39;{&#34;type&#34;: &#34;order.created&#34;, &#34;user&#34;: {&#34;id&#34;: 42, &#34;email&#34;: &#34;alice@example.com&#34;}, &#34;items&#34;: [{&#34;sku&#34;: &#34;A1&#34;, &#34;qty&#34;: 2}]}&#39;</span><span style=color:#eceff4>),</span>
</span></span><span style=display:flex><span>  <span style=color:#eceff4>(</span><span style=color:#a3be8c>&#39;{&#34;type&#34;: &#34;order.shipped&#34;, &#34;user&#34;: {&#34;id&#34;: 42, &#34;email&#34;: &#34;alice@example.com&#34;}, &#34;tracking&#34;: &#34;1Z999&#34;}&#39;</span><span style=color:#eceff4>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- Get the event type as jsonb (quoted string in output)
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>SELECT</span> payload <span style=color:#81a1c1>-&gt;</span> <span style=color:#a3be8c>&#39;type&#39;</span> <span style=color:#81a1c1;font-weight:700>FROM</span> events<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- Get the event type as plain text
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>SELECT</span> payload <span style=color:#81a1c1>-&gt;&gt;</span> <span style=color:#a3be8c>&#39;type&#39;</span> <span style=color:#81a1c1;font-weight:700>FROM</span> events<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- Navigate nested path: user.email
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>SELECT</span> payload <span style=color:#81a1c1>#&gt;&gt;</span> <span style=color:#a3be8c>&#39;{user, email}&#39;</span> <span style=color:#81a1c1;font-weight:700>FROM</span> events<span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- Filter by nested value
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>SELECT</span> <span style=color:#81a1c1>*</span> <span style=color:#81a1c1;font-weight:700>FROM</span> events
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>WHERE</span> payload <span style=color:#81a1c1>-&gt;&gt;</span> <span style=color:#a3be8c>&#39;type&#39;</span> <span style=color:#81a1c1>=</span> <span style=color:#a3be8c>&#39;order.created&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>AND</span> <span style=color:#eceff4>(</span>payload <span style=color:#81a1c1>#&gt;&gt;</span> <span style=color:#a3be8c>&#39;{user, id}&#39;</span><span style=color:#eceff4>)::</span><span style=color:#81a1c1>int</span> <span style=color:#81a1c1>=</span> <span style=color:#b48ead>42</span><span style=color:#eceff4>;</span></span></span></code></pre></div></div><h2 class="relative group">Containment Operators: <code>@></code> and <code>&lt;@</code><div id=containment-operators--and- class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#containment-operators--and- aria-label=Anchor>#</a></span></h2><p>The containment operators are the most powerful JSONB querying tools, and they work with GIN indexes.</p><p><code>A @> B</code> means &ldquo;does A contain B as a subset of keys/values?&rdquo;
<code>A &lt;@ B</code> means &ldquo;is A contained within B?&rdquo;</p><div class=highlight-wrapper><div class=codeblock-title>containment.sql</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- Find all events where the user id is 42
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>SELECT</span> <span style=color:#81a1c1>*</span> <span style=color:#81a1c1;font-weight:700>FROM</span> events
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>WHERE</span> payload <span style=color:#81a1c1>@&gt;</span> <span style=color:#a3be8c>&#39;{&#34;user&#34;: {&#34;id&#34;: 42}}&#39;</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- Find events of specific types
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>SELECT</span> <span style=color:#81a1c1>*</span> <span style=color:#81a1c1;font-weight:700>FROM</span> events
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>WHERE</span> payload <span style=color:#81a1c1>@&gt;</span> <span style=color:#a3be8c>&#39;{&#34;type&#34;: &#34;order.created&#34;}&#39;</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- Find events that have a tracking field at all
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>SELECT</span> <span style=color:#81a1c1>*</span> <span style=color:#81a1c1;font-weight:700>FROM</span> events
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>WHERE</span> payload <span style=color:#81a1c1>?</span> <span style=color:#a3be8c>&#39;tracking&#39;</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- Find events where type is one of a set
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>SELECT</span> <span style=color:#81a1c1>*</span> <span style=color:#81a1c1;font-weight:700>FROM</span> events
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>WHERE</span> payload <span style=color:#81a1c1>-&gt;&gt;</span> <span style=color:#a3be8c>&#39;type&#39;</span> <span style=color:#81a1c1>=</span> <span style=color:#81a1c1;font-weight:700>ANY</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>ARRAY</span><span style=color:#eceff4>[</span><span style=color:#a3be8c>&#39;order.created&#39;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#39;order.shipped&#39;</span><span style=color:#eceff4>]);</span></span></span></code></pre></div></div><h2 class="relative group">GIN Indexes: What They Accelerate<div id=gin-indexes-what-they-accelerate class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#gin-indexes-what-they-accelerate aria-label=Anchor>#</a></span></h2><p>A GIN (Generalized Inverted Index) on a JSONB column indexes all keys and values within the document, enabling fast containment and existence queries.</p><div class=highlight-wrapper><div class=codeblock-title>gin-index.sql</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- Default GIN with jsonb_ops: supports @&gt;, ?, ?|, ?&amp;
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>CREATE</span> <span style=color:#81a1c1;font-weight:700>INDEX</span> idx_events_payload_gin <span style=color:#81a1c1;font-weight:700>ON</span> events <span style=color:#81a1c1;font-weight:700>USING</span> gin <span style=color:#eceff4>(</span>payload<span style=color:#eceff4>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- GIN with jsonb_path_ops: smaller index, only supports @&gt;
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- Better when you only need containment queries
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>CREATE</span> <span style=color:#81a1c1;font-weight:700>INDEX</span> idx_events_payload_path_ops <span style=color:#81a1c1;font-weight:700>ON</span> events <span style=color:#81a1c1;font-weight:700>USING</span> gin <span style=color:#eceff4>(</span>payload jsonb_path_ops<span style=color:#eceff4>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- B-tree index on a specific extracted value (for equality + range on one field)
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>CREATE</span> <span style=color:#81a1c1;font-weight:700>INDEX</span> idx_events_type <span style=color:#81a1c1;font-weight:700>ON</span> events <span style=color:#eceff4>((</span>payload <span style=color:#81a1c1>-&gt;&gt;</span> <span style=color:#a3be8c>&#39;type&#39;</span><span style=color:#eceff4>));</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>CREATE</span> <span style=color:#81a1c1;font-weight:700>INDEX</span> idx_events_user_id <span style=color:#81a1c1;font-weight:700>ON</span> events <span style=color:#eceff4>(((</span>payload <span style=color:#81a1c1>#&gt;&gt;</span> <span style=color:#a3be8c>&#39;{user, id}&#39;</span><span style=color:#eceff4>)::</span><span style=color:#81a1c1>int</span><span style=color:#eceff4>));</span></span></span></code></pre></div></div><div class="admonition relative overflow-hidden rounded-lg border-l-4 my-3 px-4 py-3 shadow-sm" data-type=tip><div class="flex items-center gap-2 font-semibold text-inherit"><div class="flex shrink-0 h-5 w-5 items-center justify-center text-lg"><span class="relative block icon"><svg viewBox="0 0 384 512"><path fill="currentColor" d="M112.1 454.3c0 6.297 1.816 12.44 5.284 17.69l17.14 25.69c5.25 7.875 17.17 14.28 26.64 14.28h61.67c9.438.0 21.36-6.401 26.61-14.28l17.08-25.68c2.938-4.438 5.348-12.37 5.348-17.7L272 415.1H112L112.1 454.3zM191.4.0132C89.44.3257 16 82.97 16 175.1c0 44.38 16.44 84.84 43.56 115.8 16.53 18.84 42.34 58.23 52.22 91.45.0313.25.0938.5166.125.7823h160.2c.0313-.2656.0938-.5166.125-.7823 9.875-33.22 35.69-72.61 52.22-91.45C351.6 260.8 368 220.4 368 175.1 368 78.61 288.9-.2837 191.4.0132zM192 96.01c-44.13.0-80 35.89-80 79.1.0 9.69-7.2 16.89-16 16.89S80 184.8 80 176c0-61.76 50.25-111.1 112-111.1 8.844.0 16 7.159 16 16S200.8 96.01 192 96.01z"/></svg></span></div><div class=grow>Tip</div></div><div class="admonition-content mt-3 text-base leading-relaxed text-inherit"><p>Use <code>jsonb_path_ops</code> when all your queries use <code>@></code> containment. It produces a smaller, faster index because it only indexes values, not keys. Use the default <code>jsonb_ops</code> when you also need <code>?</code> (key existence), <code>?|</code>, or <code>?&</code> operators.</p></div></div><p>The B-tree index on an extracted expression is the right choice when you have a specific field that is queried frequently with equality or range conditions. It is significantly faster than GIN for single-field lookups.</p><h2 class="relative group">Updating JSONB: <code>jsonb_set</code>, <code>||</code>, and Key Removal<div id=updating-jsonb-jsonb_set--and-key-removal class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#updating-jsonb-jsonb_set--and-key-removal aria-label=Anchor>#</a></span></h2><p>Updating a JSONB field requires constructing a new value. PostgreSQL provides several functions for this.</p><div class=highlight-wrapper><div class=codeblock-title>jsonb-mutations.sql</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- jsonb_set(target, path, new_value, create_missing)
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- Update user.email in place
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>UPDATE</span> events
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>SET</span> payload <span style=color:#81a1c1>=</span> jsonb_set<span style=color:#eceff4>(</span>payload<span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#39;{user, email}&#39;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#39;&#34;bob@example.com&#34;&#39;</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>false</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>WHERE</span> id <span style=color:#81a1c1>=</span> <span style=color:#b48ead>1</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- jsonb_insert(target, path, new_value, insert_after)
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- Insert a new element into the items array at position 0
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>UPDATE</span> events
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>SET</span> payload <span style=color:#81a1c1>=</span> jsonb_insert<span style=color:#eceff4>(</span>payload<span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#39;{items, 0}&#39;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#39;{&#34;sku&#34;: &#34;B2&#34;, &#34;qty&#34;: 1}&#39;</span><span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>false</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>WHERE</span> id <span style=color:#81a1c1>=</span> <span style=color:#b48ead>1</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- Merge / shallow merge with the || operator
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>UPDATE</span> events
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>SET</span> payload <span style=color:#81a1c1>=</span> payload <span style=color:#81a1c1>||</span> <span style=color:#a3be8c>&#39;{&#34;status&#34;: &#34;processed&#34;, &#34;processed_at&#34;: &#34;2025-01-01&#34;}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>WHERE</span> id <span style=color:#81a1c1>=</span> <span style=color:#b48ead>1</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- Remove a key with the - operator
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>UPDATE</span> events
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>SET</span> payload <span style=color:#81a1c1>=</span> payload <span style=color:#81a1c1>-</span> <span style=color:#a3be8c>&#39;tracking&#39;</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>WHERE</span> id <span style=color:#81a1c1>=</span> <span style=color:#b48ead>2</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- Remove a nested path with the #- operator
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>UPDATE</span> events
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>SET</span> payload <span style=color:#81a1c1>=</span> payload <span style=color:#81a1c1>#-</span> <span style=color:#a3be8c>&#39;{user, email}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>WHERE</span> id <span style=color:#81a1c1>=</span> <span style=color:#b48ead>1</span><span style=color:#eceff4>;</span></span></span></code></pre></div></div><div class="admonition relative overflow-hidden rounded-lg border-l-4 my-3 px-4 py-3 shadow-sm" data-type=note><div class="flex items-center gap-2 font-semibold text-inherit"><div class="flex shrink-0 h-5 w-5 items-center justify-center text-lg"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 0C114.6.0.0 114.6.0 256s114.6 256 256 256 256-114.6 256-256S397.4.0 256 0zm0 128c17.67.0 32 14.33 32 32 0 17.67-14.33 32-32 32s-32-14.3-32-32 14.3-32 32-32zm40 256h-80c-13.2.0-24-10.7-24-24s10.75-24 24-24h16v-64h-8c-13.25.0-24-10.75-24-24s10.8-24 24-24h32c13.25.0 24 10.75 24 24v88h16c13.25.0 24 10.75 24 24s-10.7 24-24 24z"/></svg></span></div><div class=grow>Note</div></div><div class="admonition-content mt-3 text-base leading-relaxed text-inherit"><p>The <code>||</code> operator performs a shallow merge, not a deep merge. If both the left and right side have the same nested object key, the right side replaces the left entirely, rather than merging recursively. Use <code>jsonb_set</code> for targeted nested updates.</p></div></div><h2 class="relative group">Unnesting: <code>jsonb_array_elements</code> and <code>jsonb_each</code><div id=unnesting-jsonb_array_elements-and-jsonb_each class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#unnesting-jsonb_array_elements-and-jsonb_each aria-label=Anchor>#</a></span></h2><div class=highlight-wrapper><div class=codeblock-title>unnesting.sql</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- Expand a JSONB array into rows
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>SELECT</span>
</span></span><span style=display:flex><span>  e<span style=color:#eceff4>.</span>id<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>  item <span style=color:#81a1c1>-&gt;&gt;</span> <span style=color:#a3be8c>&#39;sku&#39;</span>      <span style=color:#81a1c1;font-weight:700>AS</span> sku<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>  <span style=color:#eceff4>(</span>item <span style=color:#81a1c1>-&gt;&gt;</span> <span style=color:#a3be8c>&#39;qty&#39;</span><span style=color:#eceff4>)::</span><span style=color:#81a1c1>int</span> <span style=color:#81a1c1;font-weight:700>AS</span> qty
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>FROM</span> events e<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>  jsonb_array_elements<span style=color:#eceff4>(</span>e<span style=color:#eceff4>.</span>payload <span style=color:#81a1c1>-&gt;</span> <span style=color:#a3be8c>&#39;items&#39;</span><span style=color:#eceff4>)</span> <span style=color:#81a1c1;font-weight:700>AS</span> item
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>WHERE</span> e<span style=color:#eceff4>.</span>payload <span style=color:#81a1c1>@&gt;</span> <span style=color:#a3be8c>&#39;{&#34;type&#34;: &#34;order.created&#34;}&#39;</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- Expand all key-value pairs of a JSONB object into rows
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>SELECT</span> <span style=color:#81a1c1;font-weight:700>key</span><span style=color:#eceff4>,</span> value
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>FROM</span> events<span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>  jsonb_each<span style=color:#eceff4>(</span>payload<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>WHERE</span> id <span style=color:#81a1c1>=</span> <span style=color:#b48ead>1</span><span style=color:#eceff4>;</span></span></span></code></pre></div></div><h2 class="relative group">Real Use Case: Event Sourcing with JSONB<div id=real-use-case-event-sourcing-with-jsonb class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#real-use-case-event-sourcing-with-jsonb aria-label=Anchor>#</a></span></h2><p>Event sourcing is one of the best fits for JSONB. The event type determines the payload shape, so a single <code>events</code> table with a JSONB payload column handles heterogeneous event schemas naturally.</p><div class=highlight-wrapper><div class=codeblock-title>event-sourcing.sql</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>CREATE</span> <span style=color:#81a1c1;font-weight:700>TABLE</span> domain_events <span style=color:#eceff4>(</span>
</span></span><span style=display:flex><span>    id          bigserial <span style=color:#81a1c1;font-weight:700>PRIMARY</span> <span style=color:#81a1c1;font-weight:700>KEY</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>aggregate</span>   <span style=color:#81a1c1>text</span>        <span style=color:#81a1c1;font-weight:700>NOT</span> <span style=color:#81a1c1;font-weight:700>NULL</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>    agg_id      <span style=color:#81a1c1>bigint</span>      <span style=color:#81a1c1;font-weight:700>NOT</span> <span style=color:#81a1c1;font-weight:700>NULL</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>    event_type  <span style=color:#81a1c1>text</span>        <span style=color:#81a1c1;font-weight:700>NOT</span> <span style=color:#81a1c1;font-weight:700>NULL</span><span style=color:#eceff4>,</span>          <span style=color:#616e87;font-style:italic>-- extracted for indexing
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span>    <span style=color:#81a1c1;font-weight:700>version</span>     <span style=color:#81a1c1>int</span>         <span style=color:#81a1c1;font-weight:700>NOT</span> <span style=color:#81a1c1;font-weight:700>NULL</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>    payload     jsonb       <span style=color:#81a1c1;font-weight:700>NOT</span> <span style=color:#81a1c1;font-weight:700>NULL</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>    created_at  timestamptz <span style=color:#81a1c1;font-weight:700>NOT</span> <span style=color:#81a1c1;font-weight:700>NULL</span> <span style=color:#81a1c1;font-weight:700>DEFAULT</span> now<span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- Partial index: find all shipment events cheaply
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>CREATE</span> <span style=color:#81a1c1;font-weight:700>INDEX</span> idx_domain_events_shipment
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>ON</span> domain_events <span style=color:#eceff4>(</span>agg_id<span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>version</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>WHERE</span> event_type <span style=color:#81a1c1>=</span> <span style=color:#a3be8c>&#39;order.shipped&#39;</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- GIN for attribute queries inside payload
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>CREATE</span> <span style=color:#81a1c1;font-weight:700>INDEX</span> idx_domain_events_payload
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>ON</span> domain_events <span style=color:#81a1c1;font-weight:700>USING</span> gin <span style=color:#eceff4>(</span>payload jsonb_path_ops<span style=color:#eceff4>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- Replay all events for a specific order
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>SELECT</span> event_type<span style=color:#eceff4>,</span> <span style=color:#81a1c1;font-weight:700>version</span><span style=color:#eceff4>,</span> payload
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>FROM</span> domain_events
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>WHERE</span> <span style=color:#81a1c1;font-weight:700>aggregate</span> <span style=color:#81a1c1>=</span> <span style=color:#a3be8c>&#39;order&#39;</span> <span style=color:#81a1c1;font-weight:700>AND</span> agg_id <span style=color:#81a1c1>=</span> <span style=color:#b48ead>42</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>ORDER</span> <span style=color:#81a1c1;font-weight:700>BY</span> <span style=color:#81a1c1;font-weight:700>version</span><span style=color:#eceff4>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>-- Find all orders shipped to a specific address
</span></span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic></span><span style=color:#81a1c1;font-weight:700>SELECT</span> agg_id<span style=color:#eceff4>,</span> payload
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>FROM</span> domain_events
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>WHERE</span> event_type <span style=color:#81a1c1>=</span> <span style=color:#a3be8c>&#39;order.shipped&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#81a1c1;font-weight:700>AND</span> payload <span style=color:#81a1c1>@&gt;</span> <span style=color:#a3be8c>&#39;{&#34;address&#34;: {&#34;city&#34;: &#34;Milan&#34;}}&#39;</span><span style=color:#eceff4>;</span></span></span></code></pre></div></div><h2 class="relative group">ORM Integration<div id=orm-integration class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#orm-integration aria-label=Anchor>#</a></span></h2><div class="tab__container w-full"><div class=tab__nav role=tablist><div class="flex flex-wrap gap-1"><button class="tab__button px-3 py-2 text-sm font-semibold border-b-2 border-transparent rounded-t-md hover:bg-neutral-200 dark:hover:bg-neutral-700 tab--active" role=tab aria-selected=true data-tab-index=0 data-tab-label>
<span class="flex items-center gap-1"></span></button><button class="tab__button px-3 py-2 text-sm font-semibold border-b-2 border-transparent rounded-t-md hover:bg-neutral-200 dark:hover:bg-neutral-700" role=tab aria-selected=false data-tab-index=1 data-tab-label>
<span class="flex items-center gap-1"></span></button><button class="tab__button px-3 py-2 text-sm font-semibold border-b-2 border-transparent rounded-t-md hover:bg-neutral-200 dark:hover:bg-neutral-700" role=tab aria-selected=false data-tab-index=2 data-tab-label>
<span class="flex items-center gap-1"></span></button></div></div><div class="tab__content mt-4"><div class="tab__panel tab--active" data-tab-index=0><div class=highlight-wrapper><div class=codeblock-title>models.py</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>from</span> <span style=color:#8fbcbb>sqlalchemy</span> <span style=color:#81a1c1;font-weight:700>import</span> Column<span style=color:#eceff4>,</span> BigInteger<span style=color:#eceff4>,</span> Text<span style=color:#eceff4>,</span> DateTime
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>from</span> <span style=color:#8fbcbb>sqlalchemy.dialects.postgresql</span> <span style=color:#81a1c1;font-weight:700>import</span> JSONB
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>from</span> <span style=color:#8fbcbb>sqlalchemy.orm</span> <span style=color:#81a1c1;font-weight:700>import</span> DeclarativeBase
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#8fbcbb>datetime</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>class</span> <span style=color:#8fbcbb>Base</span><span style=color:#eceff4>(</span>DeclarativeBase<span style=color:#eceff4>):</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>class</span> <span style=color:#8fbcbb>DomainEvent</span><span style=color:#eceff4>(</span>Base<span style=color:#eceff4>):</span>
</span></span><span style=display:flex><span>    __tablename__ <span style=color:#81a1c1>=</span> <span style=color:#a3be8c>&#34;domain_events&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1>id</span>         <span style=color:#81a1c1>=</span> Column<span style=color:#eceff4>(</span>BigInteger<span style=color:#eceff4>,</span> primary_key<span style=color:#81a1c1>=</span><span style=color:#81a1c1;font-weight:700>True</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    aggregate  <span style=color:#81a1c1>=</span> Column<span style=color:#eceff4>(</span>Text<span style=color:#eceff4>,</span> nullable<span style=color:#81a1c1>=</span><span style=color:#81a1c1;font-weight:700>False</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    agg_id     <span style=color:#81a1c1>=</span> Column<span style=color:#eceff4>(</span>BigInteger<span style=color:#eceff4>,</span> nullable<span style=color:#81a1c1>=</span><span style=color:#81a1c1;font-weight:700>False</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    event_type <span style=color:#81a1c1>=</span> Column<span style=color:#eceff4>(</span>Text<span style=color:#eceff4>,</span> nullable<span style=color:#81a1c1>=</span><span style=color:#81a1c1;font-weight:700>False</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    version    <span style=color:#81a1c1>=</span> Column<span style=color:#eceff4>(</span>BigInteger<span style=color:#eceff4>,</span> nullable<span style=color:#81a1c1>=</span><span style=color:#81a1c1;font-weight:700>False</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    payload    <span style=color:#81a1c1>=</span> Column<span style=color:#eceff4>(</span>JSONB<span style=color:#eceff4>,</span> nullable<span style=color:#81a1c1>=</span><span style=color:#81a1c1;font-weight:700>False</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    created_at <span style=color:#81a1c1>=</span> Column<span style=color:#eceff4>(</span>DateTime<span style=color:#eceff4>(</span>timezone<span style=color:#81a1c1>=</span><span style=color:#81a1c1;font-weight:700>True</span><span style=color:#eceff4>),</span> default<span style=color:#81a1c1>=</span>datetime<span style=color:#81a1c1>.</span>datetime<span style=color:#81a1c1>.</span>utcnow<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># Query using containment (uses GIN index)</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>from</span> <span style=color:#8fbcbb>sqlalchemy</span> <span style=color:#81a1c1;font-weight:700>import</span> cast
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>from</span> <span style=color:#8fbcbb>sqlalchemy.dialects.postgresql</span> <span style=color:#81a1c1;font-weight:700>import</span> JSONB <span style=color:#81a1c1;font-weight:700>as</span> JSONB_type
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>session<span style=color:#81a1c1>.</span>query<span style=color:#eceff4>(</span>DomainEvent<span style=color:#eceff4>)</span><span style=color:#81a1c1>.</span>filter<span style=color:#eceff4>(</span>
</span></span><span style=display:flex><span>    DomainEvent<span style=color:#81a1c1>.</span>event_type <span style=color:#81a1c1>==</span> <span style=color:#a3be8c>&#34;order.shipped&#34;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>    DomainEvent<span style=color:#81a1c1>.</span>payload<span style=color:#81a1c1>.</span>contains<span style=color:#eceff4>({</span><span style=color:#a3be8c>&#34;address&#34;</span><span style=color:#eceff4>:</span> <span style=color:#eceff4>{</span><span style=color:#a3be8c>&#34;city&#34;</span><span style=color:#eceff4>:</span> <span style=color:#a3be8c>&#34;Milan&#34;</span><span style=color:#eceff4>}})</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>)</span><span style=color:#81a1c1>.</span>all<span style=color:#eceff4>()</span></span></span></code></pre></div></div></div><div class=tab__panel data-tab-index=1><div class=highlight-wrapper><div class=codeblock-title>models.py</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>from</span> <span style=color:#8fbcbb>django.db</span> <span style=color:#81a1c1;font-weight:700>import</span> models
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>from</span> <span style=color:#8fbcbb>django.contrib.postgres.fields</span> <span style=color:#81a1c1;font-weight:700>import</span> JSONField  <span style=color:#616e87;font-style:italic># Django &lt; 3.1</span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># from django.db.models import JSONField              # Django &gt;= 3.1 (auto-uses jsonb on Postgres)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>class</span> <span style=color:#8fbcbb>DomainEvent</span><span style=color:#eceff4>(</span>models<span style=color:#81a1c1>.</span>Model<span style=color:#eceff4>):</span>
</span></span><span style=display:flex><span>    aggregate  <span style=color:#81a1c1>=</span> models<span style=color:#81a1c1>.</span>TextField<span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>    agg_id     <span style=color:#81a1c1>=</span> models<span style=color:#81a1c1>.</span>BigIntegerField<span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>    event_type <span style=color:#81a1c1>=</span> models<span style=color:#81a1c1>.</span>TextField<span style=color:#eceff4>(</span>db_index<span style=color:#81a1c1>=</span><span style=color:#81a1c1;font-weight:700>True</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    version    <span style=color:#81a1c1>=</span> models<span style=color:#81a1c1>.</span>IntegerField<span style=color:#eceff4>()</span>
</span></span><span style=display:flex><span>    payload    <span style=color:#81a1c1>=</span> models<span style=color:#81a1c1>.</span>JSONField<span style=color:#eceff4>()</span>  <span style=color:#616e87;font-style:italic># maps to jsonb in PostgreSQL</span>
</span></span><span style=display:flex><span>    created_at <span style=color:#81a1c1>=</span> models<span style=color:#81a1c1>.</span>DateTimeField<span style=color:#eceff4>(</span>auto_now_add<span style=color:#81a1c1>=</span><span style=color:#81a1c1;font-weight:700>True</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>class</span> <span style=color:#8fbcbb>Meta</span><span style=color:#eceff4>:</span>
</span></span><span style=display:flex><span>        indexes <span style=color:#81a1c1>=</span> <span style=color:#eceff4>[</span>
</span></span><span style=display:flex><span>            models<span style=color:#81a1c1>.</span>Index<span style=color:#eceff4>(</span>fields<span style=color:#81a1c1>=</span><span style=color:#eceff4>[</span><span style=color:#a3be8c>&#34;aggregate&#34;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#34;agg_id&#34;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>&#34;version&#34;</span><span style=color:#eceff4>]),</span>
</span></span><span style=display:flex><span>        <span style=color:#eceff4>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># Query using key lookup (translated to -&gt;&gt; operator)</span>
</span></span><span style=display:flex><span>DomainEvent<span style=color:#81a1c1>.</span>objects<span style=color:#81a1c1>.</span>filter<span style=color:#eceff4>(</span>
</span></span><span style=display:flex><span>    event_type<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;order.shipped&#34;</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>    payload__address__city<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;Milan&#34;</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>)</span></span></span></code></pre></div></div></div><div class=tab__panel data-tab-index=2><div class=highlight-wrapper><div class=codeblock-title>models.go</div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>package</span> models
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>import</span> <span style=color:#eceff4>(</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>&#34;database/sql/driver&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>&#34;time&#34;</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// JSONB is a custom type wrapping map[string]interface{}</span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// to satisfy GORM&#39;s Scanner/Valuer interface for jsonb columns.</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>type</span> JSONB <span style=color:#81a1c1;font-weight:700>map</span><span style=color:#eceff4>[</span><span style=color:#81a1c1>string</span><span style=color:#eceff4>]</span><span style=color:#81a1c1;font-weight:700>interface</span><span style=color:#eceff4>{}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#eceff4>(</span>j JSONB<span style=color:#eceff4>)</span> <span style=color:#88c0d0>Value</span><span style=color:#eceff4>()</span> <span style=color:#eceff4>(</span>driver<span style=color:#eceff4>.</span>Value<span style=color:#eceff4>,</span> <span style=color:#81a1c1>error</span><span style=color:#eceff4>)</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    b<span style=color:#eceff4>,</span> err <span style=color:#81a1c1>:=</span> json<span style=color:#eceff4>.</span><span style=color:#88c0d0>Marshal</span><span style=color:#eceff4>(</span>j<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> <span style=color:#81a1c1>string</span><span style=color:#eceff4>(</span>b<span style=color:#eceff4>),</span> err
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>func</span> <span style=color:#eceff4>(</span>j <span style=color:#81a1c1>*</span>JSONB<span style=color:#eceff4>)</span> <span style=color:#88c0d0>Scan</span><span style=color:#eceff4>(</span>value <span style=color:#81a1c1;font-weight:700>interface</span><span style=color:#eceff4>{})</span> <span style=color:#81a1c1>error</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    bytes<span style=color:#eceff4>,</span> ok <span style=color:#81a1c1>:=</span> value<span style=color:#eceff4>.([]</span><span style=color:#81a1c1>byte</span><span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>if</span> <span style=color:#eceff4>!</span>ok <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>        <span style=color:#81a1c1;font-weight:700>return</span> fmt<span style=color:#eceff4>.</span><span style=color:#88c0d0>Errorf</span><span style=color:#eceff4>(</span><span style=color:#a3be8c>&#34;failed to unmarshal JSONB: %v&#34;</span><span style=color:#eceff4>,</span> value<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span>    <span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>    <span style=color:#81a1c1;font-weight:700>return</span> json<span style=color:#eceff4>.</span><span style=color:#88c0d0>Unmarshal</span><span style=color:#eceff4>(</span>bytes<span style=color:#eceff4>,</span> j<span style=color:#eceff4>)</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>type</span> DomainEvent <span style=color:#81a1c1;font-weight:700>struct</span> <span style=color:#eceff4>{</span>
</span></span><span style=display:flex><span>    ID        <span style=color:#81a1c1>uint</span>      <span style=color:#a3be8c>`gorm:&#34;primarykey&#34;`</span>
</span></span><span style=display:flex><span>    Aggregate <span style=color:#81a1c1>string</span>    <span style=color:#a3be8c>`gorm:&#34;not null;index:idx_agg&#34;`</span>
</span></span><span style=display:flex><span>    AggID     <span style=color:#81a1c1>int64</span>     <span style=color:#a3be8c>`gorm:&#34;not null;index:idx_agg&#34;`</span>
</span></span><span style=display:flex><span>    EventType <span style=color:#81a1c1>string</span>    <span style=color:#a3be8c>`gorm:&#34;not null;index&#34;`</span>
</span></span><span style=display:flex><span>    Version   <span style=color:#81a1c1>int</span>       <span style=color:#a3be8c>`gorm:&#34;not null&#34;`</span>
</span></span><span style=display:flex><span>    Payload   JSONB     <span style=color:#a3be8c>`gorm:&#34;type:jsonb;not null&#34;`</span>
</span></span><span style=display:flex><span>    CreatedAt time<span style=color:#eceff4>.</span>Time
</span></span><span style=display:flex><span><span style=color:#eceff4>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic>// Raw query for GIN containment</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>var</span> results <span style=color:#eceff4>[]</span>DomainEvent
</span></span><span style=display:flex><span>db<span style=color:#eceff4>.</span><span style=color:#88c0d0>Raw</span><span style=color:#eceff4>(</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>`SELECT * FROM domain_events WHERE event_type = ? AND payload @&gt; ?::jsonb`</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span>    <span style=color:#a3be8c>&#34;order.shipped&#34;</span><span style=color:#eceff4>,</span> <span style=color:#a3be8c>`{&#34;address&#34;: {&#34;city&#34;: &#34;Milan&#34;}}`</span><span style=color:#eceff4>,</span>
</span></span><span style=display:flex><span><span style=color:#eceff4>).</span><span style=color:#88c0d0>Scan</span><span style=color:#eceff4>(</span><span style=color:#81a1c1>&amp;</span>results<span style=color:#eceff4>)</span></span></span></code></pre></div></div></div></div></div><h2 class="relative group">When NOT to Use JSONB<div id=when-not-to-use-jsonb class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#when-not-to-use-jsonb aria-label=Anchor>#</a></span></h2><p>JSONB is the right choice when the structure genuinely varies per row. It is the wrong choice when:</p><ul><li>The field is relational data (user, product, order relationships belong in normalized tables)</li><li>The field is queried frequently by a specific attribute (make it a column, add a B-tree index)</li><li>You need referential integrity (JSONB values are not foreign keys)</li><li>The nested structure is deep and would be better expressed as a join</li></ul><div class="admonition relative overflow-hidden rounded-lg border-l-4 my-3 px-4 py-3 shadow-sm" data-type=important><div class="flex items-center gap-2 font-semibold text-inherit"><div class="flex shrink-0 h-5 w-5 items-center justify-center text-lg"><span class="relative block icon"><svg viewBox="0 0 576 512"><path fill="currentColor" d="M287.9.0C297.1.0 305.5 5.25 309.5 13.52L378.1 154.8l153.3 22.7C540.4 178.8 547.8 185.1 550.7 193.7 553.5 202.4 551.2 211.9 544.8 218.2L433.6 328.4l26.3 155.5C461.4 492.9 457.7 502.1 450.2 507.4 442.8 512.7 432.1 513.4 424.9 509.1L287.9 435.9 150.1 509.1C142.9 513.4 133.1 512.7 125.6 507.4 118.2 502.1 114.5 492.9 115.1 483.9l27.1-155.5L31.11 218.2C24.65 211.9 22.36 202.4 25.2 193.7 28.03 185.1 35.5 178.8 44.49 177.5L197.7 154.8 266.3 13.52C270.4 5.249 278.7.0 287.9.0zm0 78.95L235.4 187.2C231.9 194.3 225.1 199.3 217.3 200.5L98.98 217.9 184.9 303C190.4 308.5 192.9 316.4 191.6 324.1L171.4 443.7l105.2-56.2C283.7 383.7 292.2 383.7 299.2 387.5l105.2 56.2-20.2-119.6C382.9 316.4 385.5 308.5 391 303l85.9-85.1-118.3-17.4C350.7 199.3 343.9 194.3 340.5 187.2L287.9 78.95z"/></svg></span></div><div class=grow>Important</div></div><div class="admonition-content mt-3 text-base leading-relaxed text-inherit"><p>If you find yourself consistently extracting the same path (<code>payload ->> 'status'</code>) in WHERE clauses and ORDER BY, that field should be a column. JSONB flexibility costs you query planner statistics, referential integrity, and type safety.</p></div></div><h2 class="relative group">Common Mistakes<div id=common-mistakes class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#common-mistakes aria-label=Anchor>#</a></span></h2><div id=accordion-67f39875105d4a02eed2a5b925b2719a class="border border-neutral-200 dark:border-neutral-700 rounded-lg overflow-hidden" data-accordion=collapse data-accordion-separated=false><details class=border-none data-accordion-item open><summary class="flex w-full cursor-pointer items-center justify-between gap-4 px-4 py-3 text-left text-lg font-semibold text-neutral-900 dark:text-neutral-100"><span class="flex items-center gap-2"><span>Using json instead of jsonb</span>
</span><span><span class="relative block icon"><svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></summary><div class="px-4 pb-4 text-neutral-700 dark:text-neutral-300">The <code>json</code> type stores raw text and cannot be indexed. Every query that filters or extracts from a <code>json</code> column re-parses the entire text. In any realistic workload this is a performance regression compared to <code>jsonb</code>. There is no valid reason to use <code>json</code> for new tables.</div></details><details class=border-none data-accordion-item><summary class="flex w-full cursor-pointer items-center justify-between gap-4 px-4 py-3 text-left text-lg font-semibold text-neutral-900 dark:text-neutral-100"><span class="flex items-center gap-2"><span>No GIN index on a queried JSONB column</span>
</span><span><span class="relative block icon"><svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></summary><div class="px-4 pb-4 text-neutral-700 dark:text-neutral-300">Without a GIN index, containment queries (<code>@></code>) and key existence queries (<code>?</code>) perform a full sequential scan. On tables with millions of rows, this is the difference between milliseconds and minutes. Add a GIN index on any JSONB column you filter on.</div></details><details class=border-none data-accordion-item><summary class="flex w-full cursor-pointer items-center justify-between gap-4 px-4 py-3 text-left text-lg font-semibold text-neutral-900 dark:text-neutral-100"><span class="flex items-center gap-2"><span>Updating JSONB with string concatenation</span>
</span><span><span class="relative block icon"><svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></summary><div class="px-4 pb-4 text-neutral-700 dark:text-neutral-300">Constructing JSON in application code and overwriting the entire column loses any concurrent updates and is error-prone. Use <code>jsonb_set</code> for targeted updates and the <code>||</code> merge operator for shallow merges. Never concatenate strings to build JSON for SQL queries.</div></details><details class=border-none data-accordion-item><summary class="flex w-full cursor-pointer items-center justify-between gap-4 px-4 py-3 text-left text-lg font-semibold text-neutral-900 dark:text-neutral-100"><span class="flex items-center gap-2"><span>Storing deeply nested structures that should be columns</span>
</span><span><span class="relative block icon"><svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></summary><div class="px-4 pb-4 text-neutral-700 dark:text-neutral-300">A three-level nested JSONB object with five frequently-queried keys is a maintenance problem. The query planner cannot collect statistics on JSONB contents, so estimates are poor and query plans can be suboptimal. Extract frequently-queried fields as columns and use the JSONB column for the genuinely variable remainder.</div></details></div><style>#accordion-67f39875105d4a02eed2a5b925b2719a>details+details{border-top:1px solid rgb(var(--color-neutral-200))}.dark #accordion-67f39875105d4a02eed2a5b925b2719a>details+details{border-top-color:rgb(var(--color-neutral-700))}</style><script>(()=>{const e=document.getElementById("accordion-67f39875105d4a02eed2a5b925b2719a");if(!e)return;const t=e.querySelectorAll("details[data-accordion-item]");t.forEach(e=>{e.addEventListener("toggle",()=>{if(!e.open)return;t.forEach(t=>{t!==e&&t.removeAttribute("open")})})})})()</script><hr><p>If you want to go deeper on any of this, I offer 1:1 coaching sessions for engineers working on AI integration, cloud architecture, and platform engineering. <a href=https://calendly.com/manuelfedele/60min target=_blank rel=noreferrer>Book a session</a> (50 EUR / 60 min) or reach out at <a href=mailto:manuel.fedele+website@gmail.com>manuel.fedele+website@gmail.com</a>.</p></div></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span class="flex flex-col"><a class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/how-to-create-a-webserver-in-golang/><span class=leading-6><span class="inline-block rtl:rotate-180">&larr;</span>&ensp;Building Production HTTP Services in Go
</span></a><span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2022-12-11T19:14:21+01:00>11 December 2022</time>
</span></span><span class="flex flex-col items-end"><a class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/create-desktop-application-stock-market-data-golang/><span class=leading-6>Building Desktop Applications in Go with Fyne: Stock Market Dashboard&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
</span></a><span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2022-12-19T19:08:58+01:00>19 December 2022</time></span></span></div></div></footer></article><div id=scroll-to-top class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2026
Manuel Fedele</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://manuelfedele.github.io/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>