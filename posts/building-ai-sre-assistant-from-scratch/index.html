<!doctype html><html lang=en><head><title>Building an AI SRE Assistant From Scratch: Architecture of an Autonomous Infrastructure Investigator :: Git Push and Run</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Building an AI SRE Assistant From Scratch: Architecture of an Autonomous Infrastructure Investigator What if your on-call engineer never slept, had instant access to every repository and every AWS account, and could trace a production issue from DNS to database in under a minute?
That&rsquo;s the question that led me to build TARS, an AI-powered SRE assistant that autonomously investigates infrastructure issues by combining LLM reasoning with deep integrations into GitLab and AWS. Named after the robot from Interstellar (because every good internal tool needs a movie reference), TARS is a full-stack application where engineers interact with an AI agent through a chat interface. The agent doesn&rsquo;t just answer questions. It investigates. It clones repos, greps code, reads CloudWatch logs, traces DNS chains, inspects ECS services, and synthesizes findings into structured reports.
"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://manuelfedele.github.io/posts/building-ai-sre-assistant-from-scratch/><script async src="https://www.googletagmanager.com/gtag/js?id=G-K9P1DJX238"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-K9P1DJX238")}</script><link rel=stylesheet href=https://manuelfedele.github.io/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://manuelfedele.github.io/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://manuelfedele.github.io/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://manuelfedele.github.io/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://manuelfedele.github.io/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://manuelfedele.github.io/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://manuelfedele.github.io/css/main.min.775ac2af004d44c22a6d000fbd1d9af529642f5cef27399d0280d180af2c2e9b.css><link rel=stylesheet href=https://manuelfedele.github.io/css/menu.min.310d32205bdedd6f43144e3c3273c9deecd238eba5f9108db5ea96ca0cfbe377.css><link rel=stylesheet href=https://manuelfedele.github.io/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://manuelfedele.github.io/css/post.min.ad50c7f4d00e7975918f37fc74c6029e1959a40d66fb5b2c6564a8715e985573.css><link rel=stylesheet href=https://manuelfedele.github.io/css/syntax.min.e9ab635cf918bc84b901eb65c0b2caa74c9544245e3647c1af5c129896ef276e.css><link rel=stylesheet href=https://manuelfedele.github.io/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://manuelfedele.github.io/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel="shortcut icon" href=https://manuelfedele.github.io/favicon.png><link rel=apple-touch-icon href=https://manuelfedele.github.io/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Building an AI SRE Assistant From Scratch: Architecture of an Autonomous Infrastructure Investigator"><meta property="og:description" content="Building an AI SRE Assistant From Scratch: Architecture of an Autonomous Infrastructure Investigator What if your on-call engineer never slept, had instant access to every repository and every AWS account, and could trace a production issue from DNS to database in under a minute?
That&rsquo;s the question that led me to build TARS, an AI-powered SRE assistant that autonomously investigates infrastructure issues by combining LLM reasoning with deep integrations into GitLab and AWS. Named after the robot from Interstellar (because every good internal tool needs a movie reference), TARS is a full-stack application where engineers interact with an AI agent through a chat interface. The agent doesn&rsquo;t just answer questions. It investigates. It clones repos, greps code, reads CloudWatch logs, traces DNS chains, inspects ECS services, and synthesizes findings into structured reports.
"><meta property="og:url" content="https://manuelfedele.github.io/posts/building-ai-sre-assistant-from-scratch/"><meta property="og:site_name" content="Git Push and Run"><meta property="og:image" content="https://manuelfedele.github.io/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2026-02-22 09:30:00 +0100 +0100"></head><body><div class="container center"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>git push && run</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;â–¾</li><li><ul class=menu__dropdown><li><a href=/about>About</a></li><li><a href=/posts>Blog</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about>About</a></li><li><a href=/posts>Blog</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://manuelfedele.github.io/posts/building-ai-sre-assistant-from-scratch/>Building an AI SRE Assistant From Scratch: Architecture of an Autonomous Infrastructure Investigator</a></h1><div class=post-meta><time class=post-date>2026-02-22</time><span class=post-reading-time>22 min read (4501 words)</span></div><span class=post-tags>#<a href=https://manuelfedele.github.io/tags/ai/>AI</a>&nbsp;
#<a href=https://manuelfedele.github.io/tags/python/>python</a>&nbsp;
#<a href=https://manuelfedele.github.io/tags/django/>django</a>&nbsp;
#<a href=https://manuelfedele.github.io/tags/react/>react</a>&nbsp;
#<a href=https://manuelfedele.github.io/tags/aws/>AWS</a>&nbsp;
#<a href=https://manuelfedele.github.io/tags/gitlab/>GitLab</a>&nbsp;
#<a href=https://manuelfedele.github.io/tags/llm/>LLM</a>&nbsp;
#<a href=https://manuelfedele.github.io/tags/devops/>DevOps</a>&nbsp;
#<a href=https://manuelfedele.github.io/tags/sre/>SRE</a>&nbsp;
#<a href=https://manuelfedele.github.io/tags/architecture/>architecture</a>&nbsp;</span><div class=table-of-contents><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#table-of-contents>Table of Contents</a></li><li><a href=#the-problem>The Problem</a></li><li><a href=#architecture-overview>Architecture Overview</a></li><li><a href=#tech-stack>Tech Stack</a></li><li><a href=#authentication-four-layers-deep>Authentication: Four Layers Deep</a><ul><li><a href=#layer-1-microsoft-entra-id-user-identity>Layer 1: Microsoft Entra ID (User Identity)</a></li><li><a href=#layer-2-gitlab-repository-access>Layer 2: GitLab (Repository Access)</a></li><li><a href=#layer-3-aws-saml-federation-infrastructure-access>Layer 3: AWS SAML Federation (Infrastructure Access)</a></li><li><a href=#layer-4-keycloak-llm-gateway-access>Layer 4: Keycloak (LLM Gateway Access)</a></li></ul></li><li><a href=#the-agent-system>The Agent System</a><ul><li><a href=#the-system-prompt>The System Prompt</a></li></ul></li><li><a href=#tool-registry-30-specialized-tools>Tool Registry: 30+ Specialized Tools</a><ul><li><a href=#aws-tools-read-only>AWS Tools (Read-Only)</a></li><li><a href=#gitlab-tools>GitLab Tools</a></li><li><a href=#the-repo_grep-tool>The repo_grep Tool</a></li></ul></li><li><a href=#sub-agent-architecture>Sub-Agent Architecture</a></li><li><a href=#security-model>Security Model</a><ul><li><a href=#level-1-tool-policy-classification>Level 1: Tool Policy Classification</a></li><li><a href=#level-2-branch-protection>Level 2: Branch Protection</a></li><li><a href=#level-3-network-safety>Level 3: Network Safety</a></li><li><a href=#level-4-output-sanitization>Level 4: Output Sanitization</a></li></ul></li><li><a href=#streaming-infrastructure>Streaming Infrastructure</a></li><li><a href=#the-frontend>The Frontend</a><ul><li><a href=#the-usechat-hook>The useChat Hook</a></li><li><a href=#design-language>Design Language</a></li><li><a href=#activity-sidebar>Activity Sidebar</a></li></ul></li><li><a href=#kpi-dashboard>KPI Dashboard</a></li><li><a href=#memory-and-context-management>Memory and Context Management</a></li><li><a href=#database-design>Database Design</a></li><li><a href=#deployment>Deployment</a></li><li><a href=#lessons-learned>Lessons Learned</a></li><li><a href=#whats-next>What&rsquo;s Next</a></li><li><a href=#references>References</a></li></ul></nav></div><div class=post-content><div><h1 id=building-an-ai-sre-assistant-from-scratch-architecture-of-an-autonomous-infrastructure-investigator>Building an AI SRE Assistant From Scratch: Architecture of an Autonomous Infrastructure Investigator<a href=#building-an-ai-sre-assistant-from-scratch-architecture-of-an-autonomous-infrastructure-investigator class=hanchor arialabel=Anchor>#</a></h1><p>What if your on-call engineer never slept, had instant access to every repository and every AWS account, and could trace a production issue from DNS to database in under a minute?</p><p>That&rsquo;s the question that led me to build TARS, an AI-powered SRE assistant that autonomously investigates infrastructure issues by combining LLM reasoning with deep integrations into GitLab and AWS. Named after the robot from Interstellar (because every good internal tool needs a movie reference), TARS is a full-stack application where engineers interact with an AI agent through a chat interface. The agent doesn&rsquo;t just answer questions. It investigates. It clones repos, greps code, reads CloudWatch logs, traces DNS chains, inspects ECS services, and synthesizes findings into structured reports.</p><p>In this post I&rsquo;ll walk through every layer of the architecture: the authentication system, the agent framework, the tool registry, the streaming infrastructure, the frontend, and the deployment patterns that make it all work in production.</p><p><img src=/img/tars/login.png alt="TARS Login Screen">
<em>The TARS login screen. Microsoft Entra ID SSO provides zero-friction authentication for the engineering team.</em></p><hr><h2 id=table-of-contents>Table of Contents<a href=#table-of-contents class=hanchor arialabel=Anchor>#</a></h2><ul><li><a href=/posts/building-ai-sre-assistant-from-scratch/#the-problem>The Problem</a></li><li><a href=/posts/building-ai-sre-assistant-from-scratch/#architecture-overview>Architecture Overview</a></li><li><a href=/posts/building-ai-sre-assistant-from-scratch/#tech-stack>Tech Stack</a></li><li><a href=/posts/building-ai-sre-assistant-from-scratch/#authentication-four-layers-deep>Authentication: Four Layers Deep</a></li><li><a href=/posts/building-ai-sre-assistant-from-scratch/#the-agent-system>The Agent System</a></li><li><a href=/posts/building-ai-sre-assistant-from-scratch/#tool-registry-30-specialized-tools>Tool Registry: 30+ Specialized Tools</a></li><li><a href=/posts/building-ai-sre-assistant-from-scratch/#sub-agent-architecture>Sub-Agent Architecture</a></li><li><a href=/posts/building-ai-sre-assistant-from-scratch/#security-model>Security Model</a></li><li><a href=/posts/building-ai-sre-assistant-from-scratch/#streaming-infrastructure>Streaming Infrastructure</a></li><li><a href=/posts/building-ai-sre-assistant-from-scratch/#the-frontend>The Frontend</a></li><li><a href=/posts/building-ai-sre-assistant-from-scratch/#kpi-dashboard>KPI Dashboard</a></li><li><a href=/posts/building-ai-sre-assistant-from-scratch/#memory-and-context-management>Memory and Context Management</a></li><li><a href=/posts/building-ai-sre-assistant-from-scratch/#database-design>Database Design</a></li><li><a href=/posts/building-ai-sre-assistant-from-scratch/#deployment>Deployment</a></li><li><a href=/posts/building-ai-sre-assistant-from-scratch/#lessons-learned>Lessons Learned</a></li></ul><hr><h2 id=the-problem>The Problem<a href=#the-problem class=hanchor arialabel=Anchor>#</a></h2><p>Platform teams at scale face a recurring challenge: investigating production issues requires correlating information across multiple systems. A typical investigation might look like:</p><ol><li>Someone reports a 503 error on a service</li><li>You check the ALB target group health</li><li>Targets are unhealthy, so you check the ECS service</li><li>ECS shows a deployment in progress, so you check the task definition</li><li>The image tag points to a commit, so you check GitLab</li><li>The last MR changed a health check endpoint, so you read the code</li><li>The code has a bug in the new health check, so you check CloudWatch logs to confirm</li><li>Logs confirm the error, you write up the finding</li></ol><p>Each step requires switching context, authenticating to a different system, navigating a different UI, and mentally correlating the results. For an experienced engineer, this takes 15-30 minutes. For a junior engineer, it can take hours, and they might miss steps entirely.</p><p>TARS automates this entire workflow. You type &ldquo;investigate the 503 errors on service X&rdquo; and the agent autonomously:</p><ul><li>Finds the service in GitLab</li><li>Reads the repository structure and configuration</li><li>Identifies the AWS account and region</li><li>Checks ALB target health, ECS service status, and recent deployments</li><li>Reads CloudWatch logs for error patterns</li><li>Checks recent MRs and commits for relevant changes</li><li>Correlates all findings and presents a structured report</li></ul><p>The key insight is that SRE investigation is largely procedural. The steps follow patterns. What makes a good SRE isn&rsquo;t memorizing those patterns, it&rsquo;s knowing which patterns to apply and how to interpret the results. That&rsquo;s exactly what LLMs excel at.</p><hr><h2 id=architecture-overview>Architecture Overview<a href=#architecture-overview class=hanchor arialabel=Anchor>#</a></h2><p>TARS is a monolith deployed as a single container. The architecture is intentionally simple:</p><pre tabindex=0><code>VPN -&gt; Internal ALB (HTTPS/443, TLS 1.3)
           |
           v
    ECS Fargate (port 8080)
           |
           v
    Nginx (port 8080)
    /              \
/assets/*         /api/*
(static SPA)      (reverse proxy)
                       |
                       v
               Uvicorn (port 8000)
               Django ASGI
              /     |      \
      PostgreSQL  Redis  AWS Bedrock
      (Aurora)  (ElastiCache) (AgentCore Memory)
</code></pre><p>The frontend is a React SPA served by Nginx. API requests are proxied to the Django backend running on Uvicorn with ASGI support (critical for SSE streaming). PostgreSQL stores users, sessions, chat history, and KPI snapshots. Redis caches AWS credentials, GitLab API responses, and computed dashboard data. AWS Bedrock AgentCore provides persistent memory across sessions.</p><p>Why a monolith? Because the operational complexity of a microservice architecture is not justified when you have a single team, a single deployment target, and a single user-facing application. The monolith deploys in seconds, has one set of logs to check, and one service to monitor. If it ever needs to be split, the code is modular enough to extract services later.</p><hr><h2 id=tech-stack>Tech Stack<a href=#tech-stack class=hanchor arialabel=Anchor>#</a></h2><p><strong>Backend:</strong></p><ul><li>Python 3.12+ with Django 6.0</li><li>Async support via <code>adrf</code> (async Django REST Framework)</li><li>Uvicorn as the ASGI server</li><li><code>strands-agents</code> for the AI agent framework</li><li><code>httpx</code> for async HTTP clients</li><li><code>msal</code> for Microsoft Entra ID OAuth2</li><li><code>requests-ntlm</code> for ADFS/SAML corporate auth</li><li><code>pyotp</code> for TOTP generation</li><li>Fernet encryption for credential storage</li></ul><p><strong>Frontend:</strong></p><ul><li>React 19 with TypeScript 5</li><li>Vite 7 as the build tool</li><li>Tailwind CSS 3 for styling</li><li>Radix UI for accessible primitives</li><li>Framer Motion for animations</li><li>Recharts for data visualization</li><li>React Hook Form + Zod for form validation</li><li>SSE (Server-Sent Events) for real-time streaming</li></ul><p><strong>Infrastructure:</strong></p><ul><li>AWS ECS Fargate (Spot + On-Demand)</li><li>Aurora PostgreSQL Serverless v2</li><li>ElastiCache Redis</li><li>Internal ALB with WAF</li><li>Terraform for IaC</li><li>Docker multi-stage build (Node 20 Alpine + Python 3.13 slim)</li></ul><hr><h2 id=authentication-four-layers-deep>Authentication: Four Layers Deep<a href=#authentication-four-layers-deep class=hanchor arialabel=Anchor>#</a></h2><p>Authentication in TARS isn&rsquo;t just about identifying the user. It&rsquo;s about establishing trust chains across four distinct systems: the application itself, GitLab, AWS (via corporate SAML federation), and the LLM Gateway (via Keycloak). Each layer serves a different purpose, and each requires its own credential management.</p><h3 id=layer-1-microsoft-entra-id-user-identity>Layer 1: Microsoft Entra ID (User Identity)<a href=#layer-1-microsoft-entra-id-user-identity class=hanchor arialabel=Anchor>#</a></h3><p>The primary authentication uses OAuth2 Authorization Code flow with PKCE:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Simplified OAuth2 PKCE flow</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AuthCallbackView</span><span class=p>(</span><span class=n>APIView</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>post</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>code</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;code&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>code_verifier</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;code_verifier&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Exchange authorization code for tokens</span>
</span></span><span class=line><span class=cl>        <span class=n>msal_app</span> <span class=o>=</span> <span class=n>ConfidentialClientApplication</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>client_id</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>ENTRA_CLIENT_ID</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>authority</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;https://login.microsoftonline.com/</span><span class=si>{</span><span class=n>settings</span><span class=o>.</span><span class=n>ENTRA_TENANT_ID</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>client_credential</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>ENTRA_CLIENT_SECRET</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>msal_app</span><span class=o>.</span><span class=n>acquire_token_by_authorization_code</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>code</span><span class=o>=</span><span class=n>code</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>scopes</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;User.Read&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>redirect_uri</span><span class=o>=</span><span class=n>settings</span><span class=o>.</span><span class=n>ENTRA_REDIRECT_URI</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>code_verifier</span><span class=o>=</span><span class=n>code_verifier</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Validate the ID token signature against Microsoft JWKS</span>
</span></span><span class=line><span class=cl>        <span class=n>id_token</span> <span class=o>=</span> <span class=n>validate_and_decode_token</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s2>&#34;id_token&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Create or update user</span>
</span></span><span class=line><span class=cl>        <span class=n>user</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=k>await</span> <span class=n>User</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>aupdate_or_create</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>entra_id</span><span class=o>=</span><span class=n>id_token</span><span class=p>[</span><span class=s2>&#34;oid&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>defaults</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;display_name&#34;</span><span class=p>:</span> <span class=n>id_token</span><span class=p>[</span><span class=s2>&#34;name&#34;</span><span class=p>]},</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Create session with sliding window expiry</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span> <span class=o>=</span> <span class=k>await</span> <span class=n>UserSession</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>acreate</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>user</span><span class=o>=</span><span class=n>user</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>expires_at</span><span class=o>=</span><span class=n>now</span><span class=p>()</span> <span class=o>+</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>hours</span><span class=o>=</span><span class=mi>24</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Set HttpOnly, Secure, SameSite=Strict cookie</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>Response</span><span class=p>({</span><span class=s2>&#34;user&#34;</span><span class=p>:</span> <span class=n>UserSerializer</span><span class=p>(</span><span class=n>user</span><span class=p>)</span><span class=o>.</span><span class=n>data</span><span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span><span class=o>.</span><span class=n>set_cookie</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;session_id&#34;</span><span class=p>,</span> <span class=n>session</span><span class=o>.</span><span class=n>token</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>httponly</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>secure</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>samesite</span><span class=o>=</span><span class=s2>&#34;Strict&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>max_age</span><span class=o>=</span><span class=mi>86400</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>response</span>
</span></span></code></pre></div><p>The PKCE flow prevents authorization code interception attacks. The session cookie is <code>HttpOnly</code> (no JavaScript access), <code>Secure</code> (HTTPS only), and <code>SameSite=Strict</code> (no CSRF). Session expiry uses a sliding window: each authenticated request extends the session, but only if at least 300 seconds have passed since the last extension (to avoid hammering the database on every request).</p><h3 id=layer-2-gitlab-repository-access>Layer 2: GitLab (Repository Access)<a href=#layer-2-gitlab-repository-access class=hanchor arialabel=Anchor>#</a></h3><p>Users configure their GitLab personal access token in the Settings page. The token is encrypted with Fernet symmetric encryption before storage:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>EncryptedCharField</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Transparently encrypts/decrypts field values using Fernet.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>fernet</span> <span class=o>=</span> <span class=n>Fernet</span><span class=p>(</span><span class=n>settings</span><span class=o>.</span><span class=n>FIELD_ENCRYPTION_KEY</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_prep_value</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>value</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>fernet</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>value</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>from_db_value</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>value</span><span class=p>,</span> <span class=n>expression</span><span class=p>,</span> <span class=n>connection</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>value</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>fernet</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>value</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>value</span>
</span></span></code></pre></div><p>The encryption key is derived from <code>DJANGO_SECRET_KEY</code> and stored in AWS Secrets Manager. This means even if the database is compromised, the tokens are unreadable without the application secret.</p><h3 id=layer-3-aws-saml-federation-infrastructure-access>Layer 3: AWS SAML Federation (Infrastructure Access)<a href=#layer-3-aws-saml-federation-infrastructure-access class=hanchor arialabel=Anchor>#</a></h3><p>This is the most complex authentication layer. Engineers need access to 100+ AWS accounts, each with multiple roles. Rather than managing individual IAM users, TARS authenticates via the corporate SAML federation chain:</p><pre tabindex=0><code>User credentials -&gt; Corporate ADFS (NTLM) -&gt; SAML assertion
    -&gt; Keycloak (SAML relay + OTP) -&gt; AWS SAML response
    -&gt; STS AssumeRoleWithSAML -&gt; Temporary credentials
</code></pre><p><img src=/img/tars/settings-aws.png alt="TARS AWS Settings">
<em>The AWS authentication settings. Users provide corporate credentials and an optional OTP secret for automatic re-authentication.</em></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>AWSSAMLAuthenticator</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Authenticates to AWS via corporate SAML federation.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>authenticate</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>username</span><span class=p>,</span> <span class=n>password</span><span class=p>,</span> <span class=n>otp</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Step 1: Authenticate against corporate ADFS</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>Session</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span><span class=o>.</span><span class=n>auth</span> <span class=o>=</span> <span class=n>HttpNtlmAuth</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;CORP</span><span class=se>\\</span><span class=si>{</span><span class=n>username</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>password</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>adfs_response</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>ADFS_URL</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>params</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;loginToRp&#34;</span><span class=p>:</span> <span class=n>KEYCLOAK_ENTITY_ID</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Step 2: Extract SAML assertion from ADFS response</span>
</span></span><span class=line><span class=cl>        <span class=n>saml_assertion</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_extract_saml</span><span class=p>(</span><span class=n>adfs_response</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Step 3: Submit SAML to Keycloak with OTP</span>
</span></span><span class=line><span class=cl>        <span class=n>kc_response</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>KEYCLOAK_SAML_ENDPOINT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;SAMLResponse&#34;</span><span class=p>:</span> <span class=n>saml_assertion</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;otp&#34;</span><span class=p>:</span> <span class=n>otp</span> <span class=ow>or</span> <span class=n>pyotp</span><span class=o>.</span><span class=n>TOTP</span><span class=p>(</span><span class=n>otp_secret</span><span class=p>)</span><span class=o>.</span><span class=n>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Step 4: Extract AWS roles from final SAML response</span>
</span></span><span class=line><span class=cl>        <span class=n>aws_saml</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_extract_aws_saml</span><span class=p>(</span><span class=n>kc_response</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>roles</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_parse_aws_roles</span><span class=p>(</span><span class=n>aws_saml</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Step 5: Assume each role via STS</span>
</span></span><span class=line><span class=cl>        <span class=n>credentials</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=n>sts</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s2>&#34;sts&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>role_arn</span><span class=p>,</span> <span class=n>provider_arn</span> <span class=ow>in</span> <span class=n>roles</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>creds</span> <span class=o>=</span> <span class=n>sts</span><span class=o>.</span><span class=n>assume_role_with_saml</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>RoleArn</span><span class=o>=</span><span class=n>role_arn</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>PrincipalArn</span><span class=o>=</span><span class=n>provider_arn</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>SAMLAssertion</span><span class=o>=</span><span class=n>aws_saml</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>credentials</span><span class=p>[</span><span class=n>role_arn</span><span class=p>]</span> <span class=o>=</span> <span class=n>creds</span><span class=p>[</span><span class=s2>&#34;Credentials&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Cache credentials in Redis with TTL</span>
</span></span><span class=line><span class=cl>        <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_cache_credentials</span><span class=p>(</span><span class=n>credentials</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;accounts&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=nb>set</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;:&#34;</span><span class=p>)[</span><span class=mi>4</span><span class=p>]</span> <span class=k>for</span> <span class=n>r</span><span class=p>,</span> <span class=n>_</span> <span class=ow>in</span> <span class=n>roles</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;roles&#34;</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>roles</span><span class=p>)}</span>
</span></span></code></pre></div><p>When the OTP secret is configured, TARS can automatically re-authenticate when credentials expire, making the AWS access seamless. The temporary credentials are cached in Redis with a TTL matching their STS expiration. The agent can then assume different roles on demand to investigate resources across any AWS account.</p><h3 id=layer-4-keycloak-llm-gateway-access>Layer 4: Keycloak (LLM Gateway Access)<a href=#layer-4-keycloak-llm-gateway-access class=hanchor arialabel=Anchor>#</a></h3><p><img src=/img/tars/settings-credentials.png alt="TARS Settings - Credentials">
<em>The credentials settings page. Each integration has its own encrypted credential store.</em></p><p>The LLM Gateway that provides access to GPT models requires Keycloak authentication. Users configure their Keycloak credentials, and TARS obtains OAuth2 tokens on their behalf:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>async</span> <span class=k>def</span> <span class=nf>get_llm_gateway_token</span><span class=p>(</span><span class=n>user_settings</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>token_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;grant_type&#34;</span><span class=p>:</span> <span class=s2>&#34;password&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;client_id&#34;</span><span class=p>:</span> <span class=n>LLM_GW_CLIENT_ID</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;username&#34;</span><span class=p>:</span> <span class=n>user_settings</span><span class=o>.</span><span class=n>keycloak_username</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;password&#34;</span><span class=p>:</span> <span class=n>user_settings</span><span class=o>.</span><span class=n>keycloak_password</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>with</span> <span class=n>httpx</span><span class=o>.</span><span class=n>AsyncClient</span><span class=p>()</span> <span class=k>as</span> <span class=n>client</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=k>await</span> <span class=n>client</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>KEYCLOAK_URL</span><span class=si>}</span><span class=s2>/realms/</span><span class=si>{</span><span class=n>REALM</span><span class=si>}</span><span class=s2>/protocol/openid-connect/token&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span><span class=o>=</span><span class=n>token_data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()[</span><span class=s2>&#34;access_token&#34;</span><span class=p>]</span>
</span></span></code></pre></div><p><img src=/img/tars/settings-gitlab.png alt="TARS Settings - GitLab">
<em>GitLab configuration. The base URL is configurable because different teams may use different GitLab instances.</em></p><hr><h2 id=the-agent-system>The Agent System<a href=#the-agent-system class=hanchor arialabel=Anchor>#</a></h2><p>The heart of TARS is the agent, built on the <code>strands-agents</code> framework. Each user request creates a fresh agent instance with the user&rsquo;s credentials injected via Python&rsquo;s <code>contextvars</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>strands</span> <span class=kn>import</span> <span class=n>Agent</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>strands.models.openai</span> <span class=kn>import</span> <span class=n>OpenAIModel</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>strands.tools</span> <span class=kn>import</span> <span class=n>ConcurrentToolExecutor</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>strands.conversation</span> <span class=kn>import</span> <span class=n>SlidingWindowConversationManager</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>build_agent</span><span class=p>(</span><span class=n>user</span><span class=p>,</span> <span class=n>user_settings</span><span class=p>,</span> <span class=n>session_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Configure the LLM</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span> <span class=o>=</span> <span class=n>OpenAIModel</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>model_id</span><span class=o>=</span><span class=s2>&#34;gpt-5.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>client_args</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;base_url&#34;</span><span class=p>:</span> <span class=n>LLM_GATEWAY_URL</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;api_key&#34;</span><span class=p>:</span> <span class=n>get_gateway_token</span><span class=p>(</span><span class=n>user_settings</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>params</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;temperature&#34;</span><span class=p>:</span> <span class=mf>0.0</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Build tool list based on user&#39;s configured integrations</span>
</span></span><span class=line><span class=cl>    <span class=n>tools</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>user_settings</span><span class=o>.</span><span class=n>gitlab_token</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>tools</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>GITLAB_TOOLS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>has_aws_credentials</span><span class=p>(</span><span class=n>user</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>tools</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>AWS_TOOLS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>tools</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>CORE_TOOLS</span><span class=p>)</span>  <span class=c1># think, plan, http, repo_grep</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Configure memory</span>
</span></span><span class=line><span class=cl>    <span class=n>memory</span> <span class=o>=</span> <span class=n>SafeAgentCoreMemorySessionManager</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>namespaces</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;preferences&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;/preferences/</span><span class=si>{</span><span class=n>user</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;facts&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;/facts/</span><span class=si>{</span><span class=n>user</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;summaries&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;/summaries/</span><span class=si>{</span><span class=n>user</span><span class=o>.</span><span class=n>id</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>session_id</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Agent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>tools</span><span class=o>=</span><span class=n>tools</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>tool_executor</span><span class=o>=</span><span class=n>ConcurrentToolExecutor</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=n>conversation_manager</span><span class=o>=</span><span class=n>SlidingWindowConversationManager</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>window_size</span><span class=o>=</span><span class=mi>40</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>session_manager</span><span class=o>=</span><span class=n>memory</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>system_prompt</span><span class=o>=</span><span class=n>SYSTEM_PROMPT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span></code></pre></div><h3 id=the-system-prompt>The System Prompt<a href=#the-system-prompt class=hanchor arialabel=Anchor>#</a></h3><p>The system prompt is over 8,000 words and establishes the agent&rsquo;s behavioral framework. Some key directives:</p><p><strong>Autonomous investigation, not advice:</strong></p><blockquote><p>&ldquo;You are TARS, a senior SRE debugger and platform analyst. When asked to investigate, you investigate. You don&rsquo;t suggest what the user should check. You check it yourself.&rdquo;</p></blockquote><p><strong>Context-first mandate:</strong></p><blockquote><p>&ldquo;When a service name is mentioned, ALWAYS call gather_context() before any analysis. Never reason about a service without first discovering its actual configuration.&rdquo;</p></blockquote><p><strong>Zero-hallucination enforcement:</strong></p><blockquote><p>&ldquo;Never reference AWS resources, GitLab projects, or configuration details that you have not discovered via tool calls in this conversation. If you haven&rsquo;t checked it, you don&rsquo;t know it.&rdquo;</p></blockquote><p><strong>Multi-signal verification:</strong></p><blockquote><p>&ldquo;Never conclude &rsquo;nothing found&rsquo; or &rsquo;everything looks fine&rsquo; without checking at least two independent signals. If CloudWatch shows no errors, also check ECS events and ALB metrics.&rdquo;</p></blockquote><p><strong>Tool intent transparency:</strong></p><blockquote><p>&ldquo;Before each tool call, emit a single short sentence explaining what you&rsquo;re checking and why. This helps the user follow your investigation.&rdquo;</p></blockquote><p>These constraints transform a general-purpose LLM into a focused investigation agent. The temperature is set to 0.0 because SRE investigation requires determinism, not creativity. You want the agent to follow the same investigation procedures every time.</p><hr><h2 id=tool-registry-30-specialized-tools>Tool Registry: 30+ Specialized Tools<a href=#tool-registry-30-specialized-tools class=hanchor arialabel=Anchor>#</a></h2><p>TARS has access to over 30 tools, each designed for a specific investigation task. The tools are not generic wrappers. They encode domain knowledge about how to query each system effectively.</p><h3 id=aws-tools-read-only>AWS Tools (Read-Only)<a href=#aws-tools-read-only class=hanchor arialabel=Anchor>#</a></h3><p>Each AWS service gets its own tool with smart defaults and domain-specific parameter handling:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@tool</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>aws_ecs</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>action</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>parameters</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>account_id</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>region</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;eu-central-1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Query AWS ECS resources.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Common actions:
</span></span></span><span class=line><span class=cl><span class=s2>    - describe_services: Get service details (cluster, serviceName required)
</span></span></span><span class=line><span class=cl><span class=s2>    - describe_tasks: Get task details (cluster, tasks required)
</span></span></span><span class=line><span class=cl><span class=s2>    - list_services: List services in a cluster
</span></span></span><span class=line><span class=cl><span class=s2>    - describe_task_definition: Get task definition details
</span></span></span><span class=line><span class=cl><span class=s2>    - list_task_definitions: List task definition families
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    The tool automatically:
</span></span></span><span class=line><span class=cl><span class=s2>    - Resolves the correct AWS account credentials from the SAML cache
</span></span></span><span class=line><span class=cl><span class=s2>    - Adds &#39;eu-central-1&#39; as default region if not specified
</span></span></span><span class=line><span class=cl><span class=s2>    - Handles pagination for list operations
</span></span></span><span class=line><span class=cl><span class=s2>    - Truncates large responses to prevent context overflow
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># Validate action is read-only</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>action</span><span class=o>.</span><span class=n>startswith</span><span class=p>((</span><span class=s2>&#34;describe_&#34;</span><span class=p>,</span> <span class=s2>&#34;list_&#34;</span><span class=p>,</span> <span class=s2>&#34;get_&#34;</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;Action &#39;</span><span class=si>{</span><span class=n>action</span><span class=si>}</span><span class=s2>&#39; is not allowed (read-only)&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Get cached credentials for the target account</span>
</span></span><span class=line><span class=cl>    <span class=n>credentials</span> <span class=o>=</span> <span class=n>get_cached_aws_credentials</span><span class=p>(</span><span class=n>account_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>client</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;ecs&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>region_name</span><span class=o>=</span><span class=n>region</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>aws_access_key_id</span><span class=o>=</span><span class=n>credentials</span><span class=p>[</span><span class=s2>&#34;AccessKeyId&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>aws_secret_access_key</span><span class=o>=</span><span class=n>credentials</span><span class=p>[</span><span class=s2>&#34;SecretAccessKey&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>aws_session_token</span><span class=o>=</span><span class=n>credentials</span><span class=p>[</span><span class=s2>&#34;SessionToken&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>method</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=n>action</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>method</span><span class=p>(</span><span class=o>**</span><span class=n>parameters</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>truncate_response</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=n>max_chars</span><span class=o>=</span><span class=mi>12000</span><span class=p>)</span>
</span></span></code></pre></div><p>There are specialized tools for ECS, CloudWatch, Lambda, RDS, S3, ElastiCache, ELB, API Gateway, Route53, Step Functions, networking (VPCs, subnets, security groups), and a generic <code>aws</code> tool that can call any AWS service.</p><h3 id=gitlab-tools>GitLab Tools<a href=#gitlab-tools class=hanchor arialabel=Anchor>#</a></h3><p>GitLab tools go beyond simple API wrappers. The <code>gitlab_search_group</code> tool auto-paginates across results and searches at the group level (not just single repos):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@tool</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>gitlab_search_group</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>group_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>scope</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>search</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>max_pages</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>list</span><span class=p>[</span><span class=nb>dict</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Search across all repositories in a GitLab group.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Scopes: projects, issues, merge_requests, blobs (code), commits, notes
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Auto-paginates up to max_pages to collect comprehensive results.
</span></span></span><span class=line><span class=cl><span class=s2>    Useful for finding which repositories contain specific code patterns,
</span></span></span><span class=line><span class=cl><span class=s2>    configuration references, or AWS account IDs.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>page</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>page</span> <span class=o>&lt;=</span> <span class=n>max_pages</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>gitlab_api</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=sa>f</span><span class=s2>&#34;/groups/</span><span class=si>{</span><span class=n>group_id</span><span class=si>}</span><span class=s2>/search&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>params</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;scope&#34;</span><span class=p>:</span> <span class=n>scope</span><span class=p>,</span> <span class=s2>&#34;search&#34;</span><span class=p>:</span> <span class=n>search</span><span class=p>,</span> <span class=s2>&#34;page&#34;</span><span class=p>:</span> <span class=n>page</span><span class=p>,</span> <span class=s2>&#34;per_page&#34;</span><span class=p>:</span> <span class=mi>20</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>response</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>results</span><span class=o>.</span><span class=n>extend</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>page</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>results</span>
</span></span></code></pre></div><h3 id=the-repo_grep-tool>The repo_grep Tool<a href=#the-repo_grep-tool class=hanchor arialabel=Anchor>#</a></h3><p>This is one of the most powerful tools. It clones a repository locally (shallow, sparse, cached) and provides grep, find, tree, and file read operations via subprocess:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@tool</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>repo_grep</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>project_id</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>ref</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;master&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>action</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=s2>&#34;grep&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>pattern</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>path</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=kc>None</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Clone a GitLab repo locally and search its contents.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Actions:
</span></span></span><span class=line><span class=cl><span class=s2>    - grep: Search file contents for a pattern (regex supported)
</span></span></span><span class=line><span class=cl><span class=s2>    - find: Find files matching a name pattern
</span></span></span><span class=line><span class=cl><span class=s2>    - tree: Show directory structure
</span></span></span><span class=line><span class=cl><span class=s2>    - read_file: Read a specific file&#39;s contents
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Repos are cached in /tmp for the session duration.
</span></span></span><span class=line><span class=cl><span class=s2>    Shallow clones keep disk usage minimal.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>repo_dir</span> <span class=o>=</span> <span class=n>clone_or_cache</span><span class=p>(</span><span class=n>project_id</span><span class=p>,</span> <span class=n>ref</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>action</span> <span class=o>==</span> <span class=s2>&#34;grep&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=s2>&#34;grep&#34;</span><span class=p>,</span> <span class=s2>&#34;-rn&#34;</span><span class=p>,</span> <span class=s2>&#34;--include=*.py&#34;</span><span class=p>,</span> <span class=s2>&#34;--include=*.tf&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>             <span class=s2>&#34;--include=*.yml&#34;</span><span class=p>,</span> <span class=s2>&#34;--include=*.yaml&#34;</span><span class=p>,</span> <span class=s2>&#34;--include=*.json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>             <span class=n>pattern</span><span class=p>,</span> <span class=n>repo_dir</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>capture_output</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>text</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>truncate</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>stdout</span><span class=p>,</span> <span class=mi>12000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># ... other actions</span>
</span></span></code></pre></div><p>This allows the agent to do deep code analysis that isn&rsquo;t possible through GitLab&rsquo;s search API alone. It can trace function call chains, read configuration files, check Terraform variables, and find secrets that shouldn&rsquo;t be committed.</p><hr><h2 id=sub-agent-architecture>Sub-Agent Architecture<a href=#sub-agent-architecture class=hanchor arialabel=Anchor>#</a></h2><p>Complex investigations often require parallel work streams. TARS uses a sub-agent pattern where the main agent can spawn autonomous child agents that run to completion with their own tool sets:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@tool</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>gather_context</span><span class=p>(</span><span class=n>service_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Autonomously discover everything about a service.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    This sub-agent:
</span></span></span><span class=line><span class=cl><span class=s2>    1. Searches GitLab for the service repository
</span></span></span><span class=line><span class=cl><span class=s2>    2. Reads the repo structure (Dockerfile, terraform/, .gitlab-ci.yml)
</span></span></span><span class=line><span class=cl><span class=s2>    3. Extracts AWS account, region, and cluster information
</span></span></span><span class=line><span class=cl><span class=s2>    4. Returns a structured context object
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Always call this before investigating any service.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>sub_agent</span> <span class=o>=</span> <span class=n>Agent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>tools</span><span class=o>=</span><span class=p>[</span><span class=n>gitlab</span><span class=p>,</span> <span class=n>gitlab_get_file</span><span class=p>,</span> <span class=n>gitlab_list_tree</span><span class=p>,</span> <span class=n>gitlab_search_group</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>system_prompt</span><span class=o>=</span><span class=n>GATHER_CONTEXT_PROMPT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>sub_agent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;Find and analyze the service &#39;</span><span class=si>{</span><span class=n>service_name</span><span class=si>}</span><span class=s2>&#39;. &#34;</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;Return the GitLab project ID, AWS account, region, &#34;</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;cluster name, and key configuration details.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>parse_context</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@tool</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>investigate_infrastructure</span><span class=p>(</span><span class=n>context</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span> <span class=n>symptoms</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Autonomously investigate AWS infrastructure for issues.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Uses the context from gather_context() to check:
</span></span></span><span class=line><span class=cl><span class=s2>    - ECS service health, deployment status, task failures
</span></span></span><span class=line><span class=cl><span class=s2>    - ALB target health, request metrics, error rates
</span></span></span><span class=line><span class=cl><span class=s2>    - CloudWatch logs for error patterns
</span></span></span><span class=line><span class=cl><span class=s2>    - Recent configuration changes
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>sub_agent</span> <span class=o>=</span> <span class=n>Agent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>tools</span><span class=o>=</span><span class=p>[</span><span class=n>aws_ecs</span><span class=p>,</span> <span class=n>aws_cloudwatch</span><span class=p>,</span> <span class=n>aws_elb</span><span class=p>,</span> <span class=n>aws_networking</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>system_prompt</span><span class=o>=</span><span class=n>INVESTIGATE_INFRA_PROMPT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>sub_agent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;Context: </span><span class=si>{</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>context</span><span class=p>)</span><span class=si>}</span><span class=se>\n</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;Symptoms: </span><span class=si>{</span><span class=n>symptoms</span><span class=si>}</span><span class=se>\n</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;Investigate the infrastructure and report findings.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@tool</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>investigate_code</span><span class=p>(</span><span class=n>context</span><span class=p>:</span> <span class=nb>dict</span><span class=p>,</span> <span class=n>hypothesis</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Autonomously investigate code for issues.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Traces code paths, reads recent changes, checks for
</span></span></span><span class=line><span class=cl><span class=s2>    common patterns that could cause the reported symptoms.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>sub_agent</span> <span class=o>=</span> <span class=n>Agent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>tools</span><span class=o>=</span><span class=p>[</span><span class=n>gitlab_get_file</span><span class=p>,</span> <span class=n>gitlab_list_tree</span><span class=p>,</span> <span class=n>repo_grep</span><span class=p>,</span> <span class=n>gitlab_search_group</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>system_prompt</span><span class=o>=</span><span class=n>INVESTIGATE_CODE_PROMPT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>sub_agent</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;Context: </span><span class=si>{</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>context</span><span class=p>)</span><span class=si>}</span><span class=se>\n</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;Hypothesis: </span><span class=si>{</span><span class=n>hypothesis</span><span class=si>}</span><span class=se>\n</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;Investigate the code and report findings.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span></code></pre></div><p>Sub-agent progress is forwarded to the main response stream via a shared <code>asyncio.Queue</code>. The frontend renders sub-agent tool calls as nested activity items, so the user can see exactly what each sub-agent is doing in real time.</p><hr><h2 id=security-model>Security Model<a href=#security-model class=hanchor arialabel=Anchor>#</a></h2><p>An AI agent with access to 100+ AWS accounts and every GitLab repository needs serious guardrails. TARS implements security at three levels:</p><h3 id=level-1-tool-policy-classification>Level 1: Tool Policy Classification<a href=#level-1-tool-policy-classification class=hanchor arialabel=Anchor>#</a></h3><p>Every tool call is classified before execution:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>ToolPolicy</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>SAFE</span> <span class=o>=</span> <span class=s2>&#34;safe&#34;</span>       <span class=c1># Read-only operations</span>
</span></span><span class=line><span class=cl>    <span class=n>ELEVATED</span> <span class=o>=</span> <span class=s2>&#34;elevated&#34;</span>  <span class=c1># Write operations (require confirmation)</span>
</span></span><span class=line><span class=cl>    <span class=n>BLOCKED</span> <span class=o>=</span> <span class=s2>&#34;blocked&#34;</span>    <span class=c1># Destructive operations (never allowed)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>classify</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tool_name</span><span class=p>,</span> <span class=n>parameters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># All AWS write operations are blocked</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>tool_name</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;aws_&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>action</span> <span class=o>=</span> <span class=n>parameters</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;action&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>action</span><span class=o>.</span><span class=n>startswith</span><span class=p>((</span><span class=s2>&#34;create_&#34;</span><span class=p>,</span> <span class=s2>&#34;delete_&#34;</span><span class=p>,</span> <span class=s2>&#34;update_&#34;</span><span class=p>,</span> <span class=s2>&#34;put_&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                  <span class=s2>&#34;modify_&#34;</span><span class=p>,</span> <span class=s2>&#34;remove_&#34;</span><span class=p>,</span> <span class=s2>&#34;terminate_&#34;</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>BLOCKED</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># GitLab writes are elevated (branch-safe only)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>tool_name</span> <span class=ow>in</span> <span class=p>(</span><span class=s2>&#34;gitlab_commit_file&#34;</span><span class=p>,</span> <span class=s2>&#34;gitlab_create_branch&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                         <span class=s2>&#34;gitlab_create_merge_request&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>ELEVATED</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># GitLab generic tool blocks non-GET methods</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>tool_name</span> <span class=o>==</span> <span class=s2>&#34;gitlab&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>parameters</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;method&#34;</span><span class=p>,</span> <span class=s2>&#34;GET&#34;</span><span class=p>)</span> <span class=o>!=</span> <span class=s2>&#34;GET&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>BLOCKED</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>SAFE</span>
</span></span></code></pre></div><h3 id=level-2-branch-protection>Level 2: Branch Protection<a href=#level-2-branch-protection class=hanchor arialabel=Anchor>#</a></h3><p>GitLab write tools enforce branch safety:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@tool</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>gitlab_commit_file</span><span class=p>(</span><span class=n>project_id</span><span class=p>,</span> <span class=n>branch</span><span class=p>,</span> <span class=n>file_path</span><span class=p>,</span> <span class=n>content</span><span class=p>,</span> <span class=n>commit_message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Commit a file to a GitLab repository.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    SAFETY: Commits to main/master are rejected.
</span></span></span><span class=line><span class=cl><span class=s2>    Only feature branches are allowed.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>branch</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=ow>in</span> <span class=p>(</span><span class=s2>&#34;main&#34;</span><span class=p>,</span> <span class=s2>&#34;master&#34;</span><span class=p>,</span> <span class=s2>&#34;release&#34;</span><span class=p>,</span> <span class=s2>&#34;pre-release&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;Direct commits to &#39;</span><span class=si>{</span><span class=n>branch</span><span class=si>}</span><span class=s2>&#39; are blocked. &#34;</span>
</span></span><span class=line><span class=cl>                         <span class=sa>f</span><span class=s2>&#34;Create a feature branch first.&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># ... proceed with commit</span>
</span></span></code></pre></div><h3 id=level-3-network-safety>Level 3: Network Safety<a href=#level-3-network-safety class=hanchor arialabel=Anchor>#</a></h3><p>The HTTP tool includes SSRF protection:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>validate_url</span><span class=p>(</span><span class=n>url</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Prevent SSRF by blocking requests to private IP ranges.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>parsed</span> <span class=o>=</span> <span class=n>urlparse</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ip</span> <span class=o>=</span> <span class=n>socket</span><span class=o>.</span><span class=n>gethostbyname</span><span class=p>(</span><span class=n>parsed</span><span class=o>.</span><span class=n>hostname</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>private_ranges</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=n>ipaddress</span><span class=o>.</span><span class=n>ip_network</span><span class=p>(</span><span class=s2>&#34;10.0.0.0/8&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>ipaddress</span><span class=o>.</span><span class=n>ip_network</span><span class=p>(</span><span class=s2>&#34;172.16.0.0/12&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>ipaddress</span><span class=o>.</span><span class=n>ip_network</span><span class=p>(</span><span class=s2>&#34;192.168.0.0/16&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=n>ipaddress</span><span class=o>.</span><span class=n>ip_network</span><span class=p>(</span><span class=s2>&#34;169.254.0.0/16&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>addr</span> <span class=o>=</span> <span class=n>ipaddress</span><span class=o>.</span><span class=n>ip_address</span><span class=p>(</span><span class=n>ip</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>network</span> <span class=ow>in</span> <span class=n>private_ranges</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>addr</span> <span class=ow>in</span> <span class=n>network</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=n>SecurityError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Requests to private IP </span><span class=si>{</span><span class=n>ip</span><span class=si>}</span><span class=s2> are blocked&#34;</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=level-4-output-sanitization>Level 4: Output Sanitization<a href=#level-4-output-sanitization class=hanchor arialabel=Anchor>#</a></h3><p>Tool output is truncated to 12,000 characters to prevent context overflow attacks where a malicious response could fill the context window with adversarial content. Secret values detected in tool output are redacted before being shown to the user.</p><hr><h2 id=streaming-infrastructure>Streaming Infrastructure<a href=#streaming-infrastructure class=hanchor arialabel=Anchor>#</a></h2><p>Real-time streaming is essential for an investigation agent. Investigations can take 30-60 seconds as the agent makes multiple tool calls. Without streaming, the user would stare at a loading spinner with no visibility into what&rsquo;s happening.</p><p>TARS uses Server-Sent Events (SSE) with Django&rsquo;s async <code>StreamingHttpResponse</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>ChatStreamView</span><span class=p>(</span><span class=n>APIView</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>async</span> <span class=k>def</span> <span class=nf>post</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>request</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>message</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;message&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>session_id</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;session_id&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>agent</span> <span class=o>=</span> <span class=n>build_agent</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>user</span><span class=p>,</span> <span class=n>request</span><span class=o>.</span><span class=n>user_settings</span><span class=p>,</span> <span class=n>session_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>async</span> <span class=k>def</span> <span class=nf>event_stream</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=n>queue</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>Queue</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># Run agent in background task</span>
</span></span><span class=line><span class=cl>            <span class=n>task</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>create_task</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>run_agent</span><span class=p>(</span><span class=n>agent</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>queue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>event</span> <span class=o>=</span> <span class=k>await</span> <span class=n>queue</span><span class=o>.</span><span class=n>get</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;done&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>yield</span> <span class=n>format_sse</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;text_delta&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>yield</span> <span class=n>format_sse</span><span class=p>(</span><span class=n>event</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;tool_start&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>yield</span> <span class=n>format_sse</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;tool_start&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;tool&#34;</span><span class=p>:</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;tool_name&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;input&#34;</span><span class=p>:</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;input_params&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;tool_end&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>yield</span> <span class=n>format_sse</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;tool_end&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;tool&#34;</span><span class=p>:</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;tool_name&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;output&#34;</span><span class=p>:</span> <span class=n>truncate</span><span class=p>(</span><span class=n>event</span><span class=p>[</span><span class=s2>&#34;output&#34;</span><span class=p>],</span> <span class=mi>500</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;type&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;reasoning&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>yield</span> <span class=n>format_sse</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;reasoning&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;text&#34;</span><span class=p>:</span> <span class=n>event</span><span class=p>[</span><span class=s2>&#34;text&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>await</span> <span class=n>task</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>StreamingHttpResponse</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>event_stream</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>content_type</span><span class=o>=</span><span class=s2>&#34;text/event-stream&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span><span class=p>[</span><span class=s2>&#34;Cache-Control&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;no-cache&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span><span class=p>[</span><span class=s2>&#34;X-Accel-Buffering&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;no&#34;</span>  <span class=c1># Disable Nginx buffering</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>response</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>format_sse</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=sa>f</span><span class=s2>&#34;data: </span><span class=si>{</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=si>}</span><span class=se>\n\n</span><span class=s2>&#34;</span>
</span></span></code></pre></div><p>The <code>X-Accel-Buffering: no</code> header is critical. Without it, Nginx buffers the SSE stream and delivers it in chunks, destroying the real-time experience. The ALB is configured with sticky sessions (1-hour cookie) to ensure SSE connections aren&rsquo;t load-balanced mid-stream.</p><hr><h2 id=the-frontend>The Frontend<a href=#the-frontend class=hanchor arialabel=Anchor>#</a></h2><p>The frontend is built with React 19 and follows a feature-based architecture:</p><pre tabindex=0><code>src/
  features/
    auth/       # OAuth2 PKCE, session management
    chat/       # Chat UI, SSE streaming, sessions
    kpi/        # Developer productivity dashboard
    memory/     # Agent memory viewer/manager
    admin/      # User management, system settings
    common/     # Layout, sidebar, shared components
</code></pre><h3 id=the-usechat-hook>The useChat Hook<a href=#the-usechat-hook class=hanchor arialabel=Anchor>#</a></h3><p>The core of the chat feature is a custom React hook that manages the SSE connection, parses streaming events, and tracks tool invocations including nested sub-agent calls:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>useChat() {</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>messages</span><span class=p>,</span> <span class=nx>setMessages</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>&lt;</span><span class=nt>Message</span><span class=err>[]</span><span class=p>&gt;([]);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>isStreaming</span><span class=p>,</span> <span class=nx>setIsStreaming</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>activeTools</span><span class=p>,</span> <span class=nx>setActiveTools</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>&lt;</span><span class=nt>ToolCall</span><span class=err>[]</span><span class=p>&gt;([]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>sendMessage</span> <span class=o>=</span> <span class=nx>useCallback</span><span class=p>(</span><span class=kr>async</span> <span class=p>(</span><span class=nx>content</span>: <span class=kt>string</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setIsStreaming</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=s2>&#34;/api/chat/stream&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>method</span><span class=o>:</span> <span class=s2>&#34;POST&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span> <span class=s2>&#34;Content-Type&#34;</span><span class=o>:</span> <span class=s2>&#34;application/json&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>body</span>: <span class=kt>JSON.stringify</span><span class=p>({</span> <span class=nx>message</span>: <span class=kt>content</span><span class=p>,</span> <span class=nx>session_id</span>: <span class=kt>sessionId</span> <span class=p>}),</span>
</span></span><span class=line><span class=cl>      <span class=nx>credentials</span><span class=o>:</span> <span class=s2>&#34;include&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>reader</span> <span class=o>=</span> <span class=nx>response</span><span class=p>.</span><span class=nx>body</span><span class=o>!</span><span class=p>.</span><span class=nx>getReader</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>decoder</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>TextDecoder</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>buffer</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=kc>true</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=p>{</span> <span class=nx>done</span><span class=p>,</span> <span class=nx>value</span> <span class=p>}</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>reader</span><span class=p>.</span><span class=nx>read</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>done</span><span class=p>)</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>buffer</span> <span class=o>+=</span> <span class=nx>decoder</span><span class=p>.</span><span class=nx>decode</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=p>{</span> <span class=nx>stream</span>: <span class=kt>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>lines</span> <span class=o>=</span> <span class=nx>buffer</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34;\n\n&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>buffer</span> <span class=o>=</span> <span class=nx>lines</span><span class=p>.</span><span class=nx>pop</span><span class=p>()</span> <span class=o>||</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>line</span> <span class=k>of</span> <span class=nx>lines</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>line</span><span class=p>.</span><span class=nx>startsWith</span><span class=p>(</span><span class=s2>&#34;data: &#34;</span><span class=p>))</span> <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kr>const</span> <span class=nx>event</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>line</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>6</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=kr>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=k>case</span> <span class=s2>&#34;text_delta&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>appendToCurrentMessage</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>text</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=k>case</span> <span class=s2>&#34;tool_start&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>addActiveToolCall</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=k>case</span> <span class=s2>&#34;tool_end&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>resolveToolCall</span><span class=p>(</span><span class=nx>event</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=k>case</span> <span class=s2>&#34;reasoning&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=nx>setReasoningText</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>text</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>setIsStreaming</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=p>[</span><span class=nx>sessionId</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>{</span> <span class=nx>messages</span><span class=p>,</span> <span class=nx>sendMessage</span><span class=p>,</span> <span class=nx>isStreaming</span><span class=p>,</span> <span class=nx>activeTools</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=design-language>Design Language<a href=#design-language class=hanchor arialabel=Anchor>#</a></h3><p>The UI uses a dark theme with glass morphism effects, consistent with modern developer tools:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=p>.</span><span class=nc>glass</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>background</span><span class=p>:</span> <span class=nb>rgba</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mf>0.05</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>backdrop-filter</span><span class=p>:</span> <span class=nb>blur</span><span class=p>(</span><span class=mi>12</span><span class=kt>px</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>border</span><span class=p>:</span> <span class=mi>1</span><span class=kt>px</span> <span class=kc>solid</span> <span class=nb>rgba</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The deep purple/navy gradient background, subtle transparency, and smooth Framer Motion transitions create a polished, professional interface that engineers enjoy using. The login screen (shown at the top of this article) sets the tone immediately.</p><h3 id=activity-sidebar>Activity Sidebar<a href=#activity-sidebar class=hanchor arialabel=Anchor>#</a></h3><p>During streaming, an activity sidebar shows every tool invocation in real time:</p><pre tabindex=0><code>&gt; Gathering context for &#34;payment-service&#34;...
  &gt; gitlab_search_group: searching for payment-service
  &gt; gitlab_list_tree: reading repository structure
  &gt; gitlab_get_file: reading terraform/locals.tf

&gt; Investigating infrastructure...
  &gt; aws_ecs: describe_services on cluster payments-qual
  &gt; aws_cloudwatch: get_log_events for /ecs/payment-service
  &gt; aws_elb: describe_target_health for payment-tg
</code></pre><p>Sub-agent tool calls are nested under their parent, making the investigation flow transparent to the user.</p><hr><h2 id=kpi-dashboard>KPI Dashboard<a href=#kpi-dashboard class=hanchor arialabel=Anchor>#</a></h2><p>Beyond SRE investigation, TARS includes a developer productivity dashboard that computes metrics from GitLab data:</p><ul><li><strong>Commit frequency</strong> by day/week/month</li><li><strong>Code volume</strong> (lines added/removed)</li><li><strong>MR activity</strong> (opened, merged, review time)</li><li><strong>Review metrics</strong> (comments given/received)</li><li><strong>Repository engagement</strong> (contribution distribution)</li></ul><p>The caching strategy is multi-layered to minimize GitLab API calls:</p><ol><li><strong>Raw GitLab data</strong>: 15-minute Redis cache</li><li><strong>Computed dashboard metrics</strong>: 1-hour Redis cache</li><li><strong>PostgreSQL snapshots</strong>: 4-hour persistent cache</li></ol><p>Data is fetched in fixed time buckets (15, 31, 91 days) regardless of what the user requests. If a user asks for &ldquo;last 7 days&rdquo; of data, the system fetches the 15-day bucket and filters client-side. This maximizes cache hit rates because different users requesting different time ranges all hit the same cached bucket.</p><hr><h2 id=memory-and-context-management>Memory and Context Management<a href=#memory-and-context-management class=hanchor arialabel=Anchor>#</a></h2><p>TARS uses AWS Bedrock AgentCore for persistent memory across sessions. Three memory strategies are active:</p><ol><li><strong>User Preferences</strong>: How the user likes responses formatted, which accounts they frequently investigate, preferred output verbosity</li><li><strong>Semantic Facts</strong>: Discovered facts about the infrastructure (e.g., &ldquo;payment-service runs on cluster X in account Y&rdquo;)</li><li><strong>Session Summaries</strong>: Compressed summaries of past conversations for continuity</li></ol><p>The conversation manager uses a sliding window of 40 messages. When the window fills, older messages are summarized and stored in the summaries namespace. This means the agent can reference context from days-old conversations without consuming the full context window.</p><p>Users can view and manage their memory records through a dedicated Memory page, with ownership verification preventing cross-user data access.</p><hr><h2 id=database-design>Database Design<a href=#database-design class=hanchor arialabel=Anchor>#</a></h2><p>The schema is intentionally minimal:</p><pre tabindex=0><code>User (UUID pk)
  â”œâ”€â”€ entra_id (unique, Entra ID SSO link)
  â”œâ”€â”€ display_name
  â””â”€â”€ role (user/admin)

UserSettings (one-to-one with User)
  â”œâ”€â”€ keycloak_username / keycloak_password (encrypted)
  â”œâ”€â”€ gitlab_token (encrypted) / gitlab_base_url
  â”œâ”€â”€ corpgen_username / corpgen_password (encrypted)
  â””â”€â”€ aws_otp_secret (encrypted)

UserSession (token pk)
  â”œâ”€â”€ user (FK)
  â””â”€â”€ expires_at (sliding window)

ChatSession
  â”œâ”€â”€ user (FK)
  â”œâ”€â”€ title (auto-generated)
  â””â”€â”€ output_mode (brief/standard/detailed)

Message
  â”œâ”€â”€ session (FK)
  â”œâ”€â”€ role (user/assistant/system)
  â”œâ”€â”€ content (text)
  â””â”€â”€ metrics (JSON: duration, tokens)

ToolInvocation
  â”œâ”€â”€ message (FK)
  â”œâ”€â”€ tool_name, input_params, output, status
  â””â”€â”€ timing (started_at, completed_at)

ChatShare
  â”œâ”€â”€ session (FK)
  â”œâ”€â”€ token (unique, time-limited)
  â””â”€â”€ message_count_snapshot

DeveloperKPISnapshot
  â”œâ”€â”€ user (FK)
  â”œâ”€â”€ period, granularity
  â”œâ”€â”€ metrics (JSON)
  â””â”€â”€ expires_at (4-hour TTL)
</code></pre><p>All sensitive fields use <code>EncryptedCharField</code>. KPI snapshots auto-expire after 4 hours. Chat shares have a 30-day TTL.</p><hr><h2 id=deployment>Deployment<a href=#deployment class=hanchor arialabel=Anchor>#</a></h2><p>TARS deploys to ECS Fargate with Terraform:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-hcl data-lang=hcl><span class=line><span class=cl><span class=k>resource</span> <span class=s2>&#34;aws_ecs_service&#34; &#34;tars&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  name</span>            <span class=o>=</span> <span class=s2>&#34;tars&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  cluster</span>         <span class=o>=</span> <span class=k>aws_ecs_cluster</span><span class=p>.</span><span class=k>tars</span><span class=p>.</span><span class=k>id</span>
</span></span><span class=line><span class=cl><span class=n>  task_definition</span> <span class=o>=</span> <span class=k>aws_ecs_task_definition</span><span class=p>.</span><span class=k>tars</span><span class=p>.</span><span class=k>arn</span>
</span></span><span class=line><span class=cl><span class=n>  desired_count</span>   <span class=o>=</span> <span class=m>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>capacity_provider_strategy</span> {
</span></span><span class=line><span class=cl><span class=n>    capacity_provider</span> <span class=o>=</span> <span class=s2>&#34;FARGATE_SPOT&#34;</span>
</span></span><span class=line><span class=cl><span class=n>    weight</span>            <span class=o>=</span> <span class=m>100</span>
</span></span><span class=line><span class=cl><span class=n>    base</span>              <span class=o>=</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>capacity_provider_strategy</span> {
</span></span><span class=line><span class=cl><span class=n>    capacity_provider</span> <span class=o>=</span> <span class=s2>&#34;FARGATE&#34;</span>
</span></span><span class=line><span class=cl><span class=n>    weight</span>            <span class=o>=</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>deployment_circuit_breaker</span> {
</span></span><span class=line><span class=cl><span class=n>    enable</span>   <span class=o>=</span> <span class=kt>true</span>
</span></span><span class=line><span class=cl><span class=n>    rollback</span> <span class=o>=</span> <span class=kt>true</span>
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>resource</span> <span class=s2>&#34;aws_ecs_task_definition&#34; &#34;tars&#34;</span> {
</span></span><span class=line><span class=cl><span class=n>  family</span>                   <span class=o>=</span> <span class=s2>&#34;tars&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  requires_compatibilities</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;FARGATE&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>  network_mode</span>             <span class=o>=</span> <span class=s2>&#34;awsvpc&#34;</span>
</span></span><span class=line><span class=cl><span class=n>  cpu</span>                      <span class=o>=</span> <span class=m>1024</span><span class=c1>   # 1 vCPU
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>  memory</span>                   <span class=o>=</span> <span class=m>2048</span><span class=c1>   # 2 GB
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>runtime_platform</span> {
</span></span><span class=line><span class=cl><span class=n>    operating_system_family</span> <span class=o>=</span> <span class=s2>&#34;LINUX&#34;</span>
</span></span><span class=line><span class=cl><span class=n>    cpu_architecture</span>        <span class=o>=</span> <span class=s2>&#34;ARM64&#34;</span>
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>  container_definitions</span> <span class=o>=</span> <span class=k>jsonencode</span><span class=p>([</span>{
</span></span><span class=line><span class=cl><span class=n>    name</span>  <span class=o>=</span> <span class=s2>&#34;tars&#34;</span>
</span></span><span class=line><span class=cl><span class=n>    image</span> <span class=o>=</span> <span class=s2>&#34;${aws_ecr_repository.tars.repository_url}:latest&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>    portMappings</span> <span class=o>=</span> <span class=p>[</span>{
</span></span><span class=line><span class=cl><span class=n>      containerPort</span> <span class=o>=</span> <span class=m>8080</span>
</span></span><span class=line><span class=cl><span class=n>      protocol</span>      <span class=o>=</span> <span class=s2>&#34;tcp&#34;</span>
</span></span><span class=line><span class=cl>    }<span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>    secrets</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl><span class=n>      { name</span> <span class=o>=</span><span class=n> &#34;DJANGO_SECRET_KEY&#34;, valueFrom</span> <span class=o>=</span> <span class=k>aws_secretsmanager_secret</span><span class=p>.</span><span class=k>django</span><span class=p>.</span><span class=k>arn</span> }<span class=p>,</span>
</span></span><span class=line><span class=cl><span class=n>      { name</span> <span class=o>=</span><span class=n> &#34;DATABASE_URL&#34;, valueFrom</span> <span class=o>=</span> <span class=k>aws_secretsmanager_secret</span><span class=p>.</span><span class=k>db</span><span class=p>.</span><span class=k>arn</span> }<span class=p>,</span>
</span></span><span class=line><span class=cl><span class=n>      { name</span> <span class=o>=</span><span class=n> &#34;REDIS_URL&#34;, valueFrom</span> <span class=o>=</span> <span class=k>aws_secretsmanager_secret</span><span class=p>.</span><span class=k>redis</span><span class=p>.</span><span class=k>arn</span> }<span class=p>,</span><span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1>      # ... more secrets
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  }<span class=p>])</span>
</span></span><span class=line><span class=cl>}
</span></span></code></pre></div><p>The multi-stage Dockerfile keeps the image small:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># Stage 1: Build frontend</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> node:20-alpine AS frontend</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app/frontend</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> frontend/package*.json ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm ci<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> frontend/ ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> npm run build<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Stage 2: Production</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> python:3.13-slim</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Install Python dependencies</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> backend/requirements.txt ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install --no-cache-dir -r requirements.txt<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Copy backend</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> backend/ ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Copy built frontend + Nginx config</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>frontend /app/frontend/dist /app/static/frontend<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> nginx.conf /etc/nginx/nginx.conf<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Nginx serves static + proxies to Uvicorn</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 8080</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span><span class=s2>&#34;supervisord&#34;</span><span class=p>,</span> <span class=s2>&#34;-c&#34;</span><span class=p>,</span> <span class=s2>&#34;supervisord.conf&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></div><hr><h2 id=lessons-learned>Lessons Learned<a href=#lessons-learned class=hanchor arialabel=Anchor>#</a></h2><p>After building and operating TARS, here are the patterns that proved most valuable:</p><p><strong>1. Temperature 0.0 for investigation agents.</strong> SRE investigation requires determinism. You want the agent to follow the same procedures consistently. Creative responses are a liability when debugging production.</p><p><strong>2. Sub-agents are essential for complex investigations.</strong> A single agent trying to search GitLab, read code, check AWS, and analyze logs will lose track of its investigation plan. Sub-agents with focused tool sets produce much better results.</p><p><strong>3. Streaming is not optional.</strong> Investigations take 30-60 seconds. Without real-time streaming of tool calls and reasoning, users don&rsquo;t trust the system. Seeing the agent&rsquo;s thought process builds confidence in the results.</p><p><strong>4. Tool output truncation prevents context collapse.</strong> A single CloudWatch <code>get_log_events</code> call can return megabytes of data. Without aggressive truncation (12,000 chars), the context window fills with log noise and the agent loses track of its investigation.</p><p><strong>5. Read-only by default, always.</strong> An AI agent that can modify infrastructure is a liability. TARS is read-only for AWS by design. The only write operations allowed are creating GitLab branches, committing to non-protected branches, and creating merge requests. This means the worst-case scenario is an unwanted MR, which is trivially reversible.</p><p><strong>6. Per-user credentials, never shared.</strong> Each user authenticates with their own GitLab token and AWS SAML credentials. This means every action the agent takes is auditable to the individual user. If the agent reads a file in GitLab, it shows up in that user&rsquo;s access log.</p><p><strong>7. The system prompt is the product.</strong> 80% of the agent&rsquo;s quality comes from the system prompt, not the model or the tools. Investing weeks in crafting precise behavioral constraints, investigation procedures, and output formatting rules pays off enormously.</p><p><strong>8. Cache aggressively, but at the right granularity.</strong> The KPI dashboard&rsquo;s fixed-bucket caching strategy (fetch 15/31/91 day buckets regardless of user request) improved cache hit rates from ~20% to ~85%. The key insight is that the most expensive operation (GitLab API calls) should be cached at a coarser granularity than what the user sees.</p><hr><h2 id=whats-next>What&rsquo;s Next<a href=#whats-next class=hanchor arialabel=Anchor>#</a></h2><p>The natural evolution is expanding TARS from investigation to remediation. Today it tells you what&rsquo;s wrong. Tomorrow it could:</p><ul><li>Create a hotfix branch with the correct code change</li><li>Open an MR with the fix, tagged for urgent review</li><li>Draft the incident report based on its investigation findings</li><li>Suggest runbook updates based on novel failure modes it discovers</li></ul><p>The foundation is already there. The tool policy system supports ELEVATED operations. The branch protection ensures writes are safe. The main challenge is building the right human-in-the-loop confirmation flow so the agent proposes changes but never applies them autonomously.</p><p>That&rsquo;s the endgame: an AI SRE that investigates like your best engineer, communicates like your best technical writer, and never needs to sleep.</p><hr><h2 id=references>References<a href=#references class=hanchor arialabel=Anchor>#</a></h2><ul><li><a href=https://github.com/strands-agents/sdk-python>Strands Agents SDK</a></li><li><a href=https://docs.djangoproject.com/en/5.0/topics/async/>Django Async Views</a></li><li><a href=https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events>Server-Sent Events (MDN)</a></li><li><a href=https://oauth.net/2/pkce/>PKCE OAuth2 Flow</a></li><li><a href=https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRoleWithSAML.html>AWS STS AssumeRoleWithSAML</a></li><li><a href=https://www.radix-ui.com/>Radix UI</a></li><li><a href=https://guide.elm-lang.org/architecture/>The Elm Architecture</a></li></ul></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h></span><hr></div><div class=pagination__buttons><a href=https://manuelfedele.github.io/posts/building-ai-powered-platform-operations-agent/ class="button inline next">[<span class=button__text>Building an AI-Powered Platform Operations Agent</span>] ></a></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>Â© 2026 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>