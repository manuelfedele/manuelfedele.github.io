<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>Building an AI-Powered Document Processing Pipeline on AWS &#183; Git Push and Run</title><meta name=title content="Building an AI-Powered Document Processing Pipeline on AWS &#183; Git Push and Run"><meta name=description content="Software Engineer and Cloud Architect writing about Go, Python, AWS, and AI automation."><meta name=keywords content="AWS,AI,LLM,Step Functions,Lambda,serverless,python,architecture,"><link rel=canonical href=https://manuelfedele.github.io/posts/building-ai-document-processing-pipeline-aws/><meta name=author content="Manuel Fedele"><link href=https://github.com/manuelfedele rel=me><link href=https://linkedin.com/in/manuel-fedele rel=me><meta property="og:url" content="https://manuelfedele.github.io/posts/building-ai-document-processing-pipeline-aws/"><meta property="og:site_name" content="Git Push and Run"><meta property="og:title" content="Building an AI-Powered Document Processing Pipeline on AWS"><meta property="og:description" content="Building an AI-Powered Document Processing Pipeline on AWS # Insurance companies process millions of documents every year: police reports, medical records, invoices, repair estimates. Traditionally, human operators read each document, classify it, extract the relevant fields, and enter the data into the claims system. This is slow, expensive, and error-prone.
In this post I’ll describe the architecture of a production document processing pipeline I helped build. The system ingests claim documents, extracts text using vision-based LLMs, clusters and classifies document sections, extracts structured data, and generates vector embeddings for semantic search. All of this runs on a fully serverless AWS architecture with no idle infrastructure costs."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-03T16:45:00+01:00"><meta property="article:modified_time" content="2025-12-03T16:45:00+01:00"><meta property="article:tag" content="AWS"><meta property="article:tag" content="AI"><meta property="article:tag" content="LLM"><meta property="article:tag" content="Step Functions"><meta property="article:tag" content="Lambda"><meta property="article:tag" content="Serverless"><meta name=twitter:card content="summary"><meta name=twitter:title content="Building an AI-Powered Document Processing Pipeline on AWS"><meta name=twitter:description content="Building an AI-Powered Document Processing Pipeline on AWS # Insurance companies process millions of documents every year: police reports, medical records, invoices, repair estimates. Traditionally, human operators read each document, classify it, extract the relevant fields, and enter the data into the claims system. This is slow, expensive, and error-prone.
In this post I’ll describe the architecture of a production document processing pipeline I helped build. The system ingests claim documents, extracts text using vision-based LLMs, clusters and classifies document sections, extracts structured data, and generates vector embeddings for semantic search. All of this runs on a fully serverless AWS architecture with no idle infrastructure costs."><link type=text/css rel=stylesheet href=/css/main.bundle.min.726dfbf42bcd66e35e2d7258d72fe8fe77509ff76d153e2b46cdbae9c3af9620653459f0119a72d2af4a9b4bc446652d244ad58743d0290e5d8e09e3983b98e5.css integrity="sha512-cm379CvNZuNeLXJY1y/o/ndQn/dtFT4rRs266cOvliBlNFnwEZpy0q9Km0vERmUtJErVh0PQKQ5djgnjmDuY5Q=="><script type=text/javascript src=/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.88278edec77139635e1ad294df5b32b7be9338191c5252d3f6f451ace5852d5f82390cccacedab9c64739d8e068b7e8502895cf8f951060c0368f9a73709fcb7.js integrity="sha512-iCeO3sdxOWNeGtKU31syt76TOBkcUlLT9vRRrOWFLV+COQzMrO2rnGRznY4Gi36FAolc+PlRBgwDaPmnNwn8tw==" data-copy=Copy data-copied=Copied></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Building an AI-Powered Document Processing Pipeline on AWS","headline":"Building an AI-Powered Document Processing Pipeline on AWS","inLanguage":"en","url":"https://manuelfedele.github.io/posts/building-ai-document-processing-pipeline-aws/","author":{"@type":"Person","name":"Manuel Fedele"},"copyrightYear":"2025","dateCreated":"2025-12-03T16:45:00\u002b01:00","datePublished":"2025-12-03T16:45:00\u002b01:00","dateModified":"2025-12-03T16:45:00\u002b01:00","keywords":["AWS","AI","LLM","Step Functions","Lambda","serverless","python","architecture"],"mainEntityOfPage":"true","wordCount":"2135"}]</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-K9P1DJX238"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-K9P1DJX238")</script></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral bf-scrollbar"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 z-100"><div id=menu-blur class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl bg-neutral/25 dark:bg-neutral-800/25"></div><div class="relative m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32"><div class="main-menu flex items-center w-full gap-2 p-1 pl-0"><a href=/ class="text-base font-medium truncate min-w-0 shrink">Git Push and Run</a><div class="flex items-center ms-auto"><div class="hidden md:flex"><nav class="flex items-center gap-x-5 h-12"><a href=/posts/ class="flex items-center bf-icon-color-hover" aria-label=Blog title=Posts><span class="text-base font-medium break-normal">Blog
</span></a><a href=/about/ class="flex items-center bf-icon-color-hover" aria-label=About title=About><span class="text-base font-medium break-normal">About
</span></a><a href=https://github.com/manuelfedele target=_blank class="flex items-center bf-icon-color-hover" aria-label=github title><span><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><button id=search-button aria-label=Search class="text-base bf-icon-color-hover" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></nav></div><div class="flex md:hidden"><div class="flex items-center h-14 gap-4"><button id=search-button-mobile aria-label=Search class="flex items-center justify-center bf-icon-color-hover" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<input type=checkbox id=mobile-menu-toggle autocomplete=off class="hidden peer">
<label for=mobile-menu-toggle class="flex items-center justify-center cursor-pointer bf-icon-color-hover"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></label><div role=dialog aria-modal=true style=scrollbar-gutter:stable class="fixed inset-0 z-50 invisible overflow-y-auto px-6 py-20 opacity-0 transition-[opacity,visibility] duration-300 peer-checked:visible peer-checked:opacity-100 bg-neutral-50/97 dark:bg-neutral-900/99
bf-scrollbar"><label for=mobile-menu-toggle class="fixed end-8 top-5 flex items-center justify-center z-50 h-12 w-12 cursor-pointer select-none rounded-full bf-icon-color-hover border bf-border-color bf-border-color-hover bg-neutral-50 dark:bg-neutral-900"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></label><nav class="mx-auto max-w-md space-y-6"><div class=px-2><a href=/posts/ aria-label=Blog class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Posts class="text-2xl font-bold tracking-tight">Blog</span></a></div><div class=px-2><a href=/about/ aria-label=About class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=About class="text-2xl font-bold tracking-tight">About</span></a></div><div class=px-2><a href=https://github.com/manuelfedele aria-label=github target=_blank class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span class="flex items-center justify-center h-8 w-8 text-2xl"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span><span title class="text-2xl font-bold tracking-tight"></span></a></div></nav></div></div></div></div></div><script>(function(){var t,n,e=document.querySelector(".main-menu");if(!e)return;t=window.location.pathname,n=e.querySelectorAll('a[href="'+t+'"]'),n.forEach(function(e){var t=e.querySelectorAll("span");t.forEach(function(e){e.classList.add("active")})})})()</script></div></div><script type=text/javascript src=/js/background-blur.min.00a57c73ea12f2cab2980c3c3d649e89f6d82f190f74bbe2b67f2f5e39ab7d032ece47086400ca05396758aace13299da49aca43ea643d2625e62c506267a169.js integrity="sha512-AKV8c+oS8sqymAw8PWSeifbYLxkPdLvitn8vXjmrfQMuzkcIZADKBTlnWKrOEymdpJrKQ+pkPSYl5ixQYmehaQ==" data-blur-id=menu-blur></script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Building an AI-Powered Document Processing Pipeline on AWS</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2025-12-03T16:45:00+01:00>3 December 2025</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">11 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/tags/aws/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">AWS
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/ai/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">AI
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/llm/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">LLM
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/step-functions/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Step Functions
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/lambda/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Lambda
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/serverless/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Serverless
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/python/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Python
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/architecture/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Architecture</span></span></a></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ms-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs"><div class="toc ps-5 print:hidden lg:sticky lg:top-[140px]"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain bf-scrollbar rounded-lg -ms-5 ps-5 pe-2 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#the-problem-space>The Problem Space</a></li><li><a href=#architecture-overview>Architecture Overview</a></li><li><a href=#the-ingestion-flow>The Ingestion Flow</a></li><li><a href=#the-step-functions-pipeline>The Step Functions Pipeline</a><ul><li><a href=#linear-phase-parse-and-extract-text>Linear Phase: Parse and Extract Text</a></li><li><a href=#upper-branch-embedding-pipeline>Upper Branch: Embedding Pipeline</a></li><li><a href=#lower-branch-classification-and-extraction-pipeline>Lower Branch: Classification and Extraction Pipeline</a></li></ul></li><li><a href=#the-multi-model-llm-strategy>The Multi-Model LLM Strategy</a></li><li><a href=#concurrency-and-error-handling>Concurrency and Error Handling</a></li><li><a href=#the-claims-service>The Claims Service</a></li><li><a href=#performance-and-cost>Performance and Cost</a></li><li><a href=#lessons-learned>Lessons Learned</a></li><li><a href=#whats-next>What&rsquo;s Next</a></li><li><a href=#references>References</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#the-problem-space>The Problem Space</a></li><li><a href=#architecture-overview>Architecture Overview</a></li><li><a href=#the-ingestion-flow>The Ingestion Flow</a></li><li><a href=#the-step-functions-pipeline>The Step Functions Pipeline</a><ul><li><a href=#linear-phase-parse-and-extract-text>Linear Phase: Parse and Extract Text</a></li><li><a href=#upper-branch-embedding-pipeline>Upper Branch: Embedding Pipeline</a></li><li><a href=#lower-branch-classification-and-extraction-pipeline>Lower Branch: Classification and Extraction Pipeline</a></li></ul></li><li><a href=#the-multi-model-llm-strategy>The Multi-Model LLM Strategy</a></li><li><a href=#concurrency-and-error-handling>Concurrency and Error Handling</a></li><li><a href=#the-claims-service>The Claims Service</a></li><li><a href=#performance-and-cost>Performance and Cost</a></li><li><a href=#lessons-learned>Lessons Learned</a></li><li><a href=#whats-next>What&rsquo;s Next</a></li><li><a href=#references>References</a></li></ul></nav></div></details><script>(function(){"use strict";const s=.33,o="#TableOfContents",i=".anchor",a='a[href^="#"]',r="li ul",c="active";let t=!1;function l(e,n){const o=window.scrollY+window.innerHeight*n,i=[...document.querySelectorAll('#TableOfContents a[href^="#"]')],s=new Set(i.map(e=>e.getAttribute("href").substring(1)));if(t)for(let t=0;t<e.length;t++){const n=e[t];if(!s.has(n.id))continue;const o=n.getBoundingClientRect().top+window.scrollY;if(Math.abs(window.scrollY-o)<100)return n.id}for(let t=e.length-1;t>=0;t--){const n=e[t].getBoundingClientRect().top+window.scrollY;if(n<=o&&s.has(e[t].id))return e[t].id}return e.find(e=>s.has(e.id))?.id||""}function e({toc:e,anchors:t,links:n,scrollOffset:s,collapseInactive:o}){const i=l(t,s);if(!i)return;if(n.forEach(e=>{const t=e.getAttribute("href")===`#${i}`;if(e.classList.toggle(c,t),o){const n=e.closest("li")?.querySelector("ul");n&&(n.style.display=t?"":"none")}}),o){const n=e.querySelector(`a[href="#${CSS.escape(i)}"]`);let t=n;for(;t&&t!==e;)t.tagName==="UL"&&(t.style.display=""),t.tagName==="LI"&&t.querySelector("ul")?.style.setProperty("display",""),t=t.parentElement}}function n(){const n=document.querySelector(o);if(!n)return;const l=!0,u=[...document.querySelectorAll(i)],d=[...n.querySelectorAll(a)];l&&n.querySelectorAll(r).forEach(e=>e.style.display="none"),d.forEach(e=>{e.addEventListener("click",()=>{t=!0})});const c={toc:n,anchors:u,links:d,scrollOffset:s,collapseInactive:l};window.addEventListener("scroll",()=>e(c),{passive:!0}),window.addEventListener("hashchange",()=>e(c),{passive:!0}),e(c)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n()})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><h1 class="relative group">Building an AI-Powered Document Processing Pipeline on AWS<div id=building-an-ai-powered-document-processing-pipeline-on-aws class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#building-an-ai-powered-document-processing-pipeline-on-aws aria-label=Anchor>#</a></span></h1><p>Insurance companies process millions of documents every year: police reports, medical records, invoices, repair estimates. Traditionally, human operators read each document, classify it, extract the relevant fields, and enter the data into the claims system. This is slow, expensive, and error-prone.</p><p>In this post I&rsquo;ll describe the architecture of a production document processing pipeline I helped build. The system ingests claim documents, extracts text using vision-based LLMs, clusters and classifies document sections, extracts structured data, and generates vector embeddings for semantic search. All of this runs on a fully serverless AWS architecture with no idle infrastructure costs.</p><h2 class="relative group">The Problem Space<div id=the-problem-space class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#the-problem-space aria-label=Anchor>#</a></span></h2><p>A typical insurance claim arrives as a ZIP archive containing multiple documents: a police report, medical certificates, repair estimates, photos, correspondence. Each document needs to be:</p><ol><li><strong>Parsed</strong> into machine-readable text (many are scanned PDFs or photos)</li><li><strong>Classified</strong> by type (police report, medical report, invoice, etc.)</li><li><strong>Structured</strong> by extracting specific fields per document type (e.g., license plate from a police report, diagnosis code from a medical report)</li><li><strong>Indexed</strong> for semantic search so case managers can query across all documents in natural language</li><li><strong>Summarized</strong> so the case manager gets an overview without reading every page</li></ol><p>The system needs to handle multiple lines of business (motor, health, accident), support concurrent processing of hundreds of claims, and recover gracefully from LLM failures.</p><h2 class="relative group">Architecture Overview<div id=architecture-overview class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#architecture-overview aria-label=Anchor>#</a></span></h2><p>The architecture follows an event-driven, fully serverless pattern:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>ZIP Upload → S3 → EventBridge → Step Functions → [Lambda Pipeline] → DynamoDB + Aurora
</span></span><span style=display:flex><span>                                                                          ↓
</span></span><span style=display:flex><span>                                              Claims Service (ECS) ← ALB ← Users</span></span></code></pre></div></div><p>The key components:</p><ul><li><strong>S3 Ingestion Bucket</strong>: receives ZIP uploads via presigned URLs</li><li><strong>EventBridge Rule</strong>: triggers the processing pipeline when a file lands</li><li><strong>Step Functions</strong>: orchestrates the multi-stage processing workflow</li><li><strong>Lambda Functions</strong>: execute each processing stage (stateless, parallel)</li><li><strong>DynamoDB</strong>: tracks processing state and stores extraction results</li><li><strong>Aurora PostgreSQL</strong>: stores vector embeddings for RAG</li><li><strong>ECS Service (Django)</strong>: serves the web UI and API for case managers</li><li><strong>Keycloak + Entra ID</strong>: authentication and group-based access control</li></ul><h2 class="relative group">The Ingestion Flow<div id=the-ingestion-flow class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#the-ingestion-flow aria-label=Anchor>#</a></span></h2><p>Documents enter the system through a secure upload flow:</p><ol><li>The external claims management system calls our API to register a claim (line of business, permissions, metadata)</li><li>It requests a presigned S3 URL from a lightweight Lambda function</li><li>It uploads the ZIP archive directly to S3 using the presigned URL</li><li>An EventBridge rule detects the new object and triggers the Step Functions workflow</li></ol><p>The presigned URL approach avoids routing large files through our API. The Lambda generates short-lived URLs (10-60 seconds), so the upload window is narrow enough to prevent misuse.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>import</span> boto3
</span></span><span style=display:flex><span><span style=color:#ff79c6>from</span> datetime <span style=color:#ff79c6>import</span> datetime
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>handler</span>(event, context):
</span></span><span style=display:flex><span>    s3 <span style=color:#ff79c6>=</span> boto3<span style=color:#ff79c6>.</span>client(<span style=color:#f1fa8c>&#34;s3&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    claim_name <span style=color:#ff79c6>=</span> event[<span style=color:#f1fa8c>&#34;claim_name&#34;</span>]
</span></span><span style=display:flex><span>    document_code <span style=color:#ff79c6>=</span> event[<span style=color:#f1fa8c>&#34;document_code&#34;</span>]
</span></span><span style=display:flex><span>    key <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;landing/</span><span style=color:#f1fa8c>{</span>claim_name<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>#</span><span style=color:#f1fa8c>{</span>document_code<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>.zip&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    url <span style=color:#ff79c6>=</span> s3<span style=color:#ff79c6>.</span>generate_presigned_url(
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;put_object&#34;</span>,
</span></span><span style=display:flex><span>        Params<span style=color:#ff79c6>=</span>{
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;Bucket&#34;</span>: INGESTION_BUCKET,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;Key&#34;</span>: key,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;ContentType&#34;</span>: <span style=color:#f1fa8c>&#34;application/zip&#34;</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        ExpiresIn<span style=color:#ff79c6>=</span><span style=color:#bd93f9>60</span>,
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> {<span style=color:#f1fa8c>&#34;upload_url&#34;</span>: url, <span style=color:#f1fa8c>&#34;key&#34;</span>: key}</span></span></code></pre></div></div><p>Processing runs in periodic batches (every 10 minutes) rather than on each individual upload. This is a deliberate tradeoff: we accept a few minutes of latency in exchange for better throughput management and cost control when handling bursts of uploads.</p><h2 class="relative group">The Step Functions Pipeline<div id=the-step-functions-pipeline class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#the-step-functions-pipeline aria-label=Anchor>#</a></span></h2><p>The core of the system is an AWS Step Functions state machine that orchestrates document processing through a linear phase followed by two parallel branches.</p><h3 class="relative group">Linear Phase: Parse and Extract Text<div id=linear-phase-parse-and-extract-text class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#linear-phase-parse-and-extract-text aria-label=Anchor>#</a></span></h3><p><strong>Stage 1: Start (claim-level)</strong></p><p>The first Lambda validates the uploaded ZIP, extracts files, uploads individual documents to a support bucket, and creates tracking records in DynamoDB. It also deduplicates: if a document with the same name already exists in the claim and is being processed, it&rsquo;s skipped.</p><p><strong>Stage 2: Split (document-level)</strong></p><p>Each document is converted to PDF (if it&rsquo;s a DOCX), then split into individual pages saved as PNG images. We use an internal PDF splitting service for this, which handles edge cases like encrypted PDFs, malformed page trees, and oversized documents.</p><p><strong>Stage 3: Parse (page-level)</strong></p><p>This is where the AI kicks in. Each page image is sent to <strong>Claude 3.5 Sonnet</strong> (via Amazon Bedrock) for vision-based text extraction. The LLM reads the image and produces clean Markdown text, handling handwritten notes, stamps, tables, and mixed layouts that traditional OCR tools struggle with.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>import</span> json
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> base64
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> boto3
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>parse_page</span>(image_bytes: <span style=color:#8be9fd;font-style:italic>bytes</span>, page_number: <span style=color:#8be9fd;font-style:italic>int</span>) <span style=color:#ff79c6>-&gt;</span> <span style=color:#8be9fd;font-style:italic>str</span>:
</span></span><span style=display:flex><span>    bedrock <span style=color:#ff79c6>=</span> boto3<span style=color:#ff79c6>.</span>client(<span style=color:#f1fa8c>&#34;bedrock-runtime&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    response <span style=color:#ff79c6>=</span> bedrock<span style=color:#ff79c6>.</span>invoke_model(
</span></span><span style=display:flex><span>        modelId<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;anthropic.claude-3-5-sonnet-20240620-v1:0&#34;</span>,
</span></span><span style=display:flex><span>        body<span style=color:#ff79c6>=</span>json<span style=color:#ff79c6>.</span>dumps({
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;anthropic_version&#34;</span>: <span style=color:#f1fa8c>&#34;bedrock-2023-05-31&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;max_tokens&#34;</span>: <span style=color:#bd93f9>4096</span>,
</span></span><span style=display:flex><span>            <span style=color:#f1fa8c>&#34;messages&#34;</span>: [{
</span></span><span style=display:flex><span>                <span style=color:#f1fa8c>&#34;role&#34;</span>: <span style=color:#f1fa8c>&#34;user&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f1fa8c>&#34;content&#34;</span>: [
</span></span><span style=display:flex><span>                    {
</span></span><span style=display:flex><span>                        <span style=color:#f1fa8c>&#34;type&#34;</span>: <span style=color:#f1fa8c>&#34;image&#34;</span>,
</span></span><span style=display:flex><span>                        <span style=color:#f1fa8c>&#34;source&#34;</span>: {
</span></span><span style=display:flex><span>                            <span style=color:#f1fa8c>&#34;type&#34;</span>: <span style=color:#f1fa8c>&#34;base64&#34;</span>,
</span></span><span style=display:flex><span>                            <span style=color:#f1fa8c>&#34;media_type&#34;</span>: <span style=color:#f1fa8c>&#34;image/png&#34;</span>,
</span></span><span style=display:flex><span>                            <span style=color:#f1fa8c>&#34;data&#34;</span>: base64<span style=color:#ff79c6>.</span>b64encode(image_bytes)<span style=color:#ff79c6>.</span>decode(),
</span></span><span style=display:flex><span>                        },
</span></span><span style=display:flex><span>                    },
</span></span><span style=display:flex><span>                    {
</span></span><span style=display:flex><span>                        <span style=color:#f1fa8c>&#34;type&#34;</span>: <span style=color:#f1fa8c>&#34;text&#34;</span>,
</span></span><span style=display:flex><span>                        <span style=color:#f1fa8c>&#34;text&#34;</span>: <span style=color:#f1fa8c>&#34;Extract all text from this document page. &#34;</span>
</span></span><span style=display:flex><span>                                <span style=color:#f1fa8c>&#34;Preserve the structure using Markdown formatting. &#34;</span>
</span></span><span style=display:flex><span>                                <span style=color:#f1fa8c>&#34;Include tables, headers, and any handwritten text.&#34;</span>,
</span></span><span style=display:flex><span>                    },
</span></span><span style=display:flex><span>                ],
</span></span><span style=display:flex><span>            }],
</span></span><span style=display:flex><span>        }),
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    result <span style=color:#ff79c6>=</span> json<span style=color:#ff79c6>.</span>loads(response[<span style=color:#f1fa8c>&#34;body&#34;</span>]<span style=color:#ff79c6>.</span>read())
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> result[<span style=color:#f1fa8c>&#34;content&#34;</span>][<span style=color:#bd93f9>0</span>][<span style=color:#f1fa8c>&#34;text&#34;</span>]</span></span></code></pre></div></div><p>Why Claude 3.5 Sonnet for OCR instead of Amazon Textract? Two reasons: (1) vision LLMs handle messy real-world documents (stamps, handwriting, mixed layouts) significantly better than traditional OCR, and (2) the output is already structured Markdown, which downstream stages can work with directly without an intermediate parsing step.</p><p><strong>Stage 4: Page Checker (document-level)</strong></p><p>LLM calls fail. Rate limits, timeouts, transient errors. The Page Checker implements retry logic: it collects results from all page parsing calls, identifies failures, and re-dispatches failed pages up to 3 times. This is essential when processing documents with dozens of pages, where even a 1% failure rate means most documents would have at least one failed page.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>check_pages</span>(document_id: <span style=color:#8be9fd;font-style:italic>str</span>, page_results: <span style=color:#8be9fd;font-style:italic>list</span>[<span style=color:#8be9fd;font-style:italic>dict</span>]) <span style=color:#ff79c6>-&gt;</span> <span style=color:#8be9fd;font-style:italic>dict</span>:
</span></span><span style=display:flex><span>    successful <span style=color:#ff79c6>=</span> [p <span style=color:#ff79c6>for</span> p <span style=color:#ff79c6>in</span> page_results <span style=color:#ff79c6>if</span> p[<span style=color:#f1fa8c>&#34;status&#34;</span>] <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#34;success&#34;</span>]
</span></span><span style=display:flex><span>    failed <span style=color:#ff79c6>=</span> [p <span style=color:#ff79c6>for</span> p <span style=color:#ff79c6>in</span> page_results <span style=color:#ff79c6>if</span> p[<span style=color:#f1fa8c>&#34;status&#34;</span>] <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#34;error&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    retryable <span style=color:#ff79c6>=</span> [
</span></span><span style=display:flex><span>        p <span style=color:#ff79c6>for</span> p <span style=color:#ff79c6>in</span> failed
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> p<span style=color:#ff79c6>.</span>get(<span style=color:#f1fa8c>&#34;retry_count&#34;</span>, <span style=color:#bd93f9>0</span>) <span style=color:#ff79c6>&lt;</span> MAX_RETRIES
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> retryable:
</span></span><span style=display:flex><span>        <span style=color:#6272a4># Re-dispatch failed pages for another attempt</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> page <span style=color:#ff79c6>in</span> retryable:
</span></span><span style=display:flex><span>            page[<span style=color:#f1fa8c>&#34;retry_count&#34;</span>] <span style=color:#ff79c6>=</span> page<span style=color:#ff79c6>.</span>get(<span style=color:#f1fa8c>&#34;retry_count&#34;</span>, <span style=color:#bd93f9>0</span>) <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> {<span style=color:#f1fa8c>&#34;status&#34;</span>: <span style=color:#f1fa8c>&#34;retry&#34;</span>, <span style=color:#f1fa8c>&#34;pages&#34;</span>: retryable}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> <span style=color:#ff79c6>not</span> successful:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> {<span style=color:#f1fa8c>&#34;status&#34;</span>: <span style=color:#f1fa8c>&#34;error&#34;</span>, <span style=color:#f1fa8c>&#34;message&#34;</span>: <span style=color:#f1fa8c>&#34;All pages failed parsing&#34;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4># Proceed with whatever pages succeeded</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;status&#34;</span>: <span style=color:#f1fa8c>&#34;success&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;parsed_pages&#34;</span>: <span style=color:#8be9fd;font-style:italic>len</span>(successful),
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>&#34;failed_pages&#34;</span>: <span style=color:#8be9fd;font-style:italic>len</span>(failed),
</span></span><span style=display:flex><span>    }</span></span></code></pre></div></div><h3 class="relative group">Upper Branch: Embedding Pipeline<div id=upper-branch-embedding-pipeline class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#upper-branch-embedding-pipeline aria-label=Anchor>#</a></span></h3><p>After text extraction, the pipeline forks into two parallel branches. The upper branch creates vector embeddings for semantic search.</p><p><strong>Chunker</strong>: Combines all page texts into a single document, then splits it into overlapping chunks with metadata (page numbers, positions). Each chunk is saved to S3.</p><p><strong>Embedder</strong>: Each chunk is embedded using <strong>OpenAI&rsquo;s text-embedding-ada-002</strong> model. We chose ada-002 for its good balance of quality and cost at scale. Embeddings are stored in Aurora PostgreSQL using the <code>pgvector</code> extension, enabling similarity search across all documents in a claim.</p><p>This powers a RAG (Retrieval-Augmented Generation) interface where case managers can ask questions like &ldquo;What was the estimated repair cost?&rdquo; and get answers grounded in the actual documents.</p><h3 class="relative group">Lower Branch: Classification and Extraction Pipeline<div id=lower-branch-classification-and-extraction-pipeline class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#lower-branch-classification-and-extraction-pipeline aria-label=Anchor>#</a></span></h3><p>The lower branch handles structured information extraction.</p><p><strong>Clusterization</strong>: A single insurance document PDF often contains multiple logical sections (a police report followed by a medical certificate followed by repair photos). The clusterization stage identifies contiguous page ranges that belong to the same topic. We use <strong>Gemini 2.0 Flash</strong> for this because it&rsquo;s fast, cheap, and performs well on the classification-style reasoning this step requires.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>clusterize_document</span>(pages: <span style=color:#8be9fd;font-style:italic>list</span>[<span style=color:#8be9fd;font-style:italic>dict</span>]) <span style=color:#ff79c6>-&gt;</span> <span style=color:#8be9fd;font-style:italic>list</span>[<span style=color:#8be9fd;font-style:italic>dict</span>]:
</span></span><span style=display:flex><span>    <span style=color:#f1fa8c>&#34;&#34;&#34;Identify clusters of pages about the same topic.&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4># Build context from all pages</span>
</span></span><span style=display:flex><span>    page_summaries <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>join(
</span></span><span style=display:flex><span>        <span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;Page </span><span style=color:#f1fa8c>{</span>p[<span style=color:#f1fa8c>&#39;number&#39;</span>]<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>: </span><span style=color:#f1fa8c>{</span>p[<span style=color:#f1fa8c>&#39;text&#39;</span>][:<span style=color:#bd93f9>200</span>]<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>...&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> p <span style=color:#ff79c6>in</span> pages
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    prompt <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;&#34;&#34;Analyze these document pages and identify clusters
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    of consecutive pages that discuss the same topic.
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    Pages:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    </span><span style=color:#f1fa8c>{</span>page_summaries<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    Return a JSON array of clusters, each with:
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    - start_page: first page number
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    - end_page: last page number
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    - topic: brief description of what this section covers
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4># Call Gemini 2.0 Flash via the LLM Gateway</span>
</span></span><span style=display:flex><span>    response <span style=color:#ff79c6>=</span> llm_gateway<span style=color:#ff79c6>.</span>invoke(
</span></span><span style=display:flex><span>        provider<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;vertex&#34;</span>,
</span></span><span style=display:flex><span>        model<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;gemini-2.0-flash&#34;</span>,
</span></span><span style=display:flex><span>        prompt<span style=color:#ff79c6>=</span>prompt,
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> json<span style=color:#ff79c6>.</span>loads(response)</span></span></code></pre></div></div><p><strong>Classification</strong>: Each cluster is labeled with a document type (police report, medical certificate, invoice, repair estimate, etc.). The classification model uses the cluster&rsquo;s text content and the claim&rsquo;s line of business to assign the most appropriate label.</p><p><strong>Extraction</strong>: This is where it gets domain-specific. Based on the classification label, the extraction stage applies a tailored extraction strategy. A police report gets license plate, driver name, date, and location extracted. A medical report gets diagnosis, treatment, and provider extracted. An invoice gets line items and totals extracted.</p><p>The results are stored as structured JSON in DynamoDB, making them queryable and displayable in the web UI.</p><p><strong>Cluster Aggregator</strong>: Collects results from all clusters, validates completeness, and updates the document&rsquo;s processing status.</p><h2 class="relative group">The Multi-Model LLM Strategy<div id=the-multi-model-llm-strategy class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#the-multi-model-llm-strategy aria-label=Anchor>#</a></span></h2><p>One of the most interesting architectural decisions was using three different LLM providers, each selected for a specific task:</p><table><thead><tr><th>Task</th><th>Model</th><th>Why</th></tr></thead><tbody><tr><td>Text extraction (OCR)</td><td>Claude 3.5 Sonnet (Bedrock)</td><td>Best vision capabilities for messy documents</td></tr><tr><td>Embeddings</td><td>text-embedding-ada-002 (OpenAI)</td><td>Cost-effective, high-quality embeddings at scale</td></tr><tr><td>Clusterization/Classification</td><td>Gemini 2.0 Flash (Vertex AI)</td><td>Fast and cheap for reasoning tasks</td></tr></tbody></table><p>All LLM calls go through an internal gateway service that abstracts the provider differences. The gateway handles authentication, rate limiting, usage tracking, and fallback logic. From the pipeline&rsquo;s perspective, it&rsquo;s just calling an API with a provider and model name.</p><p>This multi-model approach lets us optimize for cost and quality per task rather than being locked into a single provider. The text extraction stage is the most expensive (vision + large context), so we use the best model available. The clusterization stage processes much less data and needs speed more than depth, so we use a fast, cheap model.</p><h2 class="relative group">Concurrency and Error Handling<div id=concurrency-and-error-handling class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#concurrency-and-error-handling aria-label=Anchor>#</a></span></h2><p>The Step Functions state machine uses Map states to process documents and pages in parallel. A single claim might contain 20 documents, each with 50 pages, resulting in 1,000 parallel page-processing Lambda invocations.</p><p>Key patterns:</p><p><strong>Idempotency</strong>: Every Lambda function is idempotent. If a Step Functions execution is retried (due to a transient error), re-processing the same input produces the same result without side effects. We use DynamoDB conditional writes to prevent duplicate processing.</p><p><strong>Graceful degradation</strong>: If the embedding branch fails for a document, the classification branch still completes (and vice versa). A document with failed embeddings can still have its structured data extracted. The system tracks partial success at every level.</p><p><strong>Correlation tracking</strong>: Every request gets a correlation ID that flows through all Lambda invocations, S3 objects, and DynamoDB records. When something fails, you can trace the entire processing chain from upload to the specific failed step.</p><h2 class="relative group">The Claims Service<div id=the-claims-service class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#the-claims-service aria-label=Anchor>#</a></span></h2><p>The web UI is a Django application running on ECS Fargate, integrated as a microfrontend into the larger analytics platform. Case managers can:</p><ul><li>Browse claims and their documents</li><li>View extracted text alongside the original document images</li><li>See structured extraction results (fields, values, confidence)</li><li>Search across all documents using natural language (RAG)</li><li>Generate claim summaries on demand</li><li>Track document processing status in real time</li></ul><p>Authentication uses Keycloak with JWT tokens. Authorization uses Entra ID groups: each claim is associated with a visibility group, and only members of that group can access the claim&rsquo;s documents. A daily sync job keeps group membership current.</p><h2 class="relative group">Performance and Cost<div id=performance-and-cost class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#performance-and-cost aria-label=Anchor>#</a></span></h2><p>Some numbers from production:</p><ul><li><strong>Processing time</strong>: a 30-page document takes approximately 3-5 minutes end-to-end (dominated by LLM call latency)</li><li><strong>Throughput</strong>: the system handles 500+ documents per hour during peak periods</li><li><strong>Cost per document</strong>: roughly EUR 0.15-0.30, depending on page count and complexity (the bulk of the cost is LLM inference)</li><li><strong>Infrastructure cost when idle</strong>: near zero (serverless)</li></ul><p>The batch processing approach (every 10 minutes) means we can process multiple documents from the same claim together, which is more efficient than processing each upload individually.</p><h2 class="relative group">Lessons Learned<div id=lessons-learned class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#lessons-learned aria-label=Anchor>#</a></span></h2><p><strong>Vision LLMs are production-ready for OCR.</strong> Claude 3.5 Sonnet handles real-world insurance documents (stamps, handwriting, poor scans, mixed languages) far better than traditional OCR. The quality improvement justified the higher per-page cost.</p><p><strong>Step Functions are the right tool for document pipelines.</strong> The built-in retry logic, parallel Map states, error handling, and visual debugging make Step Functions ideal for multi-stage document processing. We tried orchestrating with SQS queues initially, but the complexity of tracking state across stages was not worth it.</p><p><strong>Multi-model is the way forward.</strong> No single LLM is best at everything. Using Claude for vision, OpenAI for embeddings, and Gemini for fast classification gave us the best cost-quality tradeoff at each stage.</p><p><strong>Retry logic is not optional.</strong> LLM APIs fail more often than traditional APIs. Rate limits, timeouts, model overload. The Page Checker retry pattern (up to 3 attempts per page) is what makes the pipeline reliable enough for production.</p><p><strong>Batch over real-time when you can.</strong> Processing uploads every 10 minutes instead of immediately simplified the architecture significantly and reduced costs. For insurance claims processing, a few minutes of latency is perfectly acceptable.</p><h2 class="relative group">What&rsquo;s Next<div id=whats-next class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#whats-next aria-label=Anchor>#</a></span></h2><p>The natural evolution is closing the loop: having the AI agent not just extract and classify documents, but also suggest claim decisions based on the extracted data and historical patterns. This moves from &ldquo;AI assists the human&rdquo; to &ldquo;AI proposes, human approves,&rdquo; which is the next frontier for insurance automation.</p><h2 class="relative group">References<div id=references class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#references aria-label=Anchor>#</a></span></h2><ul><li><a href=https://docs.aws.amazon.com/step-functions/latest/dg/welcome.html target=_blank rel=noreferrer>AWS Step Functions</a></li><li><a href=https://docs.anthropic.com/en/docs/build-with-claude/vision target=_blank rel=noreferrer>Claude Vision Capabilities</a></li><li><a href=https://github.com/pgvector/pgvector target=_blank rel=noreferrer>pgvector for PostgreSQL</a></li><li><a href=https://aws.amazon.com/bedrock/ target=_blank rel=noreferrer>Amazon Bedrock</a></li></ul></div><h2 class="mt-8 text-2xl font-extrabold mb-10">Related</h2><section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3"><article class="article-link--related relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600"><div class=p-4><header><a href=/posts/aws-opensearch-as-monitoring-tool/ class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2"><h2>Aws Opensearch as Monitoring Tool</h2></a></header><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime=2023-07-12T08:42:00+02:00>12 July 2023</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">5 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/tags/aws/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">AWS
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/opensearch/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Opensearch
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/monitoring/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Monitoring
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/elasticsearch/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Elasticsearch
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/logging/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Logging
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/kibana/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Kibana
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/cloudwatch/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Cloudwatch
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/lambda/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Lambda</span></span></a></div></div></div><div class="px-6 pt-4 pb-2"></div></article><article class="article-link--related relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600"><div class="flex-none relative overflow-hidden thumbnail_card_related"><img src="https://images.unsplash.com/photo-1535223289429-462ea9301402?w=1200&amp;q=85" role=presentation loading=lazy decoding=async fetchpriority=low class="not-prose absolute inset-0 w-full h-full object-cover"></div><div class=p-4><header><a href=/posts/multi-account-aws-terraform-workspaces/ class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2"><h2>Managing Multi-Account AWS Infrastructure with Terraform Workspaces</h2></a></header><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime=2025-09-22T09:15:00+02:00>22 September 2025</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">7 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/tags/aws/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">AWS
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/terraform/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Terraform
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/iac/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">IaC
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/devops/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">DevOps
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/cloud/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Cloud</span></span></a></div></div></div><div class="px-6 pt-4 pb-2"></div></article><article class="article-link--related relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600"><div class=p-4><header><a href=/posts/use-protobuf-with-fastapi/ class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2"><h2>Use Protobuf With Fastapi</h2></a></header><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime=2023-01-04T16:00:43+01:00>4 January 2023</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">2 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/tags/python/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Python
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/fastapi/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Fastapi
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/protobuf/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Protobuf</span></span></a></div></div></div><div class="px-6 pt-4 pb-2"></div></article><article class="article-link--related relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600"><div class=p-4><header><a href=/posts/understand-async-await-in-python/ class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2"><h2>Understand Async Await in Python</h2></a></header><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime=2023-01-01T14:50:35+01:00>1 January 2023</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">5 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/tags/asyncio/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Asyncio
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/python/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Python</span></span></a></div></div></div><div class="px-6 pt-4 pb-2"></div></article></section></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span class="flex flex-col"><a class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/building-interactive-cli-tools-in-go-with-bubbletea/><span class=leading-6><span class="inline-block rtl:rotate-180">&larr;</span>&ensp;Building Interactive CLI Tools in Go with Bubbletea
</span></a><span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2025-11-14T10:30:00+01:00>14 November 2025</time>
</span></span><span class="flex flex-col items-end"><a class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/posts/ecs-fargate-production-patterns/><span class=leading-6>ECS Fargate Production Patterns That Actually Work&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
</span></a><span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2026-01-08T14:20:00+01:00>8 January 2026</time></span></span></div></div></footer></article><div id=scroll-to-top class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2026
Manuel Fedele</p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://manuelfedele.github.io/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>