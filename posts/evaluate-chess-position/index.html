<!doctype html><html lang=en><head><title>Building a Chess Engine - From Position Evaluation to Search Techniques :: Git Push and Run</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Building a Chess Engine: From Position Evaluation to Search Techniques Chess engines are fascinating pieces of software that combine various computer science concepts: position evaluation, tree search, move generation, and optimization techniques. This guide will walk you through implementing a chess engine, with a particular focus on position evaluation and search strategies.
Part 1: Basic Position Representation First, let&rsquo;s implement a basic board representation. While FEN (Forsyth–Edwards Notation) is the standard for chess positions, we&rsquo;ll use a more computation-friendly format internally.
"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://manuelfedele.github.io/posts/evaluate-chess-position/><script async src="https://www.googletagmanager.com/gtag/js?id=G-K9P1DJX238"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-K9P1DJX238")}</script><link rel=stylesheet href=https://manuelfedele.github.io/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://manuelfedele.github.io/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://manuelfedele.github.io/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://manuelfedele.github.io/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://manuelfedele.github.io/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://manuelfedele.github.io/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://manuelfedele.github.io/css/main.min.775ac2af004d44c22a6d000fbd1d9af529642f5cef27399d0280d180af2c2e9b.css><link rel=stylesheet href=https://manuelfedele.github.io/css/menu.min.310d32205bdedd6f43144e3c3273c9deecd238eba5f9108db5ea96ca0cfbe377.css><link rel=stylesheet href=https://manuelfedele.github.io/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://manuelfedele.github.io/css/post.min.ad50c7f4d00e7975918f37fc74c6029e1959a40d66fb5b2c6564a8715e985573.css><link rel=stylesheet href=https://manuelfedele.github.io/css/syntax.min.e9ab635cf918bc84b901eb65c0b2caa74c9544245e3647c1af5c129896ef276e.css><link rel=stylesheet href=https://manuelfedele.github.io/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://manuelfedele.github.io/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel="shortcut icon" href=https://manuelfedele.github.io/favicon.png><link rel=apple-touch-icon href=https://manuelfedele.github.io/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Building a Chess Engine - From Position Evaluation to Search Techniques"><meta property="og:description" content="Building a Chess Engine: From Position Evaluation to Search Techniques Chess engines are fascinating pieces of software that combine various computer science concepts: position evaluation, tree search, move generation, and optimization techniques. This guide will walk you through implementing a chess engine, with a particular focus on position evaluation and search strategies.
Part 1: Basic Position Representation First, let&rsquo;s implement a basic board representation. While FEN (Forsyth–Edwards Notation) is the standard for chess positions, we&rsquo;ll use a more computation-friendly format internally.
"><meta property="og:url" content="https://manuelfedele.github.io/posts/evaluate-chess-position/"><meta property="og:site_name" content="Git Push and Run"><meta property="og:image" content="https://manuelfedele.github.io/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2024-11-27 17:33:00 +0000 UTC"></head><body><div class="container center"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>git push && run</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/about>About</a></li><li><a href=/posts>Blog</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/about>About</a></li><li><a href=/posts>Blog</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://manuelfedele.github.io/posts/evaluate-chess-position/>Building a Chess Engine - From Position Evaluation to Search Techniques</a></h1><div class=post-meta><time class=post-date>2024-11-27</time><span class=post-reading-time>13 min read (2695 words)</span></div><span class=post-tags>#<a href=https://manuelfedele.github.io/tags/golang/>golang</a>&nbsp;</span><div class=table-of-contents><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#part-1-basic-position-representation>Part 1: Basic Position Representation</a></li><li><a href=#part-2-position-evaluation>Part 2: Position Evaluation</a></li><li><a href=#part-3-search-implementation>Part 3: Search Implementation</a></li><li><a href=#part-4-advanced-evaluation-features>Part 4: Advanced Evaluation Features</a></li><li><a href=#part-5-advanced-search-techniques>Part 5: Advanced Search Techniques</a></li><li><a href=#part-6-time-management>Part 6: Time Management</a></li><li><a href=#part-7-opening-book-and-endgame-tablebases>Part 7: Opening Book and Endgame Tablebases</a></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#references>References</a></li></ul></nav></div><div class=post-content><div><h1 id=building-a-chess-engine-from-position-evaluation-to-search-techniques>Building a Chess Engine: From Position Evaluation to Search Techniques<a href=#building-a-chess-engine-from-position-evaluation-to-search-techniques class=hanchor arialabel=Anchor>#</a></h1><p>Chess engines are fascinating pieces of software that combine various computer science concepts: position evaluation, tree search, move generation, and optimization techniques. This guide will walk you through implementing a chess engine, with a particular focus on position evaluation and search strategies.</p><h2 id=part-1-basic-position-representation>Part 1: Basic Position Representation<a href=#part-1-basic-position-representation class=hanchor arialabel=Anchor>#</a></h2><p>First, let&rsquo;s implement a basic board representation. While FEN (Forsyth–Edwards Notation) is the standard for chess positions, we&rsquo;ll use a more computation-friendly format internally.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>chess</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Piece constants</span>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>Empty</span> <span class=p>=</span> <span class=kc>iota</span>
</span></span><span class=line><span class=cl>    <span class=nx>Pawn</span>
</span></span><span class=line><span class=cl>    <span class=nx>Knight</span>
</span></span><span class=line><span class=cl>    <span class=nx>Bishop</span>
</span></span><span class=line><span class=cl>    <span class=nx>Rook</span>
</span></span><span class=line><span class=cl>    <span class=nx>Queen</span>
</span></span><span class=line><span class=cl>    <span class=nx>King</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Color constants</span>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>White</span> <span class=p>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=nx>Black</span> <span class=p>=</span> <span class=o>-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Position represents a chess position</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Position</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Board</span>    <span class=p>[</span><span class=mi>64</span><span class=p>]</span><span class=kt>int</span>    <span class=c1>// Piece type (0-6)</span>
</span></span><span class=line><span class=cl>    <span class=nx>Colors</span>   <span class=p>[</span><span class=mi>64</span><span class=p>]</span><span class=kt>int</span>    <span class=c1>// Piece color (1 for white, -1 for black)</span>
</span></span><span class=line><span class=cl>    <span class=nx>ToMove</span>   <span class=kt>int</span>        <span class=c1>// Side to move</span>
</span></span><span class=line><span class=cl>    <span class=nx>CastlingRights</span> <span class=kt>int</span>  <span class=c1>// Castling availability</span>
</span></span><span class=line><span class=cl>    <span class=nx>EnPassant</span>    <span class=kt>int</span>    <span class=c1>// En passant target square</span>
</span></span><span class=line><span class=cl>    <span class=nx>HalfMoveClock</span> <span class=kt>int</span>   <span class=c1>// Halfmove clock for fifty-move rule</span>
</span></span><span class=line><span class=cl>    <span class=nx>FullMoveNumber</span> <span class=kt>int</span>  <span class=c1>// Fullmove number</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Square converts file (a-h) and rank (1-8) to board index</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Square</span><span class=p>(</span><span class=nx>file</span> <span class=kt>byte</span><span class=p>,</span> <span class=nx>rank</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=nx>rank</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>8</span> <span class=o>+</span> <span class=nb>int</span><span class=p>(</span><span class=nx>file</span><span class=o>-</span><span class=sc>&#39;a&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// NewPosition creates a starting chess position</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewPosition</span><span class=p>()</span> <span class=o>*</span><span class=nx>Position</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>pos</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>Position</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>ToMove</span><span class=p>:</span> <span class=nx>White</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>CastlingRights</span><span class=p>:</span> <span class=mh>0xF</span><span class=p>,</span> <span class=c1>// All castling rights available</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Initialize starting position</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Back rank pieces</span>
</span></span><span class=line><span class=cl>    <span class=nx>backRank</span> <span class=o>:=</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{</span><span class=nx>Rook</span><span class=p>,</span> <span class=nx>Knight</span><span class=p>,</span> <span class=nx>Bishop</span><span class=p>,</span> <span class=nx>Queen</span><span class=p>,</span> <span class=nx>King</span><span class=p>,</span> <span class=nx>Bishop</span><span class=p>,</span> <span class=nx>Knight</span><span class=p>,</span> <span class=nx>Rook</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>piece</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>backRank</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// White pieces</span>
</span></span><span class=line><span class=cl>        <span class=nx>pos</span><span class=p>.</span><span class=nx>Board</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nx>piece</span>
</span></span><span class=line><span class=cl>        <span class=nx>pos</span><span class=p>.</span><span class=nx>Colors</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nx>White</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Black pieces</span>
</span></span><span class=line><span class=cl>        <span class=nx>pos</span><span class=p>.</span><span class=nx>Board</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>56</span><span class=p>]</span> <span class=p>=</span> <span class=nx>piece</span>
</span></span><span class=line><span class=cl>        <span class=nx>pos</span><span class=p>.</span><span class=nx>Colors</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>56</span><span class=p>]</span> <span class=p>=</span> <span class=nx>Black</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Pawns</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>8</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// White pawns</span>
</span></span><span class=line><span class=cl>        <span class=nx>pos</span><span class=p>.</span><span class=nx>Board</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>8</span><span class=p>]</span> <span class=p>=</span> <span class=nx>Pawn</span>
</span></span><span class=line><span class=cl>        <span class=nx>pos</span><span class=p>.</span><span class=nx>Colors</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>8</span><span class=p>]</span> <span class=p>=</span> <span class=nx>White</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Black pawns</span>
</span></span><span class=line><span class=cl>        <span class=nx>pos</span><span class=p>.</span><span class=nx>Board</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>48</span><span class=p>]</span> <span class=p>=</span> <span class=nx>Pawn</span>
</span></span><span class=line><span class=cl>        <span class=nx>pos</span><span class=p>.</span><span class=nx>Colors</span><span class=p>[</span><span class=nx>i</span><span class=o>+</span><span class=mi>48</span><span class=p>]</span> <span class=p>=</span> <span class=nx>Black</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>pos</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=part-2-position-evaluation>Part 2: Position Evaluation<a href=#part-2-position-evaluation class=hanchor arialabel=Anchor>#</a></h2><p>Position evaluation is crucial for a chess engine. We&rsquo;ll implement several evaluation components:</p><ol><li>Material count</li><li>Piece position tables</li><li>Pawn structure evaluation</li><li>King safety</li><li>Mobility evaluation</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Piece values in centipawns</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>pieceValues</span> <span class=p>=</span> <span class=kd>map</span><span class=p>[</span><span class=kt>int</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Pawn</span><span class=p>:</span>   <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>Knight</span><span class=p>:</span> <span class=mi>320</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>Bishop</span><span class=p>:</span> <span class=mi>330</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>Rook</span><span class=p>:</span>   <span class=mi>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>Queen</span><span class=p>:</span>  <span class=mi>900</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>King</span><span class=p>:</span>   <span class=mi>20000</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Piece-Square tables for position evaluation</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>pawnTable</span> <span class=p>=</span> <span class=p>[</span><span class=mi>64</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span>
</span></span><span class=line><span class=cl>     <span class=mi>0</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mi>50</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>     <span class=mi>5</span><span class=p>,</span>  <span class=mi>5</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>25</span><span class=p>,</span> <span class=mi>25</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span>  <span class=mi>5</span><span class=p>,</span>  <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>     <span class=mi>0</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>     <span class=mi>5</span><span class=p>,</span> <span class=o>-</span><span class=mi>5</span><span class=p>,</span><span class=o>-</span><span class=mi>10</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=mi>10</span><span class=p>,</span> <span class=o>-</span><span class=mi>5</span><span class=p>,</span>  <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>     <span class=mi>5</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span><span class=o>-</span><span class=mi>20</span><span class=p>,</span><span class=o>-</span><span class=mi>20</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span>  <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>     <span class=mi>0</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Similar tables for other pieces...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Evaluator</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>pos</span> <span class=o>*</span><span class=nx>Position</span>
</span></span><span class=line><span class=cl>    <span class=nx>stage</span> <span class=nx>GameStage</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Evaluate returns a position score in centipawns</span>
</span></span><span class=line><span class=cl><span class=c1>// Positive scores favor White, negative scores favor Black</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Evaluator</span><span class=p>)</span> <span class=nf>Evaluate</span><span class=p>()</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>score</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Material evaluation</span>
</span></span><span class=line><span class=cl>    <span class=nx>score</span> <span class=o>+=</span> <span class=nx>e</span><span class=p>.</span><span class=nf>evaluateMaterial</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Piece-square table evaluation</span>
</span></span><span class=line><span class=cl>    <span class=nx>score</span> <span class=o>+=</span> <span class=nx>e</span><span class=p>.</span><span class=nf>evaluatePiecePositions</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Pawn structure evaluation</span>
</span></span><span class=line><span class=cl>    <span class=nx>score</span> <span class=o>+=</span> <span class=nx>e</span><span class=p>.</span><span class=nf>evaluatePawnStructure</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// King safety</span>
</span></span><span class=line><span class=cl>    <span class=nx>score</span> <span class=o>+=</span> <span class=nx>e</span><span class=p>.</span><span class=nf>evaluateKingSafety</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Mobility</span>
</span></span><span class=line><span class=cl>    <span class=nx>score</span> <span class=o>+=</span> <span class=nx>e</span><span class=p>.</span><span class=nf>evaluateMobility</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>score</span> <span class=o>*</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>ToMove</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Evaluator</span><span class=p>)</span> <span class=nf>evaluateMaterial</span><span class=p>()</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>score</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>sq</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>sq</span> <span class=p>&lt;</span> <span class=mi>64</span><span class=p>;</span> <span class=nx>sq</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>piece</span> <span class=o>:=</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Board</span><span class=p>[</span><span class=nx>sq</span><span class=p>];</span> <span class=nx>piece</span> <span class=o>!=</span> <span class=nx>Empty</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>score</span> <span class=o>+=</span> <span class=nx>pieceValues</span><span class=p>[</span><span class=nx>piece</span><span class=p>]</span> <span class=o>*</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Colors</span><span class=p>[</span><span class=nx>sq</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>score</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Evaluator</span><span class=p>)</span> <span class=nf>evaluatePawnStructure</span><span class=p>()</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>score</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Evaluate doubled pawns</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>file</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>file</span> <span class=p>&lt;</span> <span class=mi>8</span><span class=p>;</span> <span class=nx>file</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>whitePawns</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=nx>blackPawns</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=nx>rank</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>rank</span> <span class=p>&lt;</span> <span class=mi>8</span><span class=p>;</span> <span class=nx>rank</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>sq</span> <span class=o>:=</span> <span class=nx>rank</span><span class=o>*</span><span class=mi>8</span> <span class=o>+</span> <span class=nx>file</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Board</span><span class=p>[</span><span class=nx>sq</span><span class=p>]</span> <span class=o>==</span> <span class=nx>Pawn</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Colors</span><span class=p>[</span><span class=nx>sq</span><span class=p>]</span> <span class=o>==</span> <span class=nx>White</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>whitePawns</span><span class=o>++</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>blackPawns</span><span class=o>++</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Penalty for doubled pawns</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>whitePawns</span> <span class=p>&gt;</span> <span class=mi>1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>score</span> <span class=o>-=</span> <span class=mi>20</span> <span class=o>*</span> <span class=p>(</span><span class=nx>whitePawns</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>blackPawns</span> <span class=p>&gt;</span> <span class=mi>1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>score</span> <span class=o>+=</span> <span class=mi>20</span> <span class=o>*</span> <span class=p>(</span><span class=nx>blackPawns</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Evaluate isolated pawns</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>file</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>file</span> <span class=p>&lt;</span> <span class=mi>8</span><span class=p>;</span> <span class=nx>file</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>hasWhitePawn</span> <span class=o>:=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>        <span class=nx>hasBlackPawn</span> <span class=o>:=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=nx>rank</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>rank</span> <span class=p>&lt;</span> <span class=mi>8</span><span class=p>;</span> <span class=nx>rank</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>sq</span> <span class=o>:=</span> <span class=nx>rank</span><span class=o>*</span><span class=mi>8</span> <span class=o>+</span> <span class=nx>file</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Board</span><span class=p>[</span><span class=nx>sq</span><span class=p>]</span> <span class=o>==</span> <span class=nx>Pawn</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Colors</span><span class=p>[</span><span class=nx>sq</span><span class=p>]</span> <span class=o>==</span> <span class=nx>White</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>hasWhitePawn</span> <span class=p>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>hasBlackPawn</span> <span class=p>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>hasWhitePawn</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>isIsolated</span> <span class=o>:=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>file</span> <span class=p>&gt;</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// Check left file for pawns</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=nx>rank</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>rank</span> <span class=p>&lt;</span> <span class=mi>8</span><span class=p>;</span> <span class=nx>rank</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>sq</span> <span class=o>:=</span> <span class=nx>rank</span><span class=o>*</span><span class=mi>8</span> <span class=o>+</span> <span class=p>(</span><span class=nx>file</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Board</span><span class=p>[</span><span class=nx>sq</span><span class=p>]</span> <span class=o>==</span> <span class=nx>Pawn</span> <span class=o>&amp;&amp;</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Colors</span><span class=p>[</span><span class=nx>sq</span><span class=p>]</span> <span class=o>==</span> <span class=nx>White</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nx>isIsolated</span> <span class=p>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>file</span> <span class=p>&lt;</span> <span class=mi>7</span> <span class=o>&amp;&amp;</span> <span class=nx>isIsolated</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// Check right file for pawns</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=nx>rank</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>rank</span> <span class=p>&lt;</span> <span class=mi>8</span><span class=p>;</span> <span class=nx>rank</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>sq</span> <span class=o>:=</span> <span class=nx>rank</span><span class=o>*</span><span class=mi>8</span> <span class=o>+</span> <span class=p>(</span><span class=nx>file</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Board</span><span class=p>[</span><span class=nx>sq</span><span class=p>]</span> <span class=o>==</span> <span class=nx>Pawn</span> <span class=o>&amp;&amp;</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Colors</span><span class=p>[</span><span class=nx>sq</span><span class=p>]</span> <span class=o>==</span> <span class=nx>White</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nx>isIsolated</span> <span class=p>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>isIsolated</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>score</span> <span class=o>-=</span> <span class=mi>15</span> <span class=c1>// Penalty for isolated pawn</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Similar check for black pawns...</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>score</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Evaluator</span><span class=p>)</span> <span class=nf>evaluateKingSafety</span><span class=p>()</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>score</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Find king positions</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>whiteKingSq</span><span class=p>,</span> <span class=nx>blackKingSq</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>sq</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>sq</span> <span class=p>&lt;</span> <span class=mi>64</span><span class=p>;</span> <span class=nx>sq</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Board</span><span class=p>[</span><span class=nx>sq</span><span class=p>]</span> <span class=o>==</span> <span class=nx>King</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Colors</span><span class=p>[</span><span class=nx>sq</span><span class=p>]</span> <span class=o>==</span> <span class=nx>White</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>whiteKingSq</span> <span class=p>=</span> <span class=nx>sq</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>blackKingSq</span> <span class=p>=</span> <span class=nx>sq</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Evaluate pawn shield</span>
</span></span><span class=line><span class=cl>    <span class=nx>score</span> <span class=o>+=</span> <span class=nx>e</span><span class=p>.</span><span class=nf>evaluatePawnShield</span><span class=p>(</span><span class=nx>whiteKingSq</span><span class=p>,</span> <span class=nx>White</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>score</span> <span class=o>-=</span> <span class=nx>e</span><span class=p>.</span><span class=nf>evaluatePawnShield</span><span class=p>(</span><span class=nx>blackKingSq</span><span class=p>,</span> <span class=nx>Black</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Evaluate king tropism (enemy pieces&#39; distance to king)</span>
</span></span><span class=line><span class=cl>    <span class=nx>score</span> <span class=o>+=</span> <span class=nx>e</span><span class=p>.</span><span class=nf>evaluateKingTropism</span><span class=p>(</span><span class=nx>whiteKingSq</span><span class=p>,</span> <span class=nx>blackKingSq</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>score</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Evaluator</span><span class=p>)</span> <span class=nf>evaluatePawnShield</span><span class=p>(</span><span class=nx>kingSq</span><span class=p>,</span> <span class=nx>color</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>score</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=nx>rank</span> <span class=o>:=</span> <span class=nx>kingSq</span> <span class=o>/</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>    <span class=nx>file</span> <span class=o>:=</span> <span class=nx>kingSq</span> <span class=o>%</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Check pawns in front of king</span>
</span></span><span class=line><span class=cl>    <span class=nx>pawnShieldSquares</span> <span class=o>:=</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>Square</span><span class=p>(</span><span class=nb>byte</span><span class=p>(</span><span class=sc>&#39;a&#39;</span><span class=o>+</span><span class=nx>file</span><span class=o>-</span><span class=mi>1</span><span class=p>),</span> <span class=nx>rank</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nf>Square</span><span class=p>(</span><span class=nb>byte</span><span class=p>(</span><span class=sc>&#39;a&#39;</span><span class=o>+</span><span class=nx>file</span><span class=p>),</span> <span class=nx>rank</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nf>Square</span><span class=p>(</span><span class=nb>byte</span><span class=p>(</span><span class=sc>&#39;a&#39;</span><span class=o>+</span><span class=nx>file</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span> <span class=nx>rank</span><span class=o>+</span><span class=mi>1</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>sq</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>pawnShieldSquares</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>sq</span> <span class=o>&gt;=</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=nx>sq</span> <span class=p>&lt;</span> <span class=mi>64</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Board</span><span class=p>[</span><span class=nx>sq</span><span class=p>]</span> <span class=o>==</span> <span class=nx>Pawn</span> <span class=o>&amp;&amp;</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Colors</span><span class=p>[</span><span class=nx>sq</span><span class=p>]</span> <span class=o>==</span> <span class=nx>color</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>score</span> <span class=o>+=</span> <span class=mi>10</span> <span class=c1>// Bonus for each pawn shield</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>score</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=part-3-search-implementation>Part 3: Search Implementation<a href=#part-3-search-implementation class=hanchor arialabel=Anchor>#</a></h2><p>Now let&rsquo;s implement the search algorithm. We&rsquo;ll use alpha-beta pruning with various enhancements:</p><ol><li>Principal Variation Search</li><li>Quiescence Search</li><li>Move Ordering</li><li>Transposition Table</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>SearchInfo</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Depth</span>      <span class=kt>int</span>
</span></span><span class=line><span class=cl>    <span class=nx>NodesSearched</span> <span class=kt>int64</span>
</span></span><span class=line><span class=cl>    <span class=nx>StartTime</span>  <span class=nx>time</span><span class=p>.</span><span class=nx>Time</span>
</span></span><span class=line><span class=cl>    <span class=nx>StopTime</span>   <span class=nx>time</span><span class=p>.</span><span class=nx>Time</span>
</span></span><span class=line><span class=cl>    <span class=nx>Stopped</span>    <span class=kt>bool</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>TranspositionEntry</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Hash</span>    <span class=kt>uint64</span>
</span></span><span class=line><span class=cl>    <span class=nx>Depth</span>   <span class=kt>int</span>
</span></span><span class=line><span class=cl>    <span class=nx>Score</span>   <span class=kt>int</span>
</span></span><span class=line><span class=cl>    <span class=nx>Type</span>    <span class=kt>int</span> <span class=c1>// EXACT, ALPHA, or BETA</span>
</span></span><span class=line><span class=cl>    <span class=nx>Move</span>    <span class=nx>Move</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>const</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>EXACT</span> <span class=p>=</span> <span class=kc>iota</span>
</span></span><span class=line><span class=cl>    <span class=nx>ALPHA</span>
</span></span><span class=line><span class=cl>    <span class=nx>BETA</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Engine</span><span class=p>)</span> <span class=nf>Search</span><span class=p>(</span><span class=nx>pos</span> <span class=o>*</span><span class=nx>Position</span><span class=p>,</span> <span class=nx>depth</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=nx>bestMove</span> <span class=nx>Move</span><span class=p>,</span> <span class=nx>score</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>info</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>SearchInfo</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Depth</span><span class=p>:</span>     <span class=nx>depth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>StartTime</span><span class=p>:</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=nx>StopTime</span><span class=p>:</span>  <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>().</span><span class=nf>Add</span><span class=p>(</span><span class=mi>5</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>),</span> <span class=c1>// 5 second time control</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>alpha</span> <span class=o>:=</span> <span class=o>-</span><span class=nx>infinity</span>
</span></span><span class=line><span class=cl>    <span class=nx>beta</span> <span class=o>:=</span> <span class=nx>infinity</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Iterative deepening</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>currentDepth</span> <span class=o>:=</span> <span class=mi>1</span><span class=p>;</span> <span class=nx>currentDepth</span> <span class=o>&lt;=</span> <span class=nx>depth</span><span class=p>;</span> <span class=nx>currentDepth</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>score</span> <span class=p>=</span> <span class=nx>e</span><span class=p>.</span><span class=nf>alphaBeta</span><span class=p>(</span><span class=nx>pos</span><span class=p>,</span> <span class=nx>currentDepth</span><span class=p>,</span> <span class=nx>alpha</span><span class=p>,</span> <span class=nx>beta</span><span class=p>,</span> <span class=nx>info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Check if search should be stopped</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>info</span><span class=p>.</span><span class=nx>Stopped</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Get best move from transposition table</span>
</span></span><span class=line><span class=cl>        <span class=nx>bestMove</span> <span class=p>=</span> <span class=nx>e</span><span class=p>.</span><span class=nx>tt</span><span class=p>.</span><span class=nf>GetMove</span><span class=p>(</span><span class=nx>pos</span><span class=p>.</span><span class=nf>Hash</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>bestMove</span><span class=p>,</span> <span class=nx>score</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Engine</span><span class=p>)</span> <span class=nf>alphaBeta</span><span class=p>(</span><span class=nx>pos</span> <span class=o>*</span><span class=nx>Position</span><span class=p>,</span> <span class=nx>depth</span><span class=p>,</span> <span class=nx>alpha</span><span class=p>,</span> <span class=nx>beta</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>info</span> <span class=o>*</span><span class=nx>SearchInfo</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>info</span><span class=p>.</span><span class=nx>NodesSearched</span><span class=o>++</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Check for time</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>().</span><span class=nf>After</span><span class=p>(</span><span class=nx>info</span><span class=p>.</span><span class=nx>StopTime</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>info</span><span class=p>.</span><span class=nx>Stopped</span> <span class=p>=</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Check transposition table</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>entry</span><span class=p>,</span> <span class=nx>found</span> <span class=o>:=</span> <span class=nx>e</span><span class=p>.</span><span class=nx>tt</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=nx>pos</span><span class=p>.</span><span class=nf>Hash</span><span class=p>());</span> <span class=nx>found</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>entry</span><span class=p>.</span><span class=nx>Depth</span> <span class=o>&gt;=</span> <span class=nx>depth</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>entry</span><span class=p>.</span><span class=nx>Type</span> <span class=o>==</span> <span class=nx>EXACT</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=nx>entry</span><span class=p>.</span><span class=nx>Score</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>entry</span><span class=p>.</span><span class=nx>Type</span> <span class=o>==</span> <span class=nx>ALPHA</span> <span class=o>&amp;&amp;</span> <span class=nx>entry</span><span class=p>.</span><span class=nx>Score</span> <span class=o>&lt;=</span> <span class=nx>alpha</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=nx>alpha</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>entry</span><span class=p>.</span><span class=nx>Type</span> <span class=o>==</span> <span class=nx>BETA</span> <span class=o>&amp;&amp;</span> <span class=nx>entry</span><span class=p>.</span><span class=nx>Score</span> <span class=o>&gt;=</span> <span class=nx>beta</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=nx>beta</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Base case: evaluate position</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>depth</span> <span class=o>==</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>e</span><span class=p>.</span><span class=nf>quiescence</span><span class=p>(</span><span class=nx>pos</span><span class=p>,</span> <span class=nx>alpha</span><span class=p>,</span> <span class=nx>beta</span><span class=p>,</span> <span class=nx>info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>moves</span> <span class=o>:=</span> <span class=nx>e</span><span class=p>.</span><span class=nf>generateMoves</span><span class=p>(</span><span class=nx>pos</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>moves</span> <span class=p>=</span> <span class=nx>e</span><span class=p>.</span><span class=nf>orderMoves</span><span class=p>(</span><span class=nx>pos</span><span class=p>,</span> <span class=nx>moves</span><span class=p>)</span> <span class=c1>// Order moves for better pruning</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>bestScore</span> <span class=o>:=</span> <span class=o>-</span><span class=nx>infinity</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>move</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>moves</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>newPos</span> <span class=o>:=</span> <span class=nx>pos</span><span class=p>.</span><span class=nf>MakeMove</span><span class=p>(</span><span class=nx>move</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>score</span> <span class=o>:=</span> <span class=o>-</span><span class=nx>e</span><span class=p>.</span><span class=nf>alphaBeta</span><span class=p>(</span><span class=nx>newPos</span><span class=p>,</span> <span class=nx>depth</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=nx>beta</span><span class=p>,</span> <span class=o>-</span><span class=nx>alpha</span><span class=p>,</span> <span class=nx>info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>score</span> <span class=p>&gt;</span> <span class=nx>bestScore</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>bestScore</span> <span class=p>=</span> <span class=nx>score</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1>// Update transposition table</span>
</span></span><span class=line><span class=cl>            <span class=nx>e</span><span class=p>.</span><span class=nx>tt</span><span class=p>.</span><span class=nf>Store</span><span class=p>(</span><span class=nx>pos</span><span class=p>.</span><span class=nf>Hash</span><span class=p>(),</span> <span class=nx>TranspositionEntry</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>Hash</span><span class=p>:</span>  <span class=nx>pos</span><span class=p>.</span><span class=nf>Hash</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=nx>Depth</span><span class=p>:</span> <span class=nx>depth</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>Score</span><span class=p>:</span> <span class=nx>score</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>Type</span><span class=p>:</span>  <span class=nx>EXACT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nx>Move</span><span class=p>:</span>  <span class=nx>move</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>alpha</span> <span class=p>=</span> <span class=nb>max</span><span class=p>(</span><span class=nx>alpha</span><span class=p>,</span> <span class=nx>score</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>alpha</span> <span class=o>&gt;=</span> <span class=nx>beta</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span> <span class=c1>// Beta cutoff</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>bestScore</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Engine</span><span class=p>)</span> <span class=nf>quiescence</span><span class=p>(</span><span class=nx>pos</span> <span class=o>*</span><span class=nx>Position</span><span class=p>,</span> <span class=nx>alpha</span><span class=p>,</span> <span class=nx>beta</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>info</span> <span class=o>*</span><span class=nx>SearchInfo</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>info</span><span class=p>.</span><span class=nx>NodesSearched</span><span class=o>++</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>standPat</span> <span class=o>:=</span> <span class=nx>e</span><span class=p>.</span><span class=nf>evaluate</span><span class=p>(</span><span class=nx>pos</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>standPat</span> <span class=o>&gt;=</span> <span class=nx>beta</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>beta</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>alpha</span> <span class=p>&lt;</span> <span class=nx>standPat</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>alpha</span> <span class=p>=</span> <span class=nx>standPat</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Generate capturing moves only</span>
</span></span><span class=line><span class=cl>    <span class=nx>captures</span> <span class=o>:=</span> <span class=nx>e</span><span class=p>.</span><span class=nf>generateCaptures</span><span class=p>(</span><span class=nx>pos</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>captures</span> <span class=p>=</span> <span class=nx>e</span><span class=p>.</span><span class=nf>orderMoves</span><span class=p>(</span><span class=nx>pos</span><span class=p>,</span> <span class=nx>captures</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>move</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>captures</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>newPos</span> <span class=o>:=</span> <span class=nx>pos</span><span class=p>.</span><span class=nf>MakeMove</span><span class=p>(</span><span class=nx>move</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>score</span> <span class=o>:=</span> <span class=o>-</span><span class=nx>e</span><span class=p>.</span><span class=nf>quiescence</span><span class=p>(</span><span class=nx>newPos</span><span class=p>,</span> <span class=o>-</span><span class=nx>beta</span><span class=p>,</span> <span class=o>-</span><span class=nx>alpha</span><span class=p>,</span> <span class=nx>info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>score</span> <span class=o>&gt;=</span> <span class=nx>beta</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>beta</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>score</span> <span class=p>&gt;</span> <span class=nx>alpha</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>alpha</span> <span class=p>=</span> <span class=nx>score</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>alpha</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Engine</span><span class=p>)</span> <span class=nf>orderMoves</span><span class=p>(</span><span class=nx>pos</span> <span class=o>*</span><span class=nx>Position</span><span class=p>,</span> <span class=nx>moves</span> <span class=p>[]</span><span class=nx>Move</span><span class=p>)</span> <span class=p>[]</span><span class=nx>Move</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Score moves for ordering</span>
</span></span><span class=line><span class=cl>    <span class=kd>type</span> <span class=nx>ScoredMove</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>move</span>  <span class=nx>Move</span>
</span></span><span class=line><span class=cl>        <span class=nx>score</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nx>scoredMoves</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=nx>ScoredMove</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=nx>moves</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>move</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>moves</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>score</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// TTMove bonus</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>ttMove</span><span class=p>,</span> <span class=nx>found</span> <span class=o>:=</span> <span class=nx>e</span><span class=p>.</span><span class=nx>tt</span><span class=p>.</span><span class=nf>GetMove</span><span class=p>(</span><span class=nx>pos</span><span class=p>.</span><span class=nf>Hash</span><span class=p>());</span> <span class=nx>found</span> <span class=o>&amp;&amp;</span> <span class=nx>move</span> <span class=o>==</span> <span class=nx>ttMove</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>score</span> <span class=o>+=</span> <span class=mi>10000</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// MVV/LVA (Most Valuable Victim / Least Valuable Attacker)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>move</span><span class=p>.</span><span class=nf>IsCapture</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>victim</span> <span class=o>:=</span> <span class=nx>pos</span><span class=p>.</span><span class=nx>Board</span><span class=p>[</span><span class=nx>move</span><span class=p>.</span><span class=nf>To</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>            <span class=nx>attacker</span> <span class=o>:=</span> <span class=nx>pos</span><span class=p>.</span><span class=nx>Board</span><span class=p>[</span><span class=nx>move</span><span class=p>.</span><span class=nf>From</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>            <span class=nx>score</span> <span class=o>+=</span> <span class=nx>pieceValues</span><span class=p>[</span><span class=nx>victim</span><span class=p>]</span> <span class=o>-</span> <span class=nx>pieceValues</span><span class=p>[</span><span class=nx>attacker</span><span class=p>]</span><span class=o>/</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Killer move bonus</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>e</span><span class=p>.</span><span class=nf>isKillerMove</span><span class=p>(</span><span class=nx>move</span><span class=p>,</span> <span class=nx>pos</span><span class=p>.</span><span class=nf>Ply</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>score</span> <span class=o>+=</span> <span class=mi>900</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// History heuristic</span>
</span></span><span class=line><span class=cl>        <span class=nx>score</span> <span class=o>+=</span> <span class=nx>e</span><span class=p>.</span><span class=nx>history</span><span class=p>[</span><span class=nx>move</span><span class=p>.</span><span class=nf>From</span><span class=p>()][</span><span class=nx>move</span><span class=p>.</span><span class=nf>To</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>scoredMoves</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nx>ScoredMove</span><span class=p>{</span><span class=nx>move</span><span class=p>,</span> <span class=nx>score</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Sort moves by score</span>
</span></span><span class=line><span class=cl>    <span class=nx>sort</span><span class=p>.</span><span class=nf>Slice</span><span class=p>(</span><span class=nx>scoredMoves</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>i</span><span class=p>,</span> <span class=nx>j</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>scoredMoves</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nx>score</span> <span class=p>&gt;</span> <span class=nx>scoredMoves</span><span class=p>[</span><span class=nx>j</span><span class=p>].</span><span class=nx>score</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Extract sorted moves</span>
</span></span><span class=line><span class=cl>    <span class=nx>sortedMoves</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=nx>Move</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=nx>moves</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>sm</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>scoredMoves</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>sortedMoves</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span> <span class=p>=</span> <span class=nx>sm</span><span class=p>.</span><span class=nx>move</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>sortedMoves</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=part-4-advanced-evaluation-features>Part 4: Advanced Evaluation Features<a href=#part-4-advanced-evaluation-features class=hanchor arialabel=Anchor>#</a></h2><p>Let&rsquo;s enhance our evaluation with more sophisticated features:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Evaluator</span><span class=p>)</span> <span class=nf>evaluateMobility</span><span class=p>()</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>score</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Piece mobility bonuses/penalties</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Evaluator</span><span class=p>)</span> <span class=nf>evaluateMobility</span><span class=p>()</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>score</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Mobility weights for each piece type</span>
</span></span><span class=line><span class=cl>    <span class=nx>mobilityWeights</span> <span class=o>:=</span> <span class=kd>map</span><span class=p>[</span><span class=kt>int</span><span class=p>]</span><span class=kt>int</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Knight</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Bishop</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Rook</span><span class=p>:</span>   <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Queen</span><span class=p>:</span>  <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Calculate mobility for both sides</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>sq</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>sq</span> <span class=p>&lt;</span> <span class=mi>64</span><span class=p>;</span> <span class=nx>sq</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>piece</span> <span class=o>:=</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Board</span><span class=p>[</span><span class=nx>sq</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nx>color</span> <span class=o>:=</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Colors</span><span class=p>[</span><span class=nx>sq</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>piece</span> <span class=o>==</span> <span class=nx>Empty</span> <span class=o>||</span> <span class=nx>piece</span> <span class=o>==</span> <span class=nx>Pawn</span> <span class=o>||</span> <span class=nx>piece</span> <span class=o>==</span> <span class=nx>King</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>moves</span> <span class=o>:=</span> <span class=nx>e</span><span class=p>.</span><span class=nf>generatePieceMoves</span><span class=p>(</span><span class=nx>sq</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>mobilityScore</span> <span class=o>:=</span> <span class=nb>len</span><span class=p>(</span><span class=nx>moves</span><span class=p>)</span> <span class=o>*</span> <span class=nx>mobilityWeights</span><span class=p>[</span><span class=nx>piece</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nx>score</span> <span class=o>+=</span> <span class=nx>mobilityScore</span> <span class=o>*</span> <span class=nx>color</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>score</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Helper function to check piece attacks</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Evaluator</span><span class=p>)</span> <span class=nf>isSquareAttacked</span><span class=p>(</span><span class=nx>sq</span><span class=p>,</span> <span class=nx>byColor</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Check pawn attacks</span>
</span></span><span class=line><span class=cl>    <span class=nx>pawnDir</span> <span class=o>:=</span> <span class=o>-</span><span class=nx>byColor</span> <span class=c1>// Pawns move in opposite direction of their color</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>offset</span> <span class=o>:=</span> <span class=k>range</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{</span><span class=mi>7</span><span class=p>,</span> <span class=mi>9</span><span class=p>}</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>attackSq</span> <span class=o>:=</span> <span class=nx>sq</span> <span class=o>+</span> <span class=nx>pawnDir</span><span class=o>*</span><span class=mi>8</span> <span class=o>+</span> <span class=nx>offset</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>attackSq</span> <span class=o>&gt;=</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=nx>attackSq</span> <span class=p>&lt;</span> <span class=mi>64</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Board</span><span class=p>[</span><span class=nx>attackSq</span><span class=p>]</span> <span class=o>==</span> <span class=nx>Pawn</span> <span class=o>&amp;&amp;</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Colors</span><span class=p>[</span><span class=nx>attackSq</span><span class=p>]</span> <span class=o>==</span> <span class=nx>byColor</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Check knight attacks</span>
</span></span><span class=line><span class=cl>    <span class=nx>knightOffsets</span> <span class=o>:=</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{</span><span class=o>-</span><span class=mi>17</span><span class=p>,</span> <span class=o>-</span><span class=mi>15</span><span class=p>,</span> <span class=o>-</span><span class=mi>10</span><span class=p>,</span> <span class=o>-</span><span class=mi>6</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>15</span><span class=p>,</span> <span class=mi>17</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>offset</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>knightOffsets</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>attackSq</span> <span class=o>:=</span> <span class=nx>sq</span> <span class=o>+</span> <span class=nx>offset</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>attackSq</span> <span class=o>&gt;=</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=nx>attackSq</span> <span class=p>&lt;</span> <span class=mi>64</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Board</span><span class=p>[</span><span class=nx>attackSq</span><span class=p>]</span> <span class=o>==</span> <span class=nx>Knight</span> <span class=o>&amp;&amp;</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Colors</span><span class=p>[</span><span class=nx>attackSq</span><span class=p>]</span> <span class=o>==</span> <span class=nx>byColor</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Check sliding piece attacks (Bishop, Rook, Queen)</span>
</span></span><span class=line><span class=cl>    <span class=nx>directions</span> <span class=o>:=</span> <span class=p>[][]</span><span class=kt>int</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>},</span> <span class=p>{</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>},</span> <span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>},</span> <span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>},</span>  <span class=c1>// Bishop/Queen directions</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>},</span> <span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>},</span> <span class=p>{</span><span class=mi>0</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>},</span> <span class=p>{</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>},</span>    <span class=c1>// Rook/Queen directions</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>dir</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>directions</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>dx</span><span class=p>,</span> <span class=nx>dy</span> <span class=o>:=</span> <span class=nx>dir</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nx>dir</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nx>x</span><span class=p>,</span> <span class=nx>y</span> <span class=o>:=</span> <span class=nx>sq</span><span class=o>%</span><span class=mi>8</span><span class=p>,</span> <span class=nx>sq</span><span class=o>/</span><span class=mi>8</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>1</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>8</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>newX</span><span class=p>,</span> <span class=nx>newY</span> <span class=o>:=</span> <span class=nx>x</span><span class=o>+</span><span class=nx>dx</span><span class=o>*</span><span class=nx>i</span><span class=p>,</span> <span class=nx>y</span><span class=o>+</span><span class=nx>dy</span><span class=o>*</span><span class=nx>i</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>newX</span> <span class=p>&lt;</span> <span class=mi>0</span> <span class=o>||</span> <span class=nx>newX</span> <span class=o>&gt;=</span> <span class=mi>8</span> <span class=o>||</span> <span class=nx>newY</span> <span class=p>&lt;</span> <span class=mi>0</span> <span class=o>||</span> <span class=nx>newY</span> <span class=o>&gt;=</span> <span class=mi>8</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=nx>attackSq</span> <span class=o>:=</span> <span class=nx>newY</span><span class=o>*</span><span class=mi>8</span> <span class=o>+</span> <span class=nx>newX</span>
</span></span><span class=line><span class=cl>            <span class=nx>piece</span> <span class=o>:=</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Board</span><span class=p>[</span><span class=nx>attackSq</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nx>piece</span> <span class=o>!=</span> <span class=nx>Empty</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=nx>e</span><span class=p>.</span><span class=nx>pos</span><span class=p>.</span><span class=nx>Colors</span><span class=p>[</span><span class=nx>attackSq</span><span class=p>]</span> <span class=o>==</span> <span class=nx>byColor</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=c1>// Check if piece can move in this direction</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=nx>piece</span> <span class=o>==</span> <span class=nx>Queen</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=nx>piece</span> <span class=o>==</span> <span class=nx>Rook</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=nx>dx</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>||</span> <span class=nx>dy</span> <span class=o>==</span> <span class=mi>0</span><span class=p>))</span> <span class=o>||</span>
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=nx>piece</span> <span class=o>==</span> <span class=nx>Bishop</span> <span class=o>&amp;&amp;</span> <span class=nx>dx</span> <span class=o>!=</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=nx>dy</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=part-5-advanced-search-techniques>Part 5: Advanced Search Techniques<a href=#part-5-advanced-search-techniques class=hanchor arialabel=Anchor>#</a></h2><p>Let&rsquo;s implement some advanced search techniques to improve the engine&rsquo;s strength:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Null Move Pruning</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Engine</span><span class=p>)</span> <span class=nf>alphaBetaWithNullMove</span><span class=p>(</span><span class=nx>pos</span> <span class=o>*</span><span class=nx>Position</span><span class=p>,</span> <span class=nx>depth</span><span class=p>,</span> <span class=nx>alpha</span><span class=p>,</span> <span class=nx>beta</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>info</span> <span class=o>*</span><span class=nx>SearchInfo</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>depth</span> <span class=o>&gt;=</span> <span class=mi>3</span> <span class=o>&amp;&amp;</span> <span class=p>!</span><span class=nx>pos</span><span class=p>.</span><span class=nf>InCheck</span><span class=p>()</span> <span class=o>&amp;&amp;</span> <span class=nx>pos</span><span class=p>.</span><span class=nf>HasNonPawnMaterial</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Make null move</span>
</span></span><span class=line><span class=cl>        <span class=nx>newPos</span> <span class=o>:=</span> <span class=nx>pos</span><span class=p>.</span><span class=nf>MakeNullMove</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Reduced depth for null move search</span>
</span></span><span class=line><span class=cl>        <span class=nx>R</span> <span class=o>:=</span> <span class=mi>2</span> <span class=o>+</span> <span class=nx>depth</span><span class=o>/</span><span class=mi>4</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Recursive search with reduced depth</span>
</span></span><span class=line><span class=cl>        <span class=nx>score</span> <span class=o>:=</span> <span class=o>-</span><span class=nx>e</span><span class=p>.</span><span class=nf>alphaBeta</span><span class=p>(</span><span class=nx>newPos</span><span class=p>,</span> <span class=nx>depth</span><span class=o>-</span><span class=nx>R</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=nx>beta</span><span class=p>,</span> <span class=o>-</span><span class=nx>beta</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span> <span class=nx>info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>score</span> <span class=o>&gt;=</span> <span class=nx>beta</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>beta</span> <span class=c1>// Null move cutoff</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Continue with regular alpha-beta search...</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>e</span><span class=p>.</span><span class=nf>alphaBeta</span><span class=p>(</span><span class=nx>pos</span><span class=p>,</span> <span class=nx>depth</span><span class=p>,</span> <span class=nx>alpha</span><span class=p>,</span> <span class=nx>beta</span><span class=p>,</span> <span class=nx>info</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Late Move Reduction</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Engine</span><span class=p>)</span> <span class=nf>alphaBetaWithLMR</span><span class=p>(</span><span class=nx>pos</span> <span class=o>*</span><span class=nx>Position</span><span class=p>,</span> <span class=nx>depth</span><span class=p>,</span> <span class=nx>alpha</span><span class=p>,</span> <span class=nx>beta</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>moveCount</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>info</span> <span class=o>*</span><span class=nx>SearchInfo</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>depth</span> <span class=o>&gt;=</span> <span class=mi>3</span> <span class=o>&amp;&amp;</span> <span class=nx>moveCount</span> <span class=o>&gt;=</span> <span class=mi>4</span> <span class=o>&amp;&amp;</span> <span class=p>!</span><span class=nx>pos</span><span class=p>.</span><span class=nf>InCheck</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Reduce depth for late moves</span>
</span></span><span class=line><span class=cl>        <span class=nx>reduction</span> <span class=o>:=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>moveCount</span> <span class=o>&gt;=</span> <span class=mi>6</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>reduction</span><span class=o>++</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// Reduced depth search</span>
</span></span><span class=line><span class=cl>        <span class=nx>score</span> <span class=o>:=</span> <span class=o>-</span><span class=nx>e</span><span class=p>.</span><span class=nf>alphaBeta</span><span class=p>(</span><span class=nx>pos</span><span class=p>,</span> <span class=nx>depth</span><span class=o>-</span><span class=nx>reduction</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=nx>alpha</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=nx>alpha</span><span class=p>,</span> <span class=nx>info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// If reduced search fails high, do a full depth search</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>score</span> <span class=p>&gt;</span> <span class=nx>alpha</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=o>-</span><span class=nx>e</span><span class=p>.</span><span class=nf>alphaBeta</span><span class=p>(</span><span class=nx>pos</span><span class=p>,</span> <span class=nx>depth</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=nx>beta</span><span class=p>,</span> <span class=o>-</span><span class=nx>alpha</span><span class=p>,</span> <span class=nx>info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>score</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Continue with regular search...</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>-</span><span class=nx>e</span><span class=p>.</span><span class=nf>alphaBeta</span><span class=p>(</span><span class=nx>pos</span><span class=p>,</span> <span class=nx>depth</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=nx>beta</span><span class=p>,</span> <span class=o>-</span><span class=nx>alpha</span><span class=p>,</span> <span class=nx>info</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Aspiration Windows</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>e</span> <span class=o>*</span><span class=nx>Engine</span><span class=p>)</span> <span class=nf>searchWithAspirationWindows</span><span class=p>(</span><span class=nx>pos</span> <span class=o>*</span><span class=nx>Position</span><span class=p>,</span> <span class=nx>depth</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>info</span> <span class=o>*</span><span class=nx>SearchInfo</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>score</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=nx>alpha</span> <span class=o>:=</span> <span class=o>-</span><span class=nx>infinity</span>
</span></span><span class=line><span class=cl>    <span class=nx>beta</span> <span class=o>:=</span> <span class=nx>infinity</span>
</span></span><span class=line><span class=cl>    <span class=nx>window</span> <span class=o>:=</span> <span class=mi>50</span> <span class=c1>// Initial window size in centipawns</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// First search with full window</span>
</span></span><span class=line><span class=cl>    <span class=nx>score</span> <span class=p>=</span> <span class=nx>e</span><span class=p>.</span><span class=nf>alphaBeta</span><span class=p>(</span><span class=nx>pos</span><span class=p>,</span> <span class=nx>depth</span><span class=p>,</span> <span class=nx>alpha</span><span class=p>,</span> <span class=nx>beta</span><span class=p>,</span> <span class=nx>info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Subsequent searches with aspiration windows</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>currentDepth</span> <span class=o>:=</span> <span class=mi>2</span><span class=p>;</span> <span class=nx>currentDepth</span> <span class=o>&lt;=</span> <span class=nx>depth</span><span class=p>;</span> <span class=nx>currentDepth</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>alpha</span> <span class=p>=</span> <span class=nx>score</span> <span class=o>-</span> <span class=nx>window</span>
</span></span><span class=line><span class=cl>        <span class=nx>beta</span> <span class=p>=</span> <span class=nx>score</span> <span class=o>+</span> <span class=nx>window</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>score</span> <span class=p>=</span> <span class=nx>e</span><span class=p>.</span><span class=nf>alphaBeta</span><span class=p>(</span><span class=nx>pos</span><span class=p>,</span> <span class=nx>currentDepth</span><span class=p>,</span> <span class=nx>alpha</span><span class=p>,</span> <span class=nx>beta</span><span class=p>,</span> <span class=nx>info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>score</span> <span class=o>&lt;=</span> <span class=nx>alpha</span> <span class=o>||</span> <span class=nx>score</span> <span class=o>&gt;=</span> <span class=nx>beta</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>// Window failed, retry with larger window</span>
</span></span><span class=line><span class=cl>            <span class=nx>window</span> <span class=o>*=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>            <span class=nx>score</span> <span class=p>=</span> <span class=nx>e</span><span class=p>.</span><span class=nf>alphaBeta</span><span class=p>(</span><span class=nx>pos</span><span class=p>,</span> <span class=nx>currentDepth</span><span class=p>,</span> <span class=o>-</span><span class=nx>infinity</span><span class=p>,</span> <span class=nx>infinity</span><span class=p>,</span> <span class=nx>info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nx>window</span> <span class=p>=</span> <span class=mi>50</span> <span class=c1>// Reset window size for next iteration</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>score</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=part-6-time-management>Part 6: Time Management<a href=#part-6-time-management class=hanchor arialabel=Anchor>#</a></h2><p>Proper time management is crucial for tournament play:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>TimeManager</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>InitialTime</span>  <span class=nx>time</span><span class=p>.</span><span class=nx>Duration</span>
</span></span><span class=line><span class=cl>    <span class=nx>Increment</span>    <span class=nx>time</span><span class=p>.</span><span class=nx>Duration</span>
</span></span><span class=line><span class=cl>    <span class=nx>MovesToGo</span>    <span class=kt>int</span>
</span></span><span class=line><span class=cl>    <span class=nx>MaxMoveTime</span>  <span class=nx>time</span><span class=p>.</span><span class=nx>Duration</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewTimeManager</span><span class=p>(</span><span class=nx>initialTime</span><span class=p>,</span> <span class=nx>increment</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Duration</span><span class=p>,</span> <span class=nx>movesToGo</span> <span class=kt>int</span><span class=p>)</span> <span class=o>*</span><span class=nx>TimeManager</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>&amp;</span><span class=nx>TimeManager</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>InitialTime</span><span class=p>:</span> <span class=nx>initialTime</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Increment</span><span class=p>:</span>   <span class=nx>increment</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>MovesToGo</span><span class=p>:</span>   <span class=nx>movesToGo</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>MaxMoveTime</span><span class=p>:</span> <span class=nx>initialTime</span> <span class=o>/</span> <span class=mi>20</span><span class=p>,</span> <span class=c1>// Don&#39;t use more than 5% of total time</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>tm</span> <span class=o>*</span><span class=nx>TimeManager</span><span class=p>)</span> <span class=nf>allocateTime</span><span class=p>(</span><span class=nx>pos</span> <span class=o>*</span><span class=nx>Position</span><span class=p>)</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Duration</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Basic time allocation</span>
</span></span><span class=line><span class=cl>    <span class=nx>baseTime</span> <span class=o>:=</span> <span class=nx>tm</span><span class=p>.</span><span class=nx>InitialTime</span> <span class=o>/</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Duration</span><span class=p>(</span><span class=nx>tm</span><span class=p>.</span><span class=nx>MovesToGo</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Adjust based on game phase</span>
</span></span><span class=line><span class=cl>    <span class=nx>gamePhase</span> <span class=o>:=</span> <span class=nf>evaluateGamePhase</span><span class=p>(</span><span class=nx>pos</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nx>gamePhase</span> <span class=p>&lt;</span> <span class=mf>0.3</span><span class=p>:</span> <span class=c1>// Opening</span>
</span></span><span class=line><span class=cl>        <span class=nx>baseTime</span> <span class=o>*=</span> <span class=mi>8</span><span class=o>/</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=nx>gamePhase</span> <span class=p>&gt;</span> <span class=mf>0.7</span><span class=p>:</span> <span class=c1>// Endgame</span>
</span></span><span class=line><span class=cl>        <span class=nx>baseTime</span> <span class=o>*=</span> <span class=mi>12</span><span class=o>/</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Add increment</span>
</span></span><span class=line><span class=cl>    <span class=nx>allocatedTime</span> <span class=o>:=</span> <span class=nx>baseTime</span> <span class=o>+</span> <span class=nx>tm</span><span class=p>.</span><span class=nx>Increment</span><span class=o>*</span><span class=mi>8</span><span class=o>/</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Never exceed maximum move time</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>allocatedTime</span> <span class=p>&gt;</span> <span class=nx>tm</span><span class=p>.</span><span class=nx>MaxMoveTime</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>allocatedTime</span> <span class=p>=</span> <span class=nx>tm</span><span class=p>.</span><span class=nx>MaxMoveTime</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>allocatedTime</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>evaluateGamePhase</span><span class=p>(</span><span class=nx>pos</span> <span class=o>*</span><span class=nx>Position</span><span class=p>)</span> <span class=kt>float64</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Count material to determine game phase</span>
</span></span><span class=line><span class=cl>    <span class=nx>totalMaterial</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=nx>maxMaterial</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>sq</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>sq</span> <span class=p>&lt;</span> <span class=mi>64</span><span class=p>;</span> <span class=nx>sq</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>piece</span> <span class=o>:=</span> <span class=nx>pos</span><span class=p>.</span><span class=nx>Board</span><span class=p>[</span><span class=nx>sq</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>piece</span> <span class=o>!=</span> <span class=nx>Empty</span> <span class=o>&amp;&amp;</span> <span class=nx>piece</span> <span class=o>!=</span> <span class=nx>King</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>totalMaterial</span> <span class=o>+=</span> <span class=nx>pieceValues</span><span class=p>[</span><span class=nx>piece</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=nx>maxMaterial</span> <span class=o>+=</span> <span class=nx>pieceValues</span><span class=p>[</span><span class=nx>piece</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Return value between 0 (opening) and 1 (endgame)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mf>1.0</span> <span class=o>-</span> <span class=nb>float64</span><span class=p>(</span><span class=nx>totalMaterial</span><span class=p>)</span><span class=o>/</span><span class=nb>float64</span><span class=p>(</span><span class=nx>maxMaterial</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=part-7-opening-book-and-endgame-tablebases>Part 7: Opening Book and Endgame Tablebases<a href=#part-7-opening-book-and-endgame-tablebases class=hanchor arialabel=Anchor>#</a></h2><p>For completeness, let&rsquo;s add support for opening books and endgame tablebases:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>OpeningBook</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>positions</span> <span class=kd>map</span><span class=p>[</span><span class=kt>uint64</span><span class=p>][]</span><span class=nx>BookMove</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>BookMove</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Move</span>   <span class=nx>Move</span>
</span></span><span class=line><span class=cl>    <span class=nx>Weight</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>book</span> <span class=o>*</span><span class=nx>OpeningBook</span><span class=p>)</span> <span class=nf>GetBookMove</span><span class=p>(</span><span class=nx>pos</span> <span class=o>*</span><span class=nx>Position</span><span class=p>)</span> <span class=p>(</span><span class=nx>Move</span><span class=p>,</span> <span class=kt>bool</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>moves</span><span class=p>,</span> <span class=nx>exists</span> <span class=o>:=</span> <span class=nx>book</span><span class=p>.</span><span class=nx>positions</span><span class=p>[</span><span class=nx>pos</span><span class=p>.</span><span class=nf>Hash</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>!</span><span class=nx>exists</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>Move</span><span class=p>{},</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Select move based on weights</span>
</span></span><span class=line><span class=cl>    <span class=nx>totalWeight</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>m</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>moves</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>totalWeight</span> <span class=o>+=</span> <span class=nx>m</span><span class=p>.</span><span class=nx>Weight</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Random selection weighted by frequency</span>
</span></span><span class=line><span class=cl>    <span class=nx>r</span> <span class=o>:=</span> <span class=nx>rand</span><span class=p>.</span><span class=nf>Intn</span><span class=p>(</span><span class=nx>totalWeight</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>currentWeight</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>m</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>moves</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>currentWeight</span> <span class=o>+=</span> <span class=nx>m</span><span class=p>.</span><span class=nx>Weight</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nx>r</span> <span class=p>&lt;</span> <span class=nx>currentWeight</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nx>m</span><span class=p>.</span><span class=nx>Move</span><span class=p>,</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>moves</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>Move</span><span class=p>,</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Tablebase</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>cache</span> <span class=kd>map</span><span class=p>[</span><span class=kt>uint64</span><span class=p>]</span><span class=nx>TablebaseEntry</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>TablebaseEntry</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Score</span>    <span class=kt>int</span>
</span></span><span class=line><span class=cl>    <span class=nx>BestMove</span> <span class=nx>Move</span>
</span></span><span class=line><span class=cl>    <span class=nx>DTM</span>     <span class=kt>int</span> <span class=c1>// Distance to mate</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>tb</span> <span class=o>*</span><span class=nx>Tablebase</span><span class=p>)</span> <span class=nf>Probe</span><span class=p>(</span><span class=nx>pos</span> <span class=o>*</span><span class=nx>Position</span><span class=p>)</span> <span class=p>(</span><span class=nx>TablebaseEntry</span><span class=p>,</span> <span class=kt>bool</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Probe tablebase cache</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>entry</span><span class=p>,</span> <span class=nx>exists</span> <span class=o>:=</span> <span class=nx>tb</span><span class=p>.</span><span class=nx>cache</span><span class=p>[</span><span class=nx>pos</span><span class=p>.</span><span class=nf>Hash</span><span class=p>()];</span> <span class=nx>exists</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>entry</span><span class=p>,</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Only probe for positions with 6 or fewer pieces</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>pos</span><span class=p>.</span><span class=nf>PieceCount</span><span class=p>()</span> <span class=p>&gt;</span> <span class=mi>6</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>TablebaseEntry</span><span class=p>{},</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// Here you would implement actual tablebase probing</span>
</span></span><span class=line><span class=cl>    <span class=c1>// This typically involves accessing Syzygy or Gaviota tablebases</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>TablebaseEntry</span><span class=p>{},</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=conclusion>Conclusion<a href=#conclusion class=hanchor arialabel=Anchor>#</a></h2><p>Building a chess engine involves multiple complex components working together:</p><ol><li><strong>Board Representation</strong>: Efficient position storage and move generation</li><li><strong>Evaluation</strong>: Material, piece placement, pawn structure, king safety, and mobility</li><li><strong>Search</strong>: Alpha-beta pruning with enhancements (null move, LMR, aspiration windows)</li><li><strong>Time Management</strong>: Adaptive time allocation based on position and game phase</li><li><strong>Opening/Endgame</strong>: Book moves and tablebase access for perfect play</li></ol><p>Future improvements could include:</p><ul><li>Neural network evaluation</li><li>Multi-threaded search</li><li>Supervised learning from master games</li><li>NNUE (Efficiently Updatable Neural Network) evaluation</li><li>Advanced pruning techniques (Futility pruning, SEE, etc.)</li><li>Contempt factor for tournament play</li></ul><p>Remember that chess programming is an iterative process. Start with the basics and gradually add more sophisticated features while testing against other engines to measure improvement.</p><h2 id=references>References<a href=#references class=hanchor arialabel=Anchor>#</a></h2><ul><li><a href=https://www.chessprogramming.org>Chess Programming Wiki</a></li><li><a href=https://github.com/official-stockfish/Stockfish>Stockfish GitHub Repository</a></li><li>&ldquo;How Computers Play Chess&rdquo; by David Levy and Monty Newborn</li><li>&ldquo;Chess Programming&rdquo; by François-Dominic Laramée</li></ul></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h></span><hr></div><div class=pagination__buttons><a href=https://manuelfedele.github.io/posts/multi-account-aws-terraform-workspaces/ class="button inline prev">&lt; [<span class=button__text>Managing Multi-Account AWS Infrastructure with Terraform Workspaces</span>]
</a>::
<a href=https://manuelfedele.github.io/posts/jwt-issuer-in-go/ class="button inline next">[<span class=button__text>Implementing a JWT Issuer in Go</span>] ></a></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2026 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>